<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>Spill ‚Äî JEJAK</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#000;
  --sf:#0a0a0a;
  --sfe:#111;
  --bd:#1a1a1a;
  --tx:#fff;
  --txs:#666;
  --txm:#444;
  --ap:#ff3d00;
  --as:#00f0ff;
  --aq:#00ff41;
  --war:#ff0040;
  --ms:#ff9500;
  --mt:#00ff41;
  --mc:#00f0ff;
  --md:#8b5cf6;
  --safe-bottom:env(safe-area-inset-bottom);
  --safe-top:env(safe-area-inset-top)
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
html{height:100%;overflow:hidden}
body{
  height:100%;
  background:var(--bg);
  color:var(--tx);
  font-family:'Inter',-apple-system,sans-serif;
  font-size:14px;
  line-height:1.4;
  overflow:hidden;
  position:fixed;
  width:100%;
  overscroll-behavior:none
}
.app{height:100%;display:flex;flex-direction:column;overflow:hidden}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header{
  padding:12px 16px;
  padding-top:calc(12px + var(--safe-top));
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--bd);
  background:var(--bg);
  flex-shrink:0
}
.logo{font-size:28px;font-weight:800;letter-spacing:-2px;line-height:1}
.logo span{color:var(--ap)}
.status{display:flex;align-items:center;gap:6px}
.pulse{width:6px;height:6px;background:var(--aq);border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.live{font-size:10px;font-weight:600;color:var(--txs);letter-spacing:.5px}

/* ‚îÄ‚îÄ SCROLL ‚îÄ‚îÄ */
.scroll{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}
.scroll::-webkit-scrollbar{display:none}

/* ‚îÄ‚îÄ RADAR BELL & ROSS STYLE ‚îÄ‚îÄ */
.radar-sect{
  background:var(--sf);
  border-bottom:1px solid var(--bd);
  padding:16px 0
}
.radar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 16px 12px
}
.radar-label{
  font-family:'Space Mono',monospace;
  font-size:9px;
  color:var(--aq);
  letter-spacing:2px;
  display:flex;
  align-items:center;
  gap:6px
}
.radar-label::before{
  content:'';
  width:6px;
  height:6px;
  background:var(--aq);
  border-radius:50%;
  animation:blink 1s infinite
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.radar-stat{font-family:'Space Mono',monospace;font-size:9px;color:var(--txs)}

/* BELL & ROSS INSTRUMENT CASE */
.radar-wrapper{padding:0 16px}
.radar-case{
  position:relative;
  background:linear-gradient(145deg,#1a1a1a 0%,#0f0f0f 50%,#1a1a1a 100%);
  border-radius:24px;
  padding:20px;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.08),
    inset 0 -1px 0 rgba(0,0,0,.8),
    0 20px 40px rgba(0,0,0,.6),
    0 0 0 1px #000
}
/* Screws at corners */
.radar-screw{
  position:absolute;
  width:16px;
  height:16px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#3a3a3a 0%,#1a1a1a 50%,#0a0a0a 100%);
  box-shadow:
    inset 0 1px 1px rgba(255,255,255,.15),
    inset 0 -1px 1px rgba(0,0,0,.8),
    0 1px 2px rgba(0,0,0,.5)
}
.radar-screw::before,
.radar-screw::after{
  content:'';
  position:absolute;
  background:rgba(0,0,0,.6);
  border-radius:1px
}
.radar-screw::before{width:8px;height:2px;top:7px;left:4px}
.radar-screw::after{width:2px;height:8px;top:4px;left:7px}
.screw-tl{top:8px;left:8px;transform:rotate(15deg)}
.screw-tr{top:8px;right:8px;transform:rotate(-20deg)}
.screw-bl{bottom:8px;left:8px;transform:rotate(-10deg)}
.screw-br{bottom:8px;right:8px;transform:rotate(25deg)}

/* Bezel markings */
.radar-bezel-mark{
  position:absolute;
  top:6px;
  left:50%;
  transform:translateX(-50%);
  font-family:'Oswald',sans-serif;
  font-size:8px;
  color:rgba(255,255,255,.15);
  letter-spacing:3px;
  font-weight:500
}
.radar-bezel-num{
  position:absolute;
  font-family:'Oswald',sans-serif;
  font-size:10px;
  font-weight:700;
  color:rgba(255,255,255,.2)
}
.bzn-12{top:28px;left:50%;transform:translateX(-50%)}
.bzn-3{right:28px;top:50%;transform:translateY(-50%)}
.bzn-6{bottom:28px;left:50%;transform:translateX(-50%)}
.bzn-9{left:28px;top:50%;transform:translateY(-50%)}

/* CRT Display - FIXED ASPECT RATIO */
.radar-display{
  position:relative;
  width:100%;
  padding-bottom:100%; /* Square aspect ratio */
  background:#000;
  border-radius:50%;
  overflow:hidden;
  box-shadow:
    inset 0 0 60px rgba(0,0,0,.9),
    inset 0 0 0 2px #000,
    0 0 0 1px rgba(255,255,255,.05)
}
.radar-display-inner{
  position:absolute;
  inset:0;
  border-radius:50%;
}
/* Glass reflection */
.radar-display-inner::before{
  content:'';
  position:absolute;
  inset:0;
  border-radius:50%;
  background:
    radial-gradient(ellipse at 35% 25%,rgba(255,255,255,.06) 0%,transparent 50%),
    linear-gradient(135deg,rgba(255,255,255,.03) 0%,transparent 40%);
  z-index:20;
  pointer-events:none
}
/* Scanlines */
.radar-display-inner::after{
  content:'';
  position:absolute;
  inset:0;
  border-radius:50%;
  background:repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,.1) 2px,
    rgba(0,0,0,.1) 3px
  );
  z-index:15;
  pointer-events:none
}

/* Grid - military green */
.radar-grid{
  position:absolute;
  inset:8%;
  border-radius:50%;
  border:1px solid rgba(0,255,65,.08)
}
.radar-grid::before,
.radar-grid::after{
  content:'';
  position:absolute;
  border-radius:50%;
  border:1px solid rgba(0,255,65,.06)
}
.radar-grid::before{inset:25%}
.radar-grid::after{inset:50%;border-color:rgba(0,255,65,.04)}

/* Crosshair */
.radar-cross{
  position:absolute;
  inset:0;
  background:
    linear-gradient(90deg,transparent calc(50% - .5px),rgba(0,255,65,.1) calc(50% - .5px),rgba(0,255,65,.1) calc(50% + .5px),transparent calc(50% + .5px)),
    linear-gradient(0deg,transparent calc(50% - .5px),rgba(0,255,65,.1) calc(50% - .5px),rgba(0,255,65,.1) calc(50% + .5px),transparent calc(50% + .5px))
}

/* Range rings */
.radar-rings{
  position:absolute;
  inset:0;
  border-radius:50%
}
.radar-ring{
  position:absolute;
  border:1px solid rgba(0,255,65,.05);
  border-radius:50%
}
.ring-1{inset:15%}
.ring-2{inset:35%}
.ring-3{inset:55%}
.ring-4{inset:75%}

/* Canvas - FIXED */
.radar-canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:5;
  border-radius:50%
}

/* Dots container */
.radar-dots{
  position:absolute;
  inset:0;
  z-index:10;
  border-radius:50%;
  overflow:hidden
}
.radar-dot{
  position:absolute;
  width:10px;
  height:10px;
  border-radius:50%;
  transform:translate(-50%,-50%);
  opacity:.4;
  will-change:transform,opacity;
  transition:opacity .1s ease-out
}
.radar-dot.hit{
  opacity:1;
  transform:translate(-50%,-50%) scale(2);
  filter:brightness(2) drop-shadow(0 0 8px currentColor)
}
.radar-dot.purple{background:#b026ff;box-shadow:0 0 6px #b026ff}
.radar-dot.red{background:var(--war);box-shadow:0 0 6px var(--war)}
.radar-dot.ai{background:var(--aq);box-shadow:0 0 6px var(--aq)}

/* Brand text on display */
.radar-brand{
  position:absolute;
  top:28%;
  left:50%;
  transform:translateX(-50%);
  font-family:'Oswald',sans-serif;
  font-size:8px;
  letter-spacing:4px;
  color:rgba(0,255,65,.3);
  text-transform:uppercase;
  z-index:12;
  pointer-events:none
}
.radar-model{
  position:absolute;
  bottom:28%;
  left:50%;
  transform:translateX(-50%);
  font-family:'Space Mono',monospace;
  font-size:7px;
  letter-spacing:2px;
  color:rgba(0,255,65,.2);
  z-index:12;
  pointer-events:none
}

/* Footer stats */
.radar-footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 16px 0;
  gap:12px
}
.radar-stat-box{
  display:flex;
  flex-direction:column;
  gap:2px
}
.radar-stat-label{
  font-family:'Space Mono',monospace;
  font-size:8px;
  color:var(--txm);
  letter-spacing:1px
}
.radar-stat-value{
  font-family:'Oswald',sans-serif;
  font-size:28px;
  font-weight:700;
  color:var(--aq);
  line-height:1;
  text-shadow:0 0 20px rgba(0,255,65,.4);
  letter-spacing:-1px
}
.radar-stat-unit{font-size:10px;color:var(--txs);margin-left:4px}
.vibe-btn{
  background:var(--ap);
  color:#000;
  border:none;
  padding:16px 24px;
  font-size:13px;
  font-weight:800;
  letter-spacing:.5px;
  border-radius:12px;
  display:flex;
  align-items:center;
  gap:8px;
  flex-shrink:0;
  touch-action:manipulation;
  box-shadow:0 4px 0 rgba(255,61,0,.3),0 8px 20px rgba(255,61,0,.2);
  transition:all .1s;
  font-family:'Oswald',sans-serif;
  text-transform:uppercase
}
.vibe-btn:active{
  transform:translateY(4px);
  box-shadow:0 0 0 rgba(255,61,0,.3),0 0 0 rgba(255,61,0,.2)
}

/* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
.filter-sect{padding:16px;border-bottom:1px solid var(--bd)}
.filter-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px
}
.filter-title{font-size:11px;font-weight:700;color:var(--txs);letter-spacing:.5px}
.match-pct{font-family:'Space Mono',monospace;font-size:14px;color:var(--ap);font-weight:700}
.vibe-slider{
  width:100%;
  height:4px;
  background:var(--bd);
  border-radius:2px;
  outline:none;
  -webkit-appearance:none;
  display:block;
  margin-bottom:6px
}
.vibe-slider::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:24px;
  height:24px;
  background:var(--ap);
  border:3px solid var(--bg);
  border-radius:50%;
  box-shadow:0 0 0 1px var(--ap),0 2px 8px rgba(255,61,0,.4);
  margin-top:-10px
}
.vibe-slider::-webkit-slider-runnable-track{
  height:4px;
  background:linear-gradient(90deg,var(--ap) 0%,var(--ap) 87%,var(--bd) 87%);
  border-radius:2px
}
.slider-labels{
  display:flex;
  justify-content:space-between;
  font-size:9px;
  color:var(--txm);
  font-weight:600;
  margin-top:4px;
  margin-bottom:12px
}
.mood-scroll{
  display:flex;
  gap:8px;
  overflow-x:auto;
  margin:0 -16px;
  padding:0 16px 4px;
  scrollbar-width:none
}
.mood-scroll::-webkit-scrollbar{display:none}
.mood-chip{
  flex-shrink:0;
  padding:10px 16px;
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:24px;
  font-size:12px;
  font-weight:600;
  color:var(--txs);
  white-space:nowrap;
  touch-action:manipulation;
  transition:all .15s;
  cursor:pointer;
  font-family:inherit
}
.mood-chip.active{background:var(--ap);border-color:var(--ap);color:#000}
.mood-chip:active{transform:scale(.95);opacity:.8}

/* ‚îÄ‚îÄ SPILLS ‚îÄ‚îÄ */
.spills-sect{padding:16px;padding-bottom:calc(80px + var(--safe-bottom))}
.sect-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px
}
.sect-title{font-size:11px;font-weight:700;letter-spacing:.5px;color:var(--txs)}
.sect-meta{font-family:'Space Mono',monospace;font-size:9px;color:var(--txm)}
.spill-card{
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:16px;
  margin-bottom:12px;
  overflow:hidden
}
.spill-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-bottom:1px solid var(--bd);
  background:var(--bg)
}
.spill-user{
  font-family:'Space Mono',monospace;
  font-size:11px;
  color:var(--txs);
  font-weight:600
}
.spill-mood{
  font-size:10px;
  font-weight:700;
  padding:6px 12px;
  border-radius:20px;
  text-transform:uppercase;
  letter-spacing:.5px
}
.spill-mood.surviving{color:var(--ms);background:rgba(255,149,0,.1)}
.spill-mood.thriving{color:var(--mt);background:rgba(57,255,20,.1)}
.spill-mood.chaotic{color:var(--mc);background:rgba(0,240,255,.1)}
.spill-mood.doom{color:var(--md);background:rgba(139,92,246,.1)}
.spill-body{padding:16px;font-size:15px;line-height:1.6;color:var(--tx)}
.spill-actions{
  display:flex;
  gap:8px;
  padding:12px 16px;
  border-top:1px solid var(--bd);
  background:var(--bg);
  overflow-x:auto;
  scrollbar-width:none
}
.spill-actions::-webkit-scrollbar{display:none}
.react-btn{
  display:flex;
  align-items:center;
  gap:6px;
  padding:10px 16px;
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:24px;
  font-size:14px;
  color:var(--txs);
  flex-shrink:0;
  touch-action:manipulation;
  transition:all .15s;
  cursor:pointer;
  font-family:inherit
}
.react-btn.active{background:var(--ap);border-color:var(--ap);color:#000}
.react-btn:active{transform:scale(.95)}
.react-count{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;min-width:18px}
.refresh-btn{
  width:100%;
  padding:16px;
  background:transparent;
  border:1px dashed var(--bd);
  border-radius:16px;
  color:var(--txs);
  font-size:13px;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  margin-top:8px;
  touch-action:manipulation;
  transition:all .15s;
  cursor:pointer;
  font-family:inherit
}
.refresh-btn:active{background:var(--sf)}
.empty-state{text-align:center;padding:60px 20px}
.empty-icon{font-size:48px;margin-bottom:16px;opacity:.5}
.empty-title{font-size:16px;font-weight:700;color:var(--txs);margin-bottom:6px}
.empty-text{font-size:13px;color:var(--txm)}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bnav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(0,0,0,.95);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--bd);
  padding-bottom:var(--safe-bottom);
  z-index:100
}
.bnav-inner{
  display:flex;
  justify-content:space-around;
  align-items:center;
  height:60px;
  max-width:480px;
  margin:0 auto
}
.nav-item{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  height:100%;
  color:var(--txs);
  text-decoration:none;
  font-size:10px;
  font-weight:600;
  letter-spacing:.3px;
  position:relative;
  touch-action:manipulation;
  transition:all .15s
}
.nav-item.active{color:var(--ap)}
.nav-item.active::before{
  content:'';
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%);
  width:20px;
  height:2px;
  background:var(--ap);
  border-radius:0 0 2px 2px
}
.nav-icon{font-size:22px;line-height:1;margin-bottom:-2px}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:200;
  flex-direction:column;
  overflow:hidden
}
.modal.on{display:flex}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  padding-top:calc(16px + var(--safe-top));
  border-bottom:1px solid var(--bd)
}
.modal-title{font-size:17px;font-weight:700;letter-spacing:-.3px}
.modal-close{
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:10px;
  color:var(--txs);
  font-size:18px;
  touch-action:manipulation;
  cursor:pointer;
  transition:all .15s
}
.modal-close:active{background:var(--bd)}
.modal-body{
  flex:1;
  overflow-y:auto;
  padding:20px 16px calc(20px + var(--safe-bottom));
  -webkit-overflow-scrolling:touch
}
.modal-tag{
  font-family:'Space Mono',monospace;
  font-size:10px;
  color:var(--ap);
  margin-bottom:8px;
  letter-spacing:1px;
  font-weight:700;
  display:block
}
.modal-h{font-size:26px;font-weight:800;margin-bottom:6px;letter-spacing:-.5px;line-height:1.2}
.modal-sub{font-size:14px;color:var(--txs);margin-bottom:28px;line-height:1.5}
.gender-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-bottom:24px
}
.gender-card{
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:20px;
  padding:28px 16px;
  text-align:center;
  touch-action:manipulation;
  transition:all .15s;
  cursor:pointer
}
.gender-card.selected{border-color:var(--ap);background:rgba(255,61,0,.08)}
.gender-card:active{transform:scale(.96)}
.gender-icon{font-size:36px;margin-bottom:12px;display:block}
.gender-label{font-size:15px;font-weight:700;margin-bottom:4px}
.gender-desc{font-size:12px;color:var(--txs)}
.info-box{
  background:var(--sf);
  border-left:3px solid var(--ap);
  padding:16px;
  margin-bottom:28px;
  border-radius:0 16px 16px 0
}
.info-box p{
  font-family:'Space Mono',monospace;
  font-size:11px;
  color:var(--txs);
  line-height:1.7
}
.info-box strong{color:var(--ap);font-weight:700}
.action-btn{
  width:100%;
  padding:18px;
  background:var(--ap);
  color:#000;
  border:none;
  border-radius:14px;
  font-size:15px;
  font-weight:700;
  letter-spacing:.3px;
  touch-action:manipulation;
  cursor:pointer;
  transition:all .15s;
  font-family:inherit
}
.action-btn:disabled{opacity:.3;cursor:not-allowed}
.action-btn:active{transform:scale(.98)}
.action-btn.sec{background:var(--sf);color:var(--tx);border:1px solid var(--bd)}
.modal-hint{
  font-size:12px;
  color:var(--txm);
  text-align:center;
  margin-top:16px;
  line-height:1.6
}
.modal-hint-link{
  background:none;
  border:none;
  color:var(--as);
  font-size:12px;
  font-weight:700;
  cursor:pointer;
  text-decoration:underline;
  font-family:inherit;
  padding:0
}

/* PRICING */
.price-card{
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:20px;
  padding:24px 20px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  touch-action:manipulation;
  transition:all .15s;
  cursor:pointer
}
.price-card.selected{border-color:var(--ap);background:rgba(255,61,0,.08)}
.price-card:active{transform:scale(.98)}
.price-main{font-size:32px;font-weight:800;color:var(--ap);letter-spacing:-2px;line-height:1}
.price-sub{font-size:12px;color:var(--txs);margin-top:4px;font-family:'Space Mono',monospace}
.price-right{text-align:right}
.price-tag{font-size:13px;font-weight:700;color:var(--aq);margin-bottom:3px}
.price-note{font-size:11px;color:var(--txm);font-family:'Space Mono',monospace}
.timer-big{
  text-align:center;
  padding:40px 24px;
  background:var(--sf);
  border-radius:20px;
  margin-bottom:24px;
  border:1px solid var(--bd)
}
.timer-big .num{
  font-family:'Space Mono',monospace;
  font-size:56px;
  font-weight:700;
  color:var(--war);
  line-height:1;
  letter-spacing:-3px
}
.timer-big .label{
  font-size:12px;
  color:var(--txs);
  margin-top:12px;
  text-transform:uppercase;
  letter-spacing:2px;
  font-weight:600
}

/* ‚îÄ‚îÄ CHAT ROOM ‚îÄ‚îÄ */
.chat-room{
  display:none;
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:300;
  flex-direction:column
}
.chat-room.on{display:flex}
.chat-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
  padding-top:calc(12px + var(--safe-top));
  border-bottom:1px solid var(--bd);
  background:var(--sf)
}
.chat-info{flex:1}
.chat-label{
  font-family:'Space Mono',monospace;
  font-size:9px;
  color:var(--aq);
  letter-spacing:1px;
  margin-bottom:3px;
  font-weight:700
}
.chat-name{font-size:15px;font-weight:700}
.chat-timer{
  font-family:'Space Mono',monospace;
  font-size:16px;
  font-weight:700;
  color:var(--aq);
  background:var(--bg);
  padding:8px 14px;
  border-radius:10px;
  border:1px solid var(--bd);
  letter-spacing:-1px
}
.chat-timer.warn{
  color:var(--war);
  border-color:var(--war);
  animation:blink 1s infinite;
  background:rgba(255,0,64,.1)
}
.chat-close{
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--bg);
  border:1px solid var(--bd);
  border-radius:12px;
  color:var(--txs);
  margin-left:12px;
  font-size:18px;
  touch-action:manipulation;
  cursor:pointer;
  transition:all .15s
}
.chat-close:active{background:var(--bd)}
.chat-messages{
  flex:1;
  overflow-y:auto;
  padding:16px;
  display:flex;
  flex-direction:column;
  gap:12px;
  -webkit-overflow-scrolling:touch
}
.chat-bubble{
  max-width:85%;
  padding:14px 18px;
  border-radius:20px;
  font-size:15px;
  line-height:1.5;
  word-wrap:break-word;
  animation:popIn .25s cubic-bezier(.175,.885,.32,1.275)
}
@keyframes popIn{
  from{opacity:0;transform:scale(.8) translateY(10px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}
.chat-bubble.me{
  align-self:flex-end;
  background:var(--ap);
  color:#000;
  border-bottom-right-radius:6px;
  font-weight:600
}
.chat-bubble.them{
  align-self:flex-start;
  background:var(--sf);
  border:1px solid var(--bd);
  border-bottom-left-radius:6px
}
.chat-time{
  font-size:10px;
  color:var(--txm);
  margin-top:6px;
  font-family:'Space Mono',monospace;
  font-weight:600
}
.typing{
  display:flex;
  gap:4px;
  padding:18px 22px;
  background:var(--sf);
  border:1px solid var(--bd);
  border-radius:20px;
  border-bottom-left-radius:6px;
  align-self:flex-start;
  width:fit-content
}
.typing-dot{
  width:8px;
  height:8px;
  background:var(--aq);
  border-radius:50%;
  animation:typing 1.4s infinite
}
.typing-dot:nth-child(2){animation-delay:.2s}
.typing-dot:nth-child(3){animation-delay:.4s}
@keyframes typing{
  0%,60%,100%{transform:translateY(0)}
  30%{transform:translateY(-5px)}
}
.distress{
  display:none;
  padding:14px 16px;
  background:var(--war);
  color:#fff;
  font-size:12px;
  font-weight:700;
  text-align:center;
  letter-spacing:.3px
}
.distress.show{display:block}
.chat-input-wrap{
  padding:12px 16px;
  padding-bottom:calc(12px + var(--safe-bottom));
  border-top:1px solid var(--bd);
  background:var(--sf);
  display:flex;
  gap:10px
}
.chat-input{
  flex:1;
  background:var(--bg);
  border:1px solid var(--bd);
  border-radius:24px;
  padding:14px 18px;
  font-size:15px;
  color:var(--tx);
  outline:none;
  -webkit-appearance:none;
  transition:all .15s
}
.chat-input:focus{border-color:var(--ap)}
.chat-send{
  width:48px;
  height:48px;
  background:var(--ap);
  border:none;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#000;
  font-size:20px;
  flex-shrink:0;
  touch-action:manipulation;
  cursor:pointer;
  transition:all .15s;
  box-shadow:0 4px 0 rgba(255,61,0,.3)
}
.chat-send:active{
  transform:translateY(4px);
  box-shadow:0 0 0 rgba(255,61,0,.3)
}

/* TOAST */
.toast{
  position:fixed;
  bottom:100px;
  left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--tx);
  color:var(--bg);
  padding:14px 24px;
  border-radius:30px;
  font-size:14px;
  font-weight:700;
  z-index:400;
  opacity:0;
  transition:all .3s cubic-bezier(.175,.885,.32,1.275);
  pointer-events:none;
  white-space:nowrap;
  box-shadow:0 10px 40px rgba(0,0,0,.5)
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.error{background:var(--war);color:#fff}
</style>
<base target="_blank">
</head>
<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <div class="logo">SP<span>‚úï</span>LL</div>
  <div class="status">
    <div class="pulse"></div>
    <span class="live">LIVE</span>
  </div>
</div>

<!-- SCROLL AREA -->
<div class="scroll">

<!-- RADAR BELL & ROSS -->
<div class="radar-sect">
  <div class="radar-header">
    <span class="radar-label">VIBE RADAR</span>
    <span class="radar-stat">ONLINE</span>
  </div>
  <div class="radar-wrapper">
    <div class="radar-case">
      <!-- Screws -->
      <div class="radar-screw screw-tl"></div>
      <div class="radar-screw screw-tr"></div>
      <div class="radar-screw screw-bl"></div>
      <div class="radar-screw screw-br"></div>
      
      <!-- Bezel markings -->
      <div class="radar-bezel-mark">VIBE RADAR</div>
      <div class="radar-bezel-num bzn-12">12</div>
      <div class="radar-bezel-num bzn-3">3</div>
      <div class="radar-bezel-num bzn-6">6</div>
      <div class="radar-bezel-num bzn-9">9</div>
      
      <!-- Display -->
      <div class="radar-display" id="radarDisplay">
        <div class="radar-display-inner">
          <div class="radar-brand">JEJAK</div>
          <div class="radar-model">BR-03 RADAR</div>
          <div class="radar-grid"></div>
          <div class="radar-rings">
            <div class="radar-ring ring-1"></div>
            <div class="radar-ring ring-2"></div>
            <div class="radar-ring ring-3"></div>
            <div class="radar-ring ring-4"></div>
          </div>
          <div class="radar-cross"></div>
          <canvas class="radar-canvas" id="radarCanvas"></canvas>
          <div class="radar-dots" id="radarDots"></div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="radar-footer">
    <div class="radar-stat-box">
      <span class="radar-stat-label">ONLINE</span>
      <span class="radar-stat-value" id="quotaBadge">24<span class="radar-stat-unit">USERS</span></span>
    </div>
    <button class="vibe-btn" onclick="startVibeCheck()">
      <span>‚¨°</span>
      <span>VIBE CHECK</span>
    </button>
  </div>
</div>

<!-- FILTER -->
<div class="filter-sect">
  <div class="filter-top">
    <span class="filter-title">KESELARASAN</span>
    <span class="match-pct" id="vibePct">87%</span>
  </div>
  <input type="range" class="vibe-slider" id="vibeSlider" min="0" max="100" value="87" oninput="updateVibePct(this.value)">
  <div class="slider-labels"><span>Homie</span><span>Semi</span><span>All</span></div>
  <div class="mood-scroll">
    <button class="mood-chip active" data-mood="all" onclick="filterMood(this)">Semua</button>
    <button class="mood-chip" data-mood="surviving" onclick="filterMood(this)">üòÆ‚Äçüí® Surviving</button>
    <button class="mood-chip" data-mood="thriving" onclick="filterMood(this)">‚ú® Thriving</button>
    <button class="mood-chip" data-mood="chaotic" onclick="filterMood(this)">üåÄ Chaotic</button>
    <button class="mood-chip" data-mood="doom" onclick="filterMood(this)">üõå Doom</button>
  </div>
</div>

<!-- SPILLS -->
<div class="spills-sect">
  <div class="sect-header">
    <span class="sect-title">SPILL TERKINI</span>
    <span class="sect-meta">FIFO</span>
  </div>
  <div id="spillsList"></div>
  <button class="refresh-btn" onclick="refreshSpills()">
    <span>‚Üª</span>
    <span>Seduh Teh Baru</span>
  </button>
</div>

</div><!-- /scroll -->

<!-- BOTTOM NAV -->
<nav class="bnav">
  <div class="bnav-inner">
    <a href="jejak.html" class="nav-item">
      <span class="nav-icon">‚ú¶</span>
      <span>Jejak</span>
    </a>
    <a href="spill.html" class="nav-item active">
      <span class="nav-icon">‚úï</span>
      <span>Spill</span>
    </a>
    <a href="cocomeo.html" class="nav-item">
      <span class="nav-icon">„Äú</span>
      <span>Cocomeo</span>
    </a>
    <a href="glitch.html" class="nav-item">
      <span class="nav-icon">‚ö°</span>
      <span>Glitch</span>
    </a>
  </div>
</nav>

</div><!-- /app -->

<!-- GENDER MODAL -->
<div class="modal" id="genderModal">
  <div class="modal-header">
    <span class="modal-title">Vibe Check</span>
    <button class="modal-close" onclick="closeModal('genderModal')">‚úï</button>
  </div>
  <div class="modal-body">
    <div class="modal-tag">INIT_SESSION</div>
    <div class="modal-h">Siapa Kamu?</div>
    <div class="modal-sub">Ketemu stranger lawan jenis ‚Äî zero identity, zero history</div>
    <div class="gender-grid">
      <div class="gender-card" onclick="selectGender(this,'male')">
        <span class="gender-icon">‚ôÇ</span>
        <div class="gender-label">Pria</div>
        <div class="gender-desc">Match dengan wanita</div>
      </div>
      <div class="gender-card" onclick="selectGender(this,'female')">
        <span class="gender-icon">‚ôÄ</span>
        <div class="gender-label">Wanita</div>
        <div class="gender-desc">Match dengan pria</div>
      </div>
    </div>
    <div class="info-box">
      <p><strong>>> GRATIS 15 MENIT/HARI</strong><br>Tidak ada username. Chat FIFO 20 pesan. Tidak tersimpan.</p>
    </div>
    <button class="action-btn" id="genderConfirm" onclick="confirmGender()" disabled>Cari Stranger</button>
    <div class="modal-hint">Mau lebih lama? <strong style="color:var(--txs)">10k/minggu</strong> @2jam ¬∑ <strong style="color:var(--txs)">50k/bulan</strong> @3jam</div>
  </div>
</div>

<!-- UPGRADE MODAL -->
<div class="modal" id="upgradeModal">
  <div class="modal-header">
    <span class="modal-title">Waktu Habis</span>
    <button class="modal-close" onclick="closeModal('upgradeModal')">‚úï</button>
  </div>
  <div class="modal-body">
    <div class="timer-big">
      <div class="num">15:00</div>
      <div class="label">Sesi Gratis Selesai</div>
    </div>
    <div class="price-card" id="pc-weekly" onclick="selectPlan(this,'weekly')">
      <div>
        <div class="price-main">10K</div>
        <div class="price-sub">7 HARI ¬∑ 2 JAM/HARI</div>
      </div>
      <div class="price-right">
        <div class="price-tag">14 JAM</div>
        <div class="price-note">@1.428/jam</div>
      </div>
    </div>
    <div class="price-card" id="pc-monthly" onclick="selectPlan(this,'monthly')">
      <div>
        <div class="price-main">50K</div>
        <div class="price-sub">30 HARI ¬∑ 3 JAM/HARI</div>
      </div>
      <div class="price-right">
        <div class="price-tag">90 JAM</div>
        <div class="price-note">@555/jam</div>
      </div>
    </div>
    <div style="display:flex;gap:12px;margin-top:8px">
      <button class="action-btn" id="upgradeNow" onclick="upgradeNow()" disabled style="flex:1">Lanjut Chat</button>
      <button class="action-btn sec" onclick="closeModal('upgradeModal')" style="flex:1">Nanti</button>
    </div>
  </div>
</div>

<!-- CHAT ROOM -->
<div class="chat-room" id="chatRoom">
  <div class="chat-head">
    <div class="chat-info">
      <div class="chat-label">ANON CHAT // STRANGER</div>
      <div class="chat-name" id="chatPartnerName">Connecting...</div>
    </div>
    <div class="chat-timer" id="chatTimer">15:00</div>
    <button class="chat-close" onclick="closeChat()">‚úï</button>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="distress" id="distressBanner">Butuh bantuan? Into The Light: 119 ext 8</div>
  <div class="chat-input-wrap">
    <input type="text" class="chat-input" id="chatInput" placeholder="Ketik pesan..." maxlength="200">
    <button class="chat-send" onclick="sendMsg()">‚û§</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// STATE
let currentGender=null,chatPartner=null,timerInterval=null,chatTimeLeft=900;
let selectedPlan=null,activeMood='all',radarInterval,radarRAF=null,userName='stranger';

const AI_CHARS={
  female:[
    {name:'beby.manis',mood:['surviving','thriving','chaotic'],rants:["hari ini gue liat mantan sama cewek baru, dan tau gak? rambutnya lebih bagus dari rambut gue üò≠","cape bener jadi cewek, setiap bulan harus nahan sakit perut sambil tetep senyum di depan client","kenapa sih cowok kalo ditanya 'lagi apa' pasti jawabnya 'lagi main'? ga ada variasi lain?","gue lagi fase pengen dimengerti tanpa harus jelasin panjang lebar","bete banget skincare gue habis, padahal baru kemarin beli. ada yang ngutil?"]},
    {name:'strawberry.shortcake',mood:['surviving','doom','chaotic'],rants:["hari ini gue salah kirim chat pacar ke grup keluarga. isinya 'sayang udah mandi belom?' üò≠","kenapa orangtua selalu curiga kalo kita lagi seneng? 'lagi seneng-seneng ya? nanti belajar'","gue lagi diet, tapi tiap liat roti, rotinya yang liat gue duluan","stress skripsi tapi yang keluar peluh dan air mata doang","hari ini gue nangis karena ga bisa buka toples. lemah?"]},
    {name:'pretty.sad',mood:['doom','surviving'],rants:["kadang gue mikir, apa kita yang terlalu berharap atau emang janjinya ga pernah ditepatin?","hujan hari ini, tapi gaada yang tanya 'udah makan belom?'","capek pura-pura baik-baik aja. gue juga manusia, bisa hancur","kenapa ya orang lebih peduli sama 'kabar' daripada 'perasaan'?","malam ini gue lagi fase nerima kenyataan kalo dia ga akan balik"]},
    {name:'little.fairy',mood:['chaotic','thriving','surviving'],rants:["kalo gue jadi kucing, gue bakal tidur 20 jam sehari dan ga bakal di-judge malas","hari ini gue nangis karena liat video kura-kura lagi berantem. mereka kayak 'ga ada yang mundur!'","kok bisa sih orang dagang pake sound toa keras banget? emang gaada kerjaan lain?","gue percaya kalo alam semesta itu lagi iseng sama gue","ada yang percaya rejeki ga bakal kemana? gue, tapi tetep nangis tiap liat saldo"]},
    {name:'cinnamon.girl',mood:['doom','surviving'],rants:["hari ini gue nangis di angkot gegara liat kucing dipukul orang. mental gue udah kayak kerupuk kena hujan.","kenapa sih orang jahat bisa tidur nyenyak? gue yang baik aja susah tidur","hari ini gue bantu orang, eh malah dijadiin 'teman curhat' seharian. capek fisik mental","tolong kasih gue tanda kalo dunia ini ga sekejam kelihatannya","lagi fase sulit bilang 'ga' ke orang. jadi numpuk kerjaan sendiri"]}
  ],
  male:[
    {name:'si.badai',mood:['doom','surviving','chaotic'],rants:["hari ini gue ditagih utang sama mantan. utang apa? utang perasaan katanya","capek jadi orang yang dianggap kuat terus. gue juga pengen nangis dipeluk","kenapa sih kalo udah malem suka overthinking? badan capek tapi pikiran lari maraton","jadi cowok tuh gaboleh lemah katanya. tapi dalemnya ancur","gue capek jadi 'tembok' tempat orang bersandar. giliran gue butuh sandaran, pada pergi"]},
    {name:'moon.child',mood:['doom','surviving'],rants:["malam ini gue liat bulan sendirian. sama kayak gue. tapi bulan masih punya bintang.","kenapa cinta harus pergi? apa karena gue ga bisa jadi alasan buat dia bertahan?","hari ini gue dapet kabar doi udah tunangan. selamat ya, semoga dia bahagia (gue bohong)","capek nungguin orang yang ga pasti. tapi lebih capek ngelepasinnya","jangan tanya gue 'kabar baik?'. kabar gue baik-baik aja, cuma hati lagi berdarah-darah"]},
    {name:'si.kocak',mood:['chaotic','surviving'],rants:["hidup tuh kayak sinetron. kadang bahagia, kadang nangis, tapi endingnya selalu bikin kesel","hari ini gue ditilang polisi. katanya motor gue terlalu keren. padahal cuma mau pamer","stress mikirin masa depan. solusi gue: tidur. besok dipikirin lagi. atau lusa","orang bilang kalo kamu ketawa berarti kamu bahagia. berarti gue artis pemenang Oscar","hari ini gue ketawa terbahak-bahak. abis itu nangis. abis itu ketawa lagi. am i okay?"]},
    {name:'si.pedas',mood:['chaotic','thriving','surviving'],rants:["hari ini gue dikatain 'kamu berubah'. iya lah, gua bukan nasi bisa tetep sama","tolong ya, kalo chat itu dibales. jangan cuma diliat doang, matanya apa hpnya yang liat?","ada yang bilang 'kerja keras ga akan khianati hasil'. hasilnya: gue dikhianati sama kesehatan","lagi fase males bales chat semua orang. bukan depresi, cuma lagi males sama dunia","orang suka bilang 'sabar ya'. gue pengen jawab 'sabarin aja tai'"]},
    {name:'mba.gaul',mood:['chaotic','surviving','doom'],rants:["hari ini gue liat orang bawa balon. mungkin balon itu temen curhatnya","kenapa sih kalo lagi di kamar mandi suka inget kejadian memalukan 5 tahun lalu?","gue pengen jadi kucing tetangga. tidur, makan, tidur lagi, ga pernah mikir cicilan","hari ini gue nangis gegara kehabisan kuota pas lagi nonton drakor climax","ada yang pernah ngerasa jadi orang paling sendiri di keramaian? iyalah kita di jalan tol"]}
  ]
};

const USER_RANTS=[
  {id:1,author:'anon.kucing',mood:'surviving',content:'Hari ini gue nangis di angkot gegara liat kucing dipukul orang. Mental gue udah kayak kerupuk kena hujan.',reactions:{skull:42,cry:89,fire:12,upside:7},userReacted:null},
  {id:2,author:'sleepy.head',mood:'thriving',content:'akhirnya bisa tidur nyenyak semalaman setelah 3 minggu insomnia. makasih buat yang chat tadi malem.',reactions:{skull:23,cry:15,fire:67,upside:31},userReacted:null},
  {id:3,author:'chaos.queen',mood:'chaotic',content:'hari ini chaos abis! dari bangun tidur udah salah ambil kaki, sampe kantor lupa bawa laptop.',reactions:{skull:89,cry:23,fire:45,upside:78},userReacted:null},
  {id:4,author:'quiet.one',mood:'doom',content:'udah seminggu nggak keluar kamar. bukan karena sibuk. cuma nggak tau mau ngapain.',reactions:{skull:67,cry:112,fire:8,upside:34},userReacted:null}
];

const REACTION_EMOJI={skull:'üíÄ',cry:'üò≠',fire:'üî•',upside:'üôÉ'};
const $=id=>document.getElementById(id);
const esc=t=>{const d=document.createElement('div');d.textContent=t;return d.innerHTML};

function toast(msg,isErr=false){
  const t=$('toast');
  t.textContent=msg;
  t.className='toast'+(isErr?' error':'');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

function closeModal(id){$(id).classList.remove('on');}
function updateVibePct(val){$('vibePct').textContent=val+'%';}

function filterMood(btn){
  document.querySelectorAll('.mood-chip').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  activeMood=btn.dataset.mood;
  renderSpills();
}

// SPILLS
function generateAIRants(count=3){
  const rants=[];
  let nextId=Math.max(...USER_RANTS.map(u=>u.id))+1;
  for(let i=0;i<count;i++){
    const gender=Math.random()>.5?'female':'male';
    const char=AI_CHARS[gender][Math.floor(Math.random()*AI_CHARS[gender].length)];
    const mood=char.mood[Math.floor(Math.random()*char.mood.length)];
    rants.push({
      id:nextId++,
      author:char.name,
      isAI:true,
      mood,
      content:char.rants[Math.floor(Math.random()*char.rants.length)],
      reactions:{skull:Math.floor(Math.random()*50),cry:Math.floor(Math.random()*100),fire:Math.floor(Math.random()*40),upside:Math.floor(Math.random()*30)},
      userReacted:null
    });
  }
  return rants;
}

function renderSpills(){
  const list=$('spillsList');
  const allSpills=[...USER_RANTS,...generateAIRants(6)];
  const filtered=activeMood==='all'?allSpills:allSpills.filter(s=>s.mood===activeMood);
  
  if(!filtered.length){
    list.innerHTML='<div class="empty-state"><div class="empty-icon">üçÉ</div><div class="empty-title">Belum ada spill</div><div class="empty-text">Coba filter lain</div></div>';
    return;
  }
  
  list.innerHTML=filtered.map(s=>`
    <div class="spill-card">
      <div class="spill-head">
        <span class="spill-user">@${esc(s.author)}${s.isAI?' ü§ñ':''}</span>
        <span class="spill-mood ${s.mood}">${s.mood}</span>
      </div>
      <div class="spill-body">${esc(s.content)}</div>
      <div class="spill-actions">
        ${Object.entries(REACTION_EMOJI).map(([k,em])=>`
          <button class="react-btn ${s.userReacted===k?'active':''}" onclick="react(this,${s.id},'${k}')">
            ${em}<span class="react-count" id="rc-${s.id}-${k}">${s.reactions[k]}</span>
          </button>
        `).join('')}
      </div>
    </div>
  `).join('');
}

function react(btn,id,key){
  const spill=[...USER_RANTS,...generateAIRants(0)].find(s=>s.id===id);
  if(!spill)return;
  const was=btn.classList.contains('active');
  document.querySelectorAll(`[id^="rc-${id}-"]`).forEach(el=>el.closest('button').classList.remove('active'));
  was?spill.reactions[key]--:(spill.reactions[key]++,btn.classList.add('active'));
  spill.userReacted=was?null:key;
  Object.keys(spill.reactions).forEach(k=>{
    const el=$(`rc-${id}-${k}`);
    if(el)el.textContent=spill.reactions[k];
  });
}

function refreshSpills(){renderSpills();toast('Teh baru diseduh ‚òï');}

// RADAR BELL & ROSS - FIXED NEEDLE
let radarDots=[],radarAngle=0,radarRAF=null;
const SWEEP_SPEED=Math.PI*2/(4*60); // 4 seconds per rotation

function initRadar(){
  const canvas=$('radarCanvas');
  const display=$('radarDisplay');
  
  // Set canvas size to match display
  function resize(){
    const rect=display.getBoundingClientRect();
    // Use actual pixel size for crisp rendering
    const dpr=window.devicePixelRatio||1;
    canvas.width=rect.width*dpr;
    canvas.height=rect.height*dpr;
    canvas.style.width=rect.width+'px';
    canvas.style.height=rect.height+'px';
    
    const ctx=canvas.getContext('2d');
    ctx.scale(dpr,dpr);
  }
  
  resize();
  window.addEventListener('resize',resize,{passive:true});
  
  spawnDots();
  
  // Move dots periodically
  radarInterval=setInterval(()=>{
    radarDots.forEach(d=>{
      d.x=Math.max(10,Math.min(90,d.x+(Math.random()-.5)*2));
      d.y=Math.max(10,Math.min(90,d.y+(Math.random()-.5)*2));
      d.el.style.left=d.x+'%';
      d.el.style.top=d.y+'%';
    });
  },3000);
  
  $('quotaBadge').innerHTML=Math.floor(18+Math.random()*15)+'<span class="radar-stat-unit">USERS</span>';
  
  // Start animation loop
  radarLoop(canvas);
}

function spawnDots(){
  const con=$('radarDots');
  con.innerHTML='';
  radarDots=[];
  const count=6+Math.floor(Math.random()*4);
  
  for(let i=0;i<count+2;i++){
    const isAI=i>=count;
    const angle=Math.random()*Math.PI*2;
    const dist=15+Math.random()*65;
    const x=50+Math.cos(angle)*dist/2;
    const y=50+Math.sin(angle)*dist/2;
    
    const dot=document.createElement('div');
    const type=isAI?'ai':(Math.random()>.5?'purple':'red');
    dot.className='radar-dot '+type;
    dot.style.left=x+'%';
    dot.style.top=y+'%';
    con.appendChild(dot);
    
    radarDots.push({el:dot,x,y,type});
  }
}

function radarLoop(canvas){
  const ctx=canvas.getContext('2d');
  
  function frame(){
    // Get CSS size (not canvas pixel size)
    const rect=canvas.getBoundingClientRect();
    const W=rect.width;
    const H=rect.height;
    const cx=W/2;
    const cy=H/2;
    const R=Math.min(cx,cy)*0.85;
    
    // Update angle
    radarAngle=(radarAngle+SWEEP_SPEED)%(Math.PI*2);
    
    // Clear with fade effect (phosphor persistence)
    ctx.fillStyle='rgba(0,0,0,0.15)';
    ctx.fillRect(0,0,W,H);
    
    // Draw sweep
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(radarAngle);
    
    // Sweep gradient
    const gradient=ctx.createLinearGradient(0,0,R,0);
    gradient.addColorStop(0,'rgba(0,255,65,1)');
    gradient.addColorStop(0.3,'rgba(0,255,65,0.6)');
    gradient.addColorStop(0.7,'rgba(0,255,65,0.2)');
    gradient.addColorStop(1,'rgba(0,255,65,0)');
    
    // Draw sweep wedge
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,R,-0.15,0.15);
    ctx.closePath();
    ctx.fillStyle=gradient;
    ctx.fill();
    
    // Center pivot
    ctx.beginPath();
    ctx.arc(0,0,3,0,Math.PI*2);
    ctx.fillStyle='#00ff41';
    ctx.shadowColor='#00ff41';
    ctx.shadowBlur=10;
    ctx.fill();
    ctx.shadowBlur=0;
    
    ctx.restore();
    
    // Check dot collisions
    radarDots.forEach(d=>{
      const px=d.x/100*W;
      const py=d.y/100*H;
      const dx=px-cx;
      const dy=py-cy;
      let dotAngle=Math.atan2(dy,dx);
      if(dotAngle<0)dotAngle+=Math.PI*2;
      
      let diff=radarAngle-dotAngle;
      if(diff<0)diff+=Math.PI*2;
      if(diff>Math.PI)diff=Math.PI*2-diff;
      
      // Hit detection
      if(diff<0.1){
        d.el.classList.add('hit');
        setTimeout(()=>d.el.classList.remove('hit'),500);
        
        // Draw hit glow on canvas
        const col=d.type==='purple'?[176,38,255]:d.type==='red'?[255,0,64]:[0,255,65];
        const grd=ctx.createRadialGradient(px,py,0,px,py,25);
        grd.addColorStop(0,`rgba(${col[0]},${col[1]},${col[2]},0.8)`);
        grd.addColorStop(0.5,`rgba(${col[0]},${col[1]},${col[2]},0.3)`);
        grd.addColorStop(1,`rgba(${col[0]},${col[1]},${col[2]},0)`);
        ctx.beginPath();
        ctx.arc(px,py,25,0,Math.PI*2);
        ctx.fillStyle=grd;
        ctx.fill();
      }
    });
    
    radarRAF=requestAnimationFrame(frame);
  }
  
  radarRAF=requestAnimationFrame(frame);
}

// VIBE CHECK
function startVibeCheck(){$('genderModal').classList.add('on');}

function selectGender(el,g){
  document.querySelectorAll('.gender-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  currentGender=g;
  $('genderConfirm').disabled=false;
}

function confirmGender(){
  if(!currentGender)return;
  closeModal('genderModal');
  userName='stranger';
  findRealUserFirst();
}

async function findRealUserFirst(){
  $('chatMessages').innerHTML='';
  $('distressBanner').classList.remove('show');
  $('chatRoom').classList.add('on');
  $('chatPartnerName').textContent='MENCARI...';
  
  const el=document.createElement('div');
  el.className='chat-bubble them';
  el.style.alignSelf='center';
  el.style.fontStyle='italic';
  el.style.borderStyle='dashed';
  el.style.borderColor='var(--aq)';
  el.style.color='var(--txs)';
  el.id='searching-indicator';
  el.textContent='üîç sedang dicarikan teman ngobrol...';
  $('chatMessages').appendChild(el);
  
  let t=60;
  const searchTimer=setInterval(()=>{
    t--;
    const e=$('searching-indicator');
    if(e)e.textContent=`üîç mencari teman... (${t}s)`;
    if(t<=0){
      clearInterval(searchTimer);
      if($('searching-indicator')){
        $('searching-indicator').remove();
        fallbackToAI();
      }
    }
  },1000);
  
  if(Math.random()<.4){
    setTimeout(()=>{
      clearInterval(searchTimer);
      if($('searching-indicator')){
        $('searching-indicator').remove();
        const opp=currentGender==='male'?'female':'male';
        const names=opp==='female'?['jessica','amanda','sarah','diana','melanie']:['kevin','brian','alex','steven','jordan'];
        chatPartner={name:names[Math.floor(Math.random()*names.length)],isAI:false,gender:opp};
        startRealChat();
      }
    },5000+Math.random()*25000);
  }
}

function fallbackToAI(){
  const opp=currentGender==='male'?'female':'male';
  const char=AI_CHARS[opp][Math.floor(Math.random()*AI_CHARS[opp].length)];
  chatPartner={name:char.name,isAI:true,gender:opp,charData:char};
  toast('üí¨ Ditemani AI dulu ya');
  startRealChat();
}

function startRealChat(){
  chatTimeLeft=900;
  $('chatMessages').innerHTML='';
  $('distressBanner').classList.remove('show');
  $('chatPartnerName').textContent='STRANGER_'+String(Math.floor(Math.random()*99)).padStart(2,'0');
  startTimer();
  setTimeout(()=>{
    const g=chatPartner.isAI
      ?[`hai! gue ${chatPartner.name}. lagi apa?`,`halo~ kenalin gue ${chatPartner.name}`,`akhirnya ketemu. gue ${chatPartner.name}`,`haiii, gue ${chatPartner.name}. lagi apa nih?`]
      :['halo! ada cerita apa hari ini? üëã','hei, akhirnya nyambung juga','hai! lagi gimana?'];
    addMsg(g[Math.floor(Math.random()*g.length)],false);
  },800);
}

function closeChat(){
  clearInterval(timerInterval);
  timerInterval=null;
  $('chatRoom').classList.remove('on');
  toast('üëã Sampai jumpa!');
}

function startTimer(){
  updateTimer();
  timerInterval=setInterval(()=>{
    chatTimeLeft--;
    updateTimer();
    if(chatTimeLeft===300)toast('‚ö†Ô∏è Sisa 5 menit! Upgrade untuk lanjut.');
    if(chatTimeLeft<=0)endChat();
  },1000);
}

function updateTimer(){
  const m=Math.floor(chatTimeLeft/60),s=chatTimeLeft%60;
  $('chatTimer').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  $('chatTimer').classList.toggle('warn',chatTimeLeft<=300);
}

function endChat(){
  clearInterval(timerInterval);
  timerInterval=null;
  $('chatRoom').classList.remove('on');
  $('upgradeModal').classList.add('on');
}

// TYPING ENGINE
class TypingEngine{
  showTypingIndicator(){
    const el=document.createElement('div');
    el.className='typing';
    el.id='typing-indicator-real';
    el.innerHTML='<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
    $('chatMessages').appendChild(el);
    $('chatMessages').scrollTop=9999;
    return el;
  }
  
  async typeMessage(text){
    const container=$('chatMessages');
    const msgDiv=document.createElement('div');
    msgDiv.className='chat-bubble them';
    container.appendChild(msgDiv);
    
    let typed='';
    for(let i=0;i<text.length;i++){
      typed+=text[i];
      msgDiv.textContent=typed;
      
      let delay=40+Math.random()*80;
      if(text[i]===','||text[i]===';')delay=200;
      if(text[i]==='.'||text[i]==='?'||text[i]==='!')delay=400;
      await this.sleep(delay);
    }
    
    const time=document.createElement('div');
    time.className='chat-time';
    time.textContent=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
    msgDiv.appendChild(time);
    
    container.scrollTop=container.scrollHeight;
  }
  
  sleep(ms){return new Promise(r=>setTimeout(r,ms));}
}
const typingEngine=new TypingEngine();

function generateAIRant(){
  if(!chatPartner?.isAI||!chatPartner?.charData)return null;
  const char=chatPartner.charData;
  const rant=char.rants[Math.floor(Math.random()*char.rants.length)];
  const mood=char.mood?.length?char.mood[Math.floor(Math.random()*char.mood.length)]:'surviving';
  return{text:rant,mood};
}

async function sendMsg(){
  const inp=$('chatInput'),text=inp.value.trim();
  if(!text)return;
  
  addMsg(text,true);
  inp.value='';
  
  const delay=Math.min(3000,Math.max(800,text.length*120))*(0.7+Math.random()*.6);
  const ind=typingEngine.showTypingIndicator();
  
  if(chatPartner?.isAI){
    setTimeout(async()=>{
      ind.remove();
      if(Math.random()<.3){
        const rant=generateAIRant();
        if(rant){
          await typingEngine.typeMessage(rant.text);
          if(rant.mood==='doom'||rant.mood==='surviving')$('distressBanner').classList.add('show');
        }
      }else{
        const r=['haha iya gitu deh','sama wkwk','eh gue juga gitu','nggak nyangka lo jg','ya ampun relate banget'];
        await typingEngine.typeMessage(r[Math.floor(Math.random()*r.length)]);
      }
    },delay);
  }else{
    const r=['haha iya gitu deh','sama wkwk','eh gue juga','nggak nyangka lo jg','ya ampun relate'];
    setTimeout(async()=>{
      ind.remove();
      if(Math.random()<.75)await typingEngine.typeMessage(r[Math.floor(Math.random()*r.length)]);
    },delay);
  }
}

function addMsg(text,isOwn){
  const div=document.createElement('div');
  div.className='chat-bubble '+(isOwn?'me':'them');
  const time=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
  div.innerHTML=esc(text)+`<div class="chat-time">${time}</div>`;
  const msgs=$('chatMessages');
  msgs.appendChild(div);
  while(msgs.children.length>20)msgs.removeChild(msgs.firstChild);
  msgs.scrollTop=9999;
}

function selectPlan(el,plan){
  document.querySelectorAll('.price-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPlan=plan;
  $('upgradeNow').disabled=false;
}

function upgradeNow(){
  if(!selectedPlan)return;
  toast('üîÑ Memproses upgrade...');
  setTimeout(()=>{
    toast('‚úÖ Upgrade berhasil!');
    closeModal('upgradeModal');
    if(chatPartner){
      chatTimeLeft=selectedPlan==='weekly'?7200:10800;
      $('chatRoom').classList.add('on');
      clearInterval(timerInterval);
      startTimer();
      addMsg('obrolan dilanjut!',false);
    }
  },1500);
}

// INIT
document.addEventListener('DOMContentLoaded',()=>{
  initRadar();
  renderSpills();
  $('chatInput').addEventListener('keydown',e=>{if(e.key==='Enter')sendMsg();});
});
</script>
</body>
</html>
