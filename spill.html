<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Spill ‚Äî JEJAK</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Share+Tech+Mono&family=Oswald:wght@700&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ TOKENS (same as Jejak) ‚îÄ‚îÄ */
:root{--bg:#0A0A0A;--sf:#141414;--sfe:#1E1E1E;--bd:#2A2A2A;--tx:#FFF;--txs:#888;--txm:#555;--ap:#FF4D00;--as:#00F0FF;--at:#FF006E;--aq:#39FF14;--ms:#FF9500;--mt:#39FF14;--mc:#00F0FF;--md:#8B5CF6;--gn:#39FF14}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:'Plus Jakarta Sans',system-ui,sans-serif;font-weight:500;font-size:15px;line-height:1.4;min-height:100vh;overflow-x:hidden;padding-bottom:100px}
/* noise grain ‚Äî identical to Jejak */
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:.4}
.w{max-width:480px;margin:0 auto;padding:0 16px}

/* ‚îÄ‚îÄ HEADER ‚Äî same as Jejak ‚îÄ‚îÄ */
header{padding:24px 0 16px;display:flex;justify-content:space-between;align-items:flex-start}
.logo{font-size:42px;font-weight:800;letter-spacing:-.04em;line-height:.9;cursor:default}
.logo span{color:var(--ap)}
.tagline{font-family:'Instrument Serif',serif;font-size:13px;color:var(--txs);font-style:italic;margin-top:4px}
.top-right{display:flex;align-items:center;gap:8px;padding-top:6px}
.conn-dot{width:8px;height:8px;background:var(--aq);border-radius:50%;animation:blink 2s infinite;flex-shrink:0}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.menu-trigger{width:32px;height:32px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;background:transparent;border:none;cursor:pointer}
.menu-trigger span{width:4px;height:4px;background:var(--tx);border-radius:50%;transition:all .2s}
.menu-trigger:hover span{background:var(--ap)}

/* ‚îÄ‚îÄ RADAR ‚Äî Bell & Ross panel, full-bleed like Jejak .hero-s ‚îÄ‚îÄ */
.radar-wrap{position:relative;margin:0 -16px 24px;border-top:2px solid var(--bd);border-bottom:2px solid var(--bd)}
.radar-hero{
  width:100%;position:relative;
  background:linear-gradient(160deg,#303030 0%,#1a1a1a 20%,#0e0e0e 50%,#181818 80%,#242424 100%);
  padding:42px 36px 58px 36px;
}
/* 4 screws */
.radar-hero::before,.radar-hero::after,.screw-bl,.screw-br{
  position:absolute;width:28px;height:28px;border-radius:50%;z-index:50;
  background:
    linear-gradient(0deg,transparent 41%,rgba(0,0,0,.95) 41%,rgba(0,0,0,.95) 59%,transparent 59%),
    linear-gradient(90deg,transparent 41%,rgba(0,0,0,.95) 41%,rgba(0,0,0,.95) 59%,transparent 59%),
    linear-gradient(0deg,transparent 43%,rgba(255,255,255,.06) 45%,rgba(255,255,255,.06) 55%,transparent 57%),
    linear-gradient(90deg,transparent 43%,rgba(255,255,255,.06) 45%,rgba(255,255,255,.06) 55%,transparent 57%),
    radial-gradient(circle at 36% 30%,#888 0%,#666 15%,#444 35%,#2c2c2c 60%,#181818 100%);
  box-shadow:0 3px 6px rgba(0,0,0,.95),inset 0 2px 2px rgba(255,255,255,.22),inset -1px -1px 2px rgba(0,0,0,.8),0 0 0 3px #080808,0 0 0 5px #303030,0 0 0 6px #080808;
}
.radar-hero::before{content:'';top:14px;left:14px}
.radar-hero::after{content:'';top:14px;right:14px}
.screw-bl{bottom:14px;left:14px}
.screw-br{bottom:14px;right:14px}
/* CRT screen */
.radar-container{position:relative;width:100%;aspect-ratio:1/1;overflow:hidden;background:radial-gradient(ellipse at 40% 40%,#0d1f0d 0%,#050e05 60%,#020802 100%);box-shadow:inset 0 0 0 1px #1a2a1a,inset 0 0 60px rgba(0,0,0,.8),inset 0 0 120px rgba(0,20,0,.6)}
.radar-container::before{content:'';position:absolute;inset:0;z-index:40;pointer-events:none;background:radial-gradient(ellipse at 25% 20%,rgba(255,255,255,.04) 0%,transparent 55%),linear-gradient(180deg,rgba(255,255,255,.015) 0%,transparent 30%)}
.radar-container::after{content:'';position:absolute;inset:0;z-index:41;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,.08) 3px,rgba(0,0,0,.08) 4px)}
.radar-grid{position:absolute;inset:0;opacity:.12;background-image:repeating-linear-gradient(0deg,rgba(57,255,20,.4) 0px,transparent 1px,transparent 28px),repeating-linear-gradient(90deg,rgba(57,255,20,.4) 0px,transparent 1px,transparent 28px)}
.radar-circles{position:absolute;inset:4%;border-radius:50%;box-shadow:inset 0 0 0 1px rgba(57,255,20,.35)}
.radar-circles::before,.radar-circles::after{content:'';position:absolute;inset:25%;border-radius:50%;box-shadow:inset 0 0 0 1px rgba(57,255,20,.2)}
.radar-circles::after{inset:50%;box-shadow:inset 0 0 0 1px rgba(57,255,20,.15)}
.radar-crosshair{position:absolute;inset:0;z-index:8;pointer-events:none;background:linear-gradient(90deg,transparent calc(50% - .5px),rgba(57,255,20,.15) calc(50% - .5px),rgba(57,255,20,.15) calc(50% + .5px),transparent calc(50% + .5px)),linear-gradient(0deg,transparent calc(50% - .5px),rgba(57,255,20,.15) calc(50% - .5px),rgba(57,255,20,.15) calc(50% + .5px),transparent calc(50% + .5px))}
.radar-line,.radar-sweep{display:none}
.radar-dot{position:absolute;border-radius:50%;transform:translate(-50%,-50%);z-index:30;cursor:pointer;opacity:.35;transition:opacity .1s}
.radar-dot:hover{transform:translate(-50%,-50%) scale(2.2);z-index:50;opacity:1}
.radar-dot.purple{background:#B026FF}.radar-dot.red{background:#FF3333}.radar-dot.ai{background:var(--gn)}
.radar-canvas{position:absolute;inset:0;width:100%;height:100%;z-index:22;pointer-events:none}
.radar-overlay{position:absolute;inset:0;z-index:34;pointer-events:none}
/* Panel lettering */
.radar-title{font-family:'Oswald',sans-serif;font-weight:700;font-size:11px;text-transform:uppercase;letter-spacing:8px;color:rgba(57,255,20,.5);text-shadow:0 0 8px rgba(57,255,20,.3);position:absolute;top:0;left:0;right:0;height:42px;display:flex;align-items:center;justify-content:center;white-space:nowrap;z-index:35;pointer-events:none}
.radar-footer{position:absolute;bottom:0;left:56px;right:36px;height:58px;display:flex;justify-content:space-between;align-items:center;z-index:36}
.quota-display{display:flex;align-items:center;gap:6px}
.quota-badge{font-family:'Share Tech Mono',monospace;color:var(--gn);font-size:22px;line-height:1;text-shadow:0 0 10px var(--gn),0 0 20px rgba(57,255,20,.35);letter-spacing:-1px}
.quota-text{font-family:'Share Tech Mono',monospace;color:rgba(57,255,20,.4);font-size:8px;text-transform:uppercase;letter-spacing:1.5px;line-height:1.3}
/* VIBE CHECK btn ‚Äî Jejak .upbtn style but with Oswald label */
.vibe-check-btn{font-family:'Oswald',sans-serif;font-weight:700;letter-spacing:2px;background:var(--ap);color:#000;border:none;padding:10px 18px;font-size:12px;text-transform:uppercase;cursor:pointer;box-shadow:4px 4px 0 rgba(0,0,0,.8);display:inline-flex;align-items:center;gap:6px;transition:all .2s}
.vibe-check-btn:hover{transform:translate(2px,2px);box-shadow:2px 2px 0 rgba(0,0,0,.8)}
.vibe-check-btn:active{transform:translate(4px,4px);box-shadow:none}

/* ‚îÄ‚îÄ SECTION DIVIDER ‚Äî exact Jejak .shdr ‚îÄ‚îÄ */
.shdr{display:flex;align-items:center;gap:8px;margin-bottom:16px;padding-bottom:8px;border-bottom:2px solid var(--bd)}
.stit{font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.15em;color:var(--tx)}
.sline{flex:1;height:2px;background:var(--bd)}
.shdr-meta{font-size:10px;color:var(--txm);white-space:nowrap}

/* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
.filter-wrap{margin-bottom:24px}
.filter-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.filter-label{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--txs);display:flex;align-items:center;gap:6px}
.vibe-pct{color:var(--ap);font-weight:800;font-size:15px}
/* reset btn ‚Äî Jejak secondary button style */
.reset-btn{padding:6px 12px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;background:transparent;border:2px solid var(--bd);color:var(--txm);cursor:pointer;transition:all .15s;font-family:inherit}
.reset-btn:hover{border-color:var(--ap);color:var(--ap)}
.vibe-slider{width:100%;height:4px;background:var(--bd);outline:none;-webkit-appearance:none;margin-bottom:8px;display:block}
.vibe-slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:var(--ap);border:2px solid var(--tx);cursor:pointer;box-shadow:2px 2px 0 var(--bg)}
.vibe-labels{display:flex;justify-content:space-between;font-size:9px;color:var(--txm);text-transform:uppercase;letter-spacing:.06em;margin-bottom:16px;font-weight:700}
.mood-filters{display:flex;flex-wrap:wrap;gap:6px}
/* mood btns ‚Äî same border style as Jejak .mc */
.mood-btn{padding:7px 14px;background:var(--sf);border:2px solid var(--bd);color:var(--txs);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;cursor:pointer;transition:all .15s;font-family:inherit}
.mood-btn.active{background:var(--ap);border-color:var(--ap);color:#000}
.mood-btn:hover:not(.active){border-color:var(--txs);color:var(--tx);transform:translateY(-1px)}

/* ‚îÄ‚îÄ SPILL CARDS ‚Äî Jejak .entry style ‚îÄ‚îÄ */
.content-area{min-height:160px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 0}
.content-area.has-content{padding:0;align-items:stretch;justify-content:flex-start}
.spinner{width:36px;height:36px;border:3px solid var(--bd);border-top-color:var(--ap);border-radius:50%;animation:sp 1s linear infinite;margin-bottom:12px}
@keyframes sp{to{transform:rotate(360deg)}}
.loading-text{font-size:10px;color:var(--txs);text-transform:uppercase;letter-spacing:.15em;font-weight:700}
/* card = .entry */
.spill-card{background:var(--sf);border:2px solid var(--bd);margin-bottom:16px;position:relative;animation:si .4s ease;transition:border-color .15s}
@keyframes si{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.spill-card:hover{border-color:var(--ap)}
/* header bar = .ehdr */
.spill-header{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;border-bottom:1px solid var(--bd);background:var(--sfe)}
.spill-author{font-size:11px;font-weight:700;color:var(--txm);letter-spacing:.05em;cursor:pointer;transition:color .15s}
.spill-author:hover{color:var(--ap)}
/* mood badge = .emood */
.spill-mood{font-size:10px;font-weight:700;padding:4px 8px;border:1px solid currentColor;text-transform:uppercase;letter-spacing:.1em}
.spill-mood.surviving{color:var(--ms)}
.spill-mood.thriving{color:var(--mt)}
.spill-mood.chaotic{color:var(--mc)}
.spill-mood.doom{color:var(--md)}
/* body = .econt */
.spill-content{padding:16px;font-size:15px;line-height:1.6;color:var(--tx)}
/* reaction bar ‚Äî Jejak .reaction-bar */
.spill-reactions{display:flex;align-items:center;padding:8px 16px;border-top:1px solid var(--bd);background:var(--sfe);gap:6px;flex-wrap:wrap}
.reaction-btn{position:relative;display:flex;align-items:center;gap:4px;padding:5px 10px;background:var(--sf);border:2px solid var(--bd);cursor:pointer;transition:all .15s;border-radius:4px;font-family:inherit}
.reaction-btn:hover{border-color:var(--txs);transform:translateY(-2px);background:var(--sfe)}
.reaction-btn.reacted{border-color:var(--ap);background:var(--ap)}
.reaction-btn.reacted .reaction-count{color:#000}
.reaction-count{font-size:11px;font-weight:700;color:var(--txs);min-width:14px;text-align:center;font-variant-numeric:tabular-nums}

/* refresh btn ‚Äî Jejak .sbtn secondary */
.new-spill-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:14px;background:transparent;border:2px solid var(--bd);color:var(--txm);font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;cursor:pointer;margin-top:8px;margin-bottom:32px;transition:all .15s;font-family:inherit}
.new-spill-btn:hover{border-color:var(--ap);color:var(--ap);box-shadow:4px 4px 0 var(--ap)}
.new-spill-btn:hover .nbtn-icon{transform:rotate(180deg)}
.nbtn-icon{transition:transform .3s}

/* empty */
.empty-state{padding:40px 16px;text-align:center;border:2px dashed var(--bd)}
.empty-icon{font-size:40px;margin-bottom:14px;display:block;animation:fl 3s ease-in-out infinite}
@keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.empty-text{font-family:'Instrument Serif',serif;font-size:18px;font-style:italic;color:var(--txs);margin-bottom:6px}
.empty-subtext{font-size:11px;color:var(--txm)}

/* ‚îÄ‚îÄ TOAST ‚Äî same as Jejak ‚îÄ‚îÄ */
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--tx);color:var(--bg);padding:8px 16px;font-size:13px;font-weight:600;z-index:10000;opacity:0;transition:all .3s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.error{background:#FF3333;color:var(--tx)}

/* ‚îÄ‚îÄ MODALS ‚Äî Jejak flat style ‚îÄ‚îÄ */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.97);z-index:20000;padding:16px;overflow-y:auto}
.modal.on{display:block}
.modal-box{max-width:480px;margin:40px auto 0;background:var(--sf);border:2px solid var(--bd);padding:24px}
.modal-tag{font-size:10px;font-weight:800;color:var(--ap);letter-spacing:.2em;text-transform:uppercase;margin-bottom:10px;display:block}
.modal-title{font-size:30px;font-weight:800;text-transform:uppercase;letter-spacing:-.02em;margin-bottom:4px}
.modal-sub{font-family:'Instrument Serif',serif;font-size:14px;font-style:italic;color:var(--txs);margin-bottom:24px}
/* gender picks = Jejak .mc */
.gender-options{display:flex;gap:10px;margin-bottom:20px}
.gender-opt{flex:1;background:var(--sfe);border:2px solid var(--bd);padding:20px 10px;text-align:center;cursor:pointer;transition:all .15s;position:relative}
.gender-opt:hover{border-color:var(--txs);transform:translateY(-2px)}
.gender-opt.selected{border-color:var(--ap)}
.gender-opt.selected::after{content:'‚úì';position:absolute;top:8px;right:8px;color:var(--ap);font-size:12px;font-weight:700}
.gender-icon{font-size:36px;margin-bottom:8px;display:block}
.gender-label{font-size:14px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;margin-bottom:3px}
.gender-desc{font-size:11px;color:var(--txs)}
.modal-note{background:var(--sfe);border-left:3px solid var(--ap);padding:12px 14px;margin-bottom:18px;font-size:12px;color:var(--txs);line-height:1.5}
.modal-note strong{color:var(--ap)}
/* primary btn = Jejak .sbtn */
.modal-confirm{width:100%;padding:14px;background:var(--ap);color:#000;border:none;font-size:14px;font-weight:800;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;transition:all .2s;box-shadow:4px 4px 0 var(--sfe),4px 4px 0 2px var(--ap);font-family:inherit}
.modal-confirm:hover:not(:disabled){transform:translate(2px,2px);box-shadow:2px 2px 0 var(--sfe),2px 2px 0 2px var(--ap)}
.modal-confirm:disabled{opacity:.4;cursor:not-allowed;box-shadow:none}
/* upgrade */
.upgrade-tag{color:#FF3333}
.upgrade-title{color:#FF3333}
.timer-warn{background:var(--sfe);border:2px solid #FF3333;padding:20px;margin-bottom:18px;text-align:center}
.timer-warn .big{font-size:48px;font-weight:800;color:#FF3333;line-height:1;margin-bottom:6px;font-variant-numeric:tabular-nums;font-family:'Share Tech Mono',monospace}
.timer-warn .small{font-size:10px;color:var(--txs);text-transform:uppercase;letter-spacing:.2em;font-weight:700}
.pricing-grid{display:flex;flex-direction:column;gap:10px;margin-bottom:18px}
.pricing-card{background:var(--sfe);border:2px solid var(--bd);padding:14px 16px;cursor:pointer;transition:border-color .15s;position:relative;display:flex;align-items:center;gap:16px}
.pricing-card:hover{border-color:var(--ap);transform:translateY(-1px)}
.pricing-card.selected{border-color:var(--ap)}
.pricing-card.selected::after{content:'‚úì';position:absolute;top:8px;right:12px;color:var(--ap);font-weight:800;font-size:13px}
.pricing-price{font-size:24px;font-weight:800;color:var(--ap);line-height:1;margin-bottom:2px}
.pricing-desc{font-size:10px;color:var(--txs);text-transform:uppercase;letter-spacing:.08em}
.pricing-right{text-align:right;margin-left:auto}
.pricing-duration{font-size:12px;font-weight:700;color:var(--tx);margin-bottom:2px}
.pricing-limit{font-size:10px;color:var(--gn);font-weight:700;text-transform:uppercase;letter-spacing:.05em}
.pricing-total{font-size:10px;color:var(--txm)}
.upgrade-actions{display:flex;gap:8px}
.upgrade-btn{flex:1;padding:12px;background:var(--ap);color:#000;border:2px solid var(--ap);font-size:12px;font-weight:800;text-transform:uppercase;cursor:pointer;transition:all .2s;box-shadow:4px 4px 0 var(--sfe),4px 4px 0 2px var(--ap);font-family:inherit;letter-spacing:.05em}
.upgrade-btn:hover:not(:disabled){transform:translate(2px,2px);box-shadow:2px 2px 0 var(--sfe),2px 2px 0 2px var(--ap)}
.upgrade-btn:disabled{opacity:.4;cursor:not-allowed;box-shadow:none}
.upgrade-btn.sec{background:transparent;color:var(--txs);border-color:var(--bd);box-shadow:none}
.upgrade-btn.sec:hover{background:var(--sfe);color:var(--tx);transform:none;box-shadow:none}

/* ‚îÄ‚îÄ CHAT ROOM ‚îÄ‚îÄ */
.chat-room{display:none;position:fixed;inset:0;background:var(--bg);z-index:20000;flex-direction:column}
.chat-room.on{display:flex}
.chat-header{padding:12px 16px;border-bottom:2px solid var(--bd);display:flex;justify-content:space-between;align-items:center;background:var(--sf)}
.chat-eyes{display:flex;gap:2px;align-items:center;height:28px}
.eye-l,.eye-r{font-size:20px;display:inline-block;animation:glance 3s infinite ease-in-out}
.eye-r{animation-delay:.2s}
@keyframes glance{0%,100%{transform:translateX(0)}15%{transform:translateX(-2px)}30%{transform:translateX(2px)}45%{transform:translateX(-1px)}60%{transform:translateX(1px)}75%{transform:translateX(0)}}
.chat-timer{font-size:14px;font-weight:700;font-family:'Share Tech Mono',monospace;color:var(--gn);background:var(--sfe);padding:4px 10px;border:1px solid var(--bd);letter-spacing:.05em}
.chat-timer.warn{color:#FF3333;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.chat-close{background:transparent;border:2px solid var(--bd);color:var(--txs);font-size:14px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:all .15s}
.chat-close:hover{border-color:var(--ap);color:var(--tx)}
.chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px;background:var(--bg)}
.chat-msg{display:flex;flex-direction:column;max-width:82%}
.chat-msg.own{align-self:flex-end}
.chat-msg.other{align-self:flex-start}
.chat-bubble{padding:10px 14px;font-size:14px;line-height:1.5;word-wrap:break-word}
/* own = AP orange, clip corner */
.own .chat-bubble{background:var(--ap);color:#000;clip-path:polygon(0 0,100% 0,100% calc(100% - 8px),calc(100% - 8px) 100%,0 100%)}
/* other = flat dark */
.other .chat-bubble{background:var(--sf);color:var(--tx);border:2px solid var(--bd)}
.chat-meta{font-size:9px;color:var(--txm);margin:3px 4px 0;font-weight:600;letter-spacing:.03em}
.typing-message{background:var(--sf)!important;border:2px solid var(--bd)!important;padding:12px 16px!important;min-width:56px}
.typing-dots{display:flex;gap:4px;padding:2px 0}
.typing-dot{width:7px;height:7px;background:var(--txs);border-radius:50%;animation:tw 1.4s infinite}
.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}
@keyframes tw{0%,60%,100%{transform:translateY(0);opacity:.6}30%{transform:translateY(-5px);opacity:1}}
.typing-cursor{display:inline-block;width:2px;height:13px;background:var(--ap);margin-left:2px;animation:blink 1s infinite;vertical-align:middle}
.searching-message{align-self:center!important;max-width:90%!important;margin:14px 0}
.searching-message .chat-bubble{background:var(--sfe)!important;color:var(--txs)!important;border:2px dashed var(--aq)!important;font-family:'Instrument Serif',serif;font-style:italic;text-align:center;font-size:14px}
.distress-banner{display:none;padding:8px 16px;background:rgba(255,51,51,.1);border-top:2px solid #FF3333;font-size:11px;color:#FF6666;text-align:center;font-weight:700;letter-spacing:.03em;text-transform:uppercase}
.distress-banner.show{display:block}
.chat-input-area{padding:10px 16px;border-top:2px solid var(--bd);display:flex;gap:8px;background:var(--sf)}
.chat-input{flex:1;background:var(--bg);border:2px solid var(--bd);color:var(--tx);padding:10px 14px;font-size:15px;font-family:inherit;-webkit-appearance:none;transition:border-color .15s}
.chat-input:focus{outline:none;border-color:var(--ap)}
/* send = Jejak .sbtn style */
.chat-send{background:var(--ap);color:#000;border:none;padding:0 18px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.06em;cursor:pointer;transition:all .15s;font-family:inherit}
.chat-send:hover{background:var(--tx)}
.vt-chat-btn{background:#0d0d0d;border:2px solid #1a1a1a;color:#2a2a2a;width:36px;height:100%;font-size:12px;cursor:pointer;transition:all .2s;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.vt-chat-btn:hover{border-color:#333;color:#555}
.chat-fifo{font-size:9px;color:var(--txm);text-align:center;padding:5px;background:var(--sf);border-top:1px solid var(--bd);text-transform:uppercase;letter-spacing:.1em;font-weight:700}

/* ‚îÄ‚îÄ PRICING HINT & DM LINK ‚îÄ‚îÄ */
.modal-pricing-hint{font-size:11px;color:var(--txm);text-align:center;margin-top:14px;line-height:1.6}
.modal-pricing-hint strong{color:var(--txs)}
.dm-hint-link{background:none;border:none;color:var(--ap);font-size:11px;font-weight:700;cursor:pointer;text-decoration:underline;font-family:inherit;padding:0}
.dm-hint-link:hover{color:var(--tx)}

/* ‚îÄ‚îÄ MODEL B ‚Äî DM GATE ‚îÄ‚îÄ */
.dm-feature-list{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.dm-feature{font-size:12px;color:var(--txs);padding:8px 12px;background:var(--sfe);border-left:2px solid var(--as);font-weight:600}
.dm-price-box{background:var(--sfe);border:2px solid var(--as);padding:16px;text-align:center;margin-bottom:20px}
.dm-price{font-size:36px;font-weight:800;color:var(--as);letter-spacing:-.02em;line-height:1}
.dm-price-sub{font-size:11px;color:var(--txm);margin-top:4px;text-transform:uppercase;letter-spacing:.1em;font-weight:700}

/* ‚îÄ‚îÄ MODEL B ‚Äî DM INBOX ‚îÄ‚îÄ */
.dm-compose-trigger{background:var(--as);color:#000;border:none;padding:8px 16px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;font-family:inherit;transition:all .15s}
.dm-compose-trigger:hover{opacity:.85}
.dm-thread-list{display:flex;flex-direction:column;gap:1px;background:var(--bd);border:2px solid var(--bd);margin-bottom:8px}
.dm-thread-item{background:var(--sf);padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:background .15s;position:relative}
.dm-thread-item:hover{background:var(--sfe)}
.dm-thread-item.unread::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--as)}
.dm-thread-avatar{width:36px;height:36px;background:var(--sfe);border:2px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:var(--txm);flex-shrink:0;text-transform:uppercase}
.dm-thread-info{flex:1;min-width:0}
.dm-thread-name{font-size:13px;font-weight:700;color:var(--tx);margin-bottom:2px}
.dm-thread-preview{font-size:11px;color:var(--txm);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dm-thread-time{font-size:9px;color:var(--txm);white-space:nowrap;font-family:'Share Tech Mono',monospace}
.dm-thread-unread-badge{min-width:18px;height:18px;background:var(--as);color:#000;font-size:9px;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.dm-empty{text-align:center;padding:32px 16px}
.dm-empty-icon{font-size:32px;margin-bottom:12px;display:block;color:var(--txm)}
.dm-empty-text{font-family:'Instrument Serif',serif;font-size:18px;font-style:italic;color:var(--txs);margin-bottom:4px}
.dm-empty-sub{font-size:11px;color:var(--txm)}

/* ‚îÄ‚îÄ MODEL B ‚Äî DM COMPOSE (fullscreen) ‚îÄ‚îÄ */
.dm-compose-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:25000;flex-direction:column}
.dm-compose-screen.on{display:flex}
.dm-compose-inner{max-width:480px;width:100%;margin:0 auto;display:flex;flex-direction:column;height:100%;padding:0}
.dm-compose-header{padding:16px;border-bottom:2px solid var(--bd);display:flex;align-items:center;gap:12px;background:var(--sf)}
.dm-compose-to{flex:1;display:flex;align-items:center;gap:8px}
.dm-to-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--txm);white-space:nowrap}
.dm-to-input{flex:1;background:transparent;border:none;border-bottom:2px solid var(--bd);color:var(--tx);font-size:15px;font-family:inherit;padding:4px 0;outline:none;transition:border-color .15s}
.dm-to-input:focus{border-bottom-color:var(--as)}
.dm-to-input::placeholder{color:var(--txm)}
.dm-compose-close{background:transparent;border:2px solid var(--bd);color:var(--txs);width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;font-size:14px;transition:all .15s}
.dm-compose-close:hover{border-color:var(--ap);color:var(--tx)}
.dm-compose-body{flex:1;background:transparent;border:none;color:var(--tx);font-family:inherit;font-size:16px;line-height:1.6;resize:none;padding:20px 16px;outline:none}
.dm-compose-body::placeholder{color:var(--txm)}
.dm-compose-footer{padding:12px 16px;border-top:2px solid var(--bd);display:flex;justify-content:space-between;align-items:center;background:var(--sf)}
.dm-char-count{font-size:10px;color:var(--txm);font-family:'Share Tech Mono',monospace}
.dm-send-btn{background:var(--as);color:#000;border:none;padding:10px 24px;font-size:12px;font-weight:800;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;font-family:inherit;transition:all .15s;box-shadow:3px 3px 0 rgba(0,0,0,.6)}
.dm-send-btn:hover:not(:disabled){transform:translate(1px,1px);box-shadow:2px 2px 0 rgba(0,0,0,.6)}
.dm-send-btn:disabled{opacity:.3;cursor:not-allowed;box-shadow:none}

/* ‚îÄ‚îÄ MODEL B ‚Äî DM THREAD (fullscreen) ‚îÄ‚îÄ */
.dm-thread-screen{display:none;position:fixed;inset:0;background:var(--bg);z-index:25000;flex-direction:column}
.dm-thread-screen.on{display:flex}
.dm-thread-header{padding:12px 16px;border-bottom:2px solid var(--bd);display:flex;align-items:center;gap:12px;background:var(--sf)}
.dm-back-btn{background:transparent;border:2px solid var(--bd);color:var(--txs);width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;flex-shrink:0;transition:all .15s}
.dm-back-btn:hover{border-color:var(--ap);color:var(--tx)}
.dm-thread-name{flex:1;font-size:14px;font-weight:700;color:var(--tx)}
.dm-vt-btn{background:#0d0d0d;border:2px solid #1a1a1a;color:#333;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;flex-shrink:0;transition:all .2s}
.dm-vt-btn:hover{border-color:#333;color:#666}
.dm-thread-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px}
/* reuse chat-msg / chat-bubble styles */
.dm-thread-input-area{padding:10px 16px;border-top:2px solid var(--bd);display:flex;gap:8px;background:var(--sf)}
.dm-thread-input{flex:1;background:var(--bg);border:2px solid var(--bd);color:var(--tx);padding:10px 14px;font-size:15px;font-family:inherit;transition:border-color .15s}
.dm-thread-input:focus{outline:none;border-color:var(--as)}
.dm-thread-send{background:var(--as);color:#000;border:none;padding:0 18px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:.06em;cursor:pointer;font-family:inherit;transition:all .15s}
.dm-thread-send:hover{opacity:.85}

/* ‚îÄ‚îÄ VOID TAP ‚îÄ‚îÄ */
.void-tap-indicator{position:relative;width:14px;height:14px;flex-shrink:0}
.void-tap-indicator .vt-dot{width:8px;height:8px;background:#111;border:1px solid #1e1e1e;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transition:all .5s}
.void-tap-indicator.has-tap .vt-dot{background:#0d0d0d;animation:vt-breathe 3s ease-in-out infinite}
@keyframes vt-breathe{0%,100%{box-shadow:none;border-color:#1e1e1e}50%{box-shadow:0 0 0 3px rgba(30,30,30,.5);border-color:#2a2a2a}}

/* Compose screen */
.vt-compose{display:none;position:fixed;inset:0;background:#000;z-index:30000;flex-direction:column;align-items:stretch;justify-content:center}
.vt-compose.on{display:flex;animation:vt-fade .2s ease}
@keyframes vt-fade{from{opacity:0}to{opacity:1}}
.vt-compose-inner{max-width:480px;width:100%;margin:0 auto;padding:32px 24px;display:flex;flex-direction:column;gap:24px}
.vt-label{font-size:9px;font-weight:700;color:#2a2a2a;text-transform:uppercase;letter-spacing:.2em}
.vt-textarea{background:transparent;border:none;border-bottom:1px solid #1a1a1a;color:#444;font-family:'Plus Jakarta Sans',sans-serif;font-size:18px;line-height:1.7;resize:none;height:130px;outline:none;caret-color:#333;padding:8px 0}
.vt-textarea::placeholder{color:#1e1e1e;font-style:italic}
.vt-textarea:focus{border-bottom-color:#252525}
.vt-meta{display:flex;justify-content:space-between;align-items:center}
.vt-quota{font-size:10px;color:#222;font-family:'Share Tech Mono',monospace;letter-spacing:.05em}
.vt-quota.low{color:#331111}
.vt-actions{display:flex;gap:8px}
.vt-cancel{background:transparent;border:1px solid #181818;color:#2a2a2a;padding:8px 16px;font-size:11px;font-weight:700;text-transform:uppercase;cursor:pointer;font-family:inherit;transition:border-color .15s,color .15s;letter-spacing:.05em}
.vt-cancel:hover{border-color:#2a2a2a;color:#444}
.vt-send{background:#0a0a0a;border:1px solid #1e1e1e;color:#333;padding:8px 20px;font-size:11px;font-weight:700;text-transform:uppercase;cursor:pointer;font-family:inherit;transition:all .15s;letter-spacing:.05em}
.vt-send:hover:not(:disabled){border-color:#333;color:#666;box-shadow:0 0 0 1px #222}
.vt-send:disabled{opacity:.2;cursor:not-allowed}

/* Reader screen */
.vt-reader{display:none;position:fixed;inset:0;background:#000;z-index:30000;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;user-select:none}
.vt-reader.on{display:flex;animation:vt-fade .2s ease}
.vt-reader-msg{max-width:300px;padding:0 24px;text-align:center;color:#3d3d3d;font-size:16px;line-height:1.8;font-family:'Plus Jakarta Sans',sans-serif}
.vt-reader-timer{position:absolute;bottom:52px;left:50%;transform:translateX(-50%);font-family:'Share Tech Mono',monospace;font-size:10px;color:#1e1e1e;letter-spacing:.15em;text-transform:uppercase}
.vt-reader-from{position:absolute;top:52px;left:50%;transform:translateX(-50%);font-size:9px;color:#1a1a1a;font-weight:700;text-transform:uppercase;letter-spacing:.25em;white-space:nowrap}
.vt-reader.burning .vt-reader-msg,.vt-reader.burning .vt-reader-timer,.vt-reader.burning .vt-reader-from{animation:vt-burn .7s ease forwards}
@keyframes vt-burn{0%{opacity:1;filter:none}50%{opacity:.4;filter:blur(2px)}100%{opacity:0;filter:blur(12px)}}

/* Upgrade nudge */
.vt-upgrade-nudge{display:none;position:fixed;bottom:84px;left:50%;transform:translateX(-50%) translateY(16px);background:#0a0a0a;border:1px solid #1a1a1a;padding:10px 18px;font-size:11px;color:#333;white-space:nowrap;z-index:25000;opacity:0;transition:all .3s;cursor:pointer;letter-spacing:.03em}
.vt-upgrade-nudge.show{display:block;opacity:1;transform:translateX(-50%) translateY(0)}
.vt-upgrade-nudge b{color:#555}

/* ‚îÄ‚îÄ BOTTOM NAV ‚Äî identical to Jejak ‚îÄ‚îÄ */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--sf);border-top:2px solid var(--bd);z-index:1000;padding-bottom:env(safe-area-inset-bottom)}
.bnav-c{max-width:480px;margin:0 auto;display:flex;justify-content:space-around;align-items:center;height:64px}
.ni{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;height:100%;color:var(--txm);text-decoration:none;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;transition:all .2s;position:relative;cursor:pointer}
.ni::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:0;height:2px;background:var(--ap);transition:width .2s}
.ni:hover{color:var(--txs);background:var(--sfe)}
.ni.act{color:var(--ap)}.ni.act::before{width:100%}
.nico{font-size:20px;line-height:1}
</style>
</head>
<body>

<!-- HEADER -->
<div class="w">
  <header>
    <div>
      <div class="logo">SP<span>‚úï</span>LL</div>
      <div class="tagline">siapa lagi ngerasain apa</div>
    </div>
    <div class="top-right">
      <div class="conn-dot"></div>
      <button class="menu-trigger" onclick="toggleMenu()"><span></span><span></span><span></span></button>
    </div>
  </header>
</div>

<!-- RADAR ‚Äî full bleed, same positioning as .hero-s -->
<div class="radar-wrap">
  <div class="radar-hero">
    <div class="screw-bl"></div>
    <div class="screw-br"></div>
    <div class="radar-container">
      <div class="radar-grid"></div>
      <div class="radar-circles"></div>
      <div class="radar-crosshair"></div>
      <canvas class="radar-canvas" id="radarCanvas"></canvas>
      <div id="radarDots"></div>
      <div class="radar-overlay"></div>
    </div>
    <div class="radar-title">VIBE RADAR</div>
    <div class="radar-footer">
      <div class="quota-display">
        <span class="quota-badge" id="quotaBadge">24</span>
        <span class="quota-text">ONLINE<br>READY</span>
      </div>
      <button class="vibe-check-btn" onclick="startVibeCheck()">‚¨° VIBE CHECK</button>
      <button class="vibe-check-btn dm-radar-btn" onclick="openDmModal()" style="background:transparent;color:var(--as);border:1px solid var(--as);box-shadow:none;margin-left:8px">‚úâ DM</button>
    </div>
  </div>
</div>

<!-- MAIN CONTENT -->
<div class="w">

  <!-- FILTER -->
  <div class="shdr" style="margin-top:24px">
    <span class="stit">Filter Vibe</span>
    <div class="sline"></div>
    <span class="shdr-meta">KESELARASAN</span>
  </div>
  <div class="filter-wrap">
    <div class="filter-header">
      <span class="filter-label"><span class="vibe-pct" id="vibePct">87%</span> match</span>
      <button class="reset-btn" onclick="resetFilters()">Reset</button>
    </div>
    <input type="range" class="vibe-slider" id="vibeSlider" min="0" max="100" value="87" oninput="updateVibePct(this.value)">
    <div class="vibe-labels"><span>Homie Only</span><span>Semi-Selaras</span><span>Semua</span></div>
    <div class="mood-filters">
      <button class="mood-btn active" data-mood="all" onclick="filterMood(this)">Semua</button>
      <button class="mood-btn" data-mood="surviving" onclick="filterMood(this)">üòÆ‚Äçüí® Surviving</button>
      <button class="mood-btn" data-mood="thriving" onclick="filterMood(this)">‚ú® Thriving</button>
      <button class="mood-btn" data-mood="chaotic" onclick="filterMood(this)">üåÄ Chaotic</button>
      <button class="mood-btn" data-mood="doom" onclick="filterMood(this)">üõå Doom</button>
    </div>
  </div>

  <!-- SPILLS -->
  <div class="shdr">
    <span class="stit">Spill Terkini</span>
    <div class="sline"></div>
    <span class="shdr-meta">FIFO ‚Ä¢ AUTO</span>
  </div>
  <div class="content-area" id="contentArea">
    <div class="spinner"></div>
    <p class="loading-text">Nyeduh teh...</p>
  </div>
  <button class="new-spill-btn" onclick="refreshSpills()">
    <div class="void-tap-indicator" id="vtIndicator" onclick="event.stopPropagation();checkVoidTaps()">
      <div class="vt-dot"></div>
    </div>
    <span class="nbtn-icon">‚Üª</span>
    <span>Seduh Teh Baru</span>
  </button>

</div><!-- /.w -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODEL A ‚Äî STRANGER CHAT
     Entry modal (anonymous, no username shown)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal" id="genderModal">
  <div class="modal-box">
    <span class="modal-tag">Model A ‚Ä¢ Stranger Chat</span>
    <div class="modal-title">Vibe Check</div>
    <div class="modal-sub">ngobrol sama perfect stranger ‚Äî zero identity, zero history</div>
    <div class="gender-options">
      <div class="gender-opt" data-gender="male" onclick="selectGender('male')">
        <span class="gender-icon">‚ôÇÔ∏è</span>
        <div class="gender-label">Pria</div>
        <div class="gender-desc">ketemu stranger cewek</div>
      </div>
      <div class="gender-opt" data-gender="female" onclick="selectGender('female')">
        <span class="gender-icon">‚ôÄÔ∏è</span>
        <div class="gender-label">Wanita</div>
        <div class="gender-desc">ketemu stranger cowok</div>
      </div>
    </div>
    <div class="modal-note">
      <strong>‚óº GRATIS 15 MENIT/HARI</strong><br>
      Tidak ada username. Tidak ada profil. Chat terhapus setelah sesi selesai.
    </div>
    <button class="modal-confirm" id="genderConfirm" onclick="confirmGender()" disabled>Cari Stranger</button>
    <div class="modal-pricing-hint">
      Mau lebih lama? <strong>Rp 10k/minggu</strong> @2jam/hari &nbsp;¬∑&nbsp; <strong>Rp 50k/bulan</strong> @3jam/hari
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODEL A ‚Äî UPGRADE MODAL (Stranger only)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal" id="upgradeModal">
  <div class="modal-box">
    <span class="modal-tag upgrade-tag">Stranger Chat ‚Ä¢ Perpanjang</span>
    <div class="modal-title upgrade-title">Waktu Habis</div>
    <div class="modal-sub">sesi gratis 15 menit sudah selesai</div>
    <div class="timer-warn">
      <div class="big" id="timerWarnDisplay">15:00</div>
      <div class="small">sesi gratis selesai</div>
    </div>
    <div class="pricing-grid">
      <div class="pricing-card" data-plan="weekly" onclick="selectPlan('weekly')">
        <div>
          <div class="pricing-price">Rp 10k</div>
          <div class="pricing-desc">7 hari</div>
        </div>
        <div class="pricing-right">
          <div class="pricing-duration">@ 2 jam/hari</div>
          <div class="pricing-limit">14 jam total</div>
          <div class="pricing-total">Rp 1.428/jam</div>
        </div>
      </div>
      <div class="pricing-card" data-plan="monthly" onclick="selectPlan('monthly')">
        <div>
          <div class="pricing-price">Rp 50k</div>
          <div class="pricing-desc">30 hari</div>
        </div>
        <div class="pricing-right">
          <div class="pricing-duration">@ 3 jam/hari</div>
          <div class="pricing-limit">90 jam total</div>
          <div class="pricing-total">Rp 555/jam</div>
        </div>
      </div>
    </div>
    <div class="upgrade-actions">
      <button class="upgrade-btn" id="upgradeNow" onclick="upgradeNow()" disabled>Lanjut Chat</button>
      <button class="upgrade-btn sec" onclick="closeModal('upgradeModal')">Nanti aja</button>
    </div>
    <div class="modal-pricing-hint" style="margin-top:16px;text-align:center">
      Butuh DM ke username spesifik? ‚Üí
      <button class="dm-hint-link" onclick="closeModal('upgradeModal');openDmModal()">Lihat Model B</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODEL B ‚Äî DM MODAL
     50K/bulan only, username-based
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal" id="dmModal">
  <div class="modal-box">

    <!-- GATE: tampil jika belum subscribe -->
    <div id="dmGate">
      <span class="modal-tag" style="color:var(--as)">Model B ‚Ä¢ Direct Message</span>
      <div class="modal-title">DM 1-on-1</div>
      <div class="modal-sub">kirim pesan ke username spesifik ‚Äî subscriber 50K/bulan</div>
      <div class="dm-feature-list">
        <div class="dm-feature">‚óº DM ke username manapun di JEJAK</div>
        <div class="dm-feature">‚óº Riwayat pesan tersimpan (bukan ephemeral)</div>
        <div class="dm-feature">‚óº Void Tap unlimited (5 detik burn)</div>
        <div class="dm-feature">‚óº Include semua benefit Stranger Chat 3jam/hari</div>
      </div>
      <div class="dm-price-box">
        <div class="dm-price">Rp 50.000</div>
        <div class="dm-price-sub">per bulan ¬∑ cancel kapanpun</div>
      </div>
      <button class="modal-confirm" onclick="subscribeDM()">Subscribe & Aktifkan DM</button>
      <div class="modal-pricing-hint" style="margin-top:12px">
        <button class="dm-hint-link" onclick="closeModal('dmModal')">Nanti aja</button>
      </div>
    </div>

    <!-- INBOX: tampil jika sudah subscribe -->
    <div id="dmInbox" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <div>
          <span class="modal-tag" style="color:var(--as)">Model B ‚Ä¢ Direct Message</span>
          <div class="modal-title" style="font-size:22px">Pesan</div>
        </div>
        <button class="dm-compose-trigger" onclick="openDmCompose()">+ Tulis</button>
      </div>
      <div class="dm-thread-list" id="dmThreadList">
        <!-- diisi JS -->
      </div>
      <div class="dm-empty" id="dmEmptyState">
        <div class="dm-empty-icon">‚úâ</div>
        <div class="dm-empty-text">Belum ada pesan</div>
        <div class="dm-empty-sub">Tulis DM pertamamu ke seseorang</div>
        <button class="modal-confirm" style="margin-top:16px" onclick="openDmCompose()">Mulai DM</button>
      </div>
      <div style="text-align:right;margin-top:12px">
        <button class="dm-hint-link" onclick="closeModal('dmModal')">Tutup</button>
      </div>
    </div>

  </div>
</div>

<!-- MODEL B ‚Äî DM COMPOSE (fullscreen) -->
<div class="dm-compose-screen" id="dmComposeScreen">
  <div class="dm-compose-inner">
    <div class="dm-compose-header">
      <div class="dm-compose-to">
        <span class="dm-to-label">Ke:</span>
        <input class="dm-to-input" id="dmToInput" placeholder="@username" maxlength="32" oninput="validateDmTo()">
      </div>
      <button class="dm-compose-close" onclick="closeDmCompose()">‚úï</button>
    </div>
    <textarea class="dm-compose-body" id="dmBodyInput" placeholder="tulis pesanmu..." maxlength="1000" oninput="validateDmBody()"></textarea>
    <div class="dm-compose-footer">
      <span class="dm-char-count" id="dmCharCount">0 / 1000</span>
      <button class="dm-send-btn" id="dmSendBtn" onclick="sendDm()" disabled>Kirim</button>
    </div>
  </div>
</div>

<!-- MODEL B ‚Äî DM THREAD (fullscreen) -->
<div class="dm-thread-screen" id="dmThreadScreen">
  <div class="dm-thread-header">
    <button class="dm-back-btn" onclick="closeDmThread()">‚Üê</button>
    <div class="dm-thread-name" id="dmThreadName">@username</div>
    <button class="dm-vt-btn" onclick="openVtCompose()" title="Kirim Void Tap">‚óº</button>
  </div>
  <div class="dm-thread-messages" id="dmThreadMessages"></div>
  <div class="dm-thread-input-area">
    <input class="dm-thread-input" id="dmThreadInput" placeholder="Tulis balasan..." maxlength="1000">
    <button class="dm-thread-send" onclick="sendDmReply()">Kirim</button>
  </div>
</div>

<!-- CHAT ROOM -->
<div class="chat-room" id="chatRoom">
  <div class="chat-header">
    <div class="chat-eyes"><span class="eye-l">üëÄ</span><span class="eye-r">üëÄ</span></div>
    <div class="chat-timer" id="chatTimer">15:00</div>
    <button class="chat-close" onclick="closeChat()">‚úï</button>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="distress-banner" id="distressBanner">ada yang bisa dihubungi malam ini? Into The Light: 119 ext 8</div>
  <div class="chat-input-area">
    <button class="vt-chat-btn" onclick="openVtCompose()" title="Kirim Void Tap">‚óº</button>
    <input type="text" class="chat-input" id="chatInput" placeholder="Tulis pesan..." maxlength="200">
    <button class="chat-send" onclick="sendMsg()">Kirim</button>
  </div>
  <div class="chat-fifo">FIFO ‚Ä¢ maks 20 pesan ‚Ä¢ chat dihapus setelah sesi</div>
</div>

<div class="toast" id="toast"></div>

<!-- VOID TAP COMPOSE -->
<div class="vt-compose" id="vtCompose">
  <div class="vt-compose-inner">
    <div class="vt-label">Void Tap ‚Äî pesan menghilang 5 detik setelah dibuka</div>
    <textarea class="vt-textarea" id="vtText" placeholder="tulis sesuatu yang ga bisa kamu bilang di tempat lain..." maxlength="280"></textarea>
    <div class="vt-meta">
      <span class="vt-quota" id="vtQuotaDisplay">3 void tap tersisa hari ini</span>
      <div class="vt-actions">
        <button class="vt-cancel" onclick="closeVtCompose()">Batal</button>
        <button class="vt-send" id="vtSendBtn" onclick="sendVoidTap()" disabled>Kirim</button>
      </div>
    </div>
  </div>
</div>

<!-- VOID TAP READER -->
<div class="vt-reader" id="vtReader" onclick="onVtReaderTap()">
  <div class="vt-reader-from" id="vtReaderFrom">dari seseorang</div>
  <div class="vt-reader-msg" id="vtReaderMsg"></div>
  <div class="vt-reader-timer" id="vtReaderTimer">menghilang dalam 5</div>
</div>

<!-- UPGRADE NUDGE -->
<div class="vt-upgrade-nudge" id="vtUpgradeNudge" onclick="showUpgradeModal()">
  limit harian habis ‚Äî <b>upgrade untuk unlimited void tap</b>
</div>

<!-- NAV ‚Äî identical to Jejak -->
<nav class="bnav">
  <div class="bnav-c">
    <a href="jejak.html" class="ni"><span class="nico">‚ú¶</span><span>Jejak</span></a>
    <a href="spill.html" class="ni act"><span class="nico">‚úï</span><span>Spill</span></a>
    <a href="cocomeo.html" class="ni"><span class="nico">„Äú</span><span>Cocomeo</span></a>
    <a href="glitch.html" class="ni"><span class="nico">‚ö°</span><span>Glitch</span></a>
  </div>
</nav>

<script>
// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let currentGender=null,chatPartner=null,timerInterval=null,chatTimeLeft=900;
let selectedPlan=null,activeMood='all',radarInterval,userName='user';

const AI_CHARS={
  female:[
    {name:'beby.manis',mood:['surviving','thriving','chaotic'],rants:["hari ini gue liat mantan sama cewek baru, dan tau gak? rambutnya lebih bagus dari rambut gue üò≠","cape bener jadi cewek, setiap bulan harus nahan sakit perut sambil tetep senyum di depan client","kenapa sih cowok kalo ditanya 'lagi apa' pasti jawabnya 'lagi main'? ga ada variasi lain?","gue lagi fase pengen dimengerti tanpa harus jelasin panjang lebar","bete banget skincare gue habis, padahal baru kemarin beli. ada yang ngutil?"]},
    {name:'strawberry.shortcake',mood:['surviving','doom','chaotic'],rants:["hari ini gue salah kirim chat pacar ke grup keluarga. isinya 'sayang udah mandi belom?' üò≠","kenapa orangtua selalu curiga kalo kita lagi seneng? 'lagi seneng-seneng ya? nanti belajar'","gue lagi diet, tapi tiap liat roti, rotinya yang liat gue duluan","stress skripsi tapi yang keluar peluh dan air mata doang","hari ini gue nangis karena ga bisa buka toples. lemah?"]},
    {name:'pretty.sad',mood:['doom','surviving'],rants:["kadang gue mikir, apa kita yang terlalu berharap atau emang janjinya ga pernah ditepatin?","hujan hari ini, tapi gaada yang tanya 'udah makan belom?'","capek pura-pura baik-baik aja. gue juga manusia, bisa hancur","kenapa ya orang lebih peduli sama 'kabar' daripada 'perasaan'?","malam ini gue lagi fase nerima kenyataan kalo dia ga akan balik"]},
    {name:'little.fairy',mood:['chaotic','thriving','surviving'],rants:["kalo gue jadi kucing, gue bakal tidur 20 jam sehari dan ga bakal di-judge malas","hari ini gue nangis karena liat video kura-kura lagi berantem. mereka kayak 'ga ada yang mundur!'","kok bisa sih orang dagang pake sound toa keras banget? emang gaada kerjaan lain?","gue percaya kalo alam semesta itu lagi iseng sama gue","ada yang percaya rejeki ga bakal kemana? gue, tapi tetep nangis tiap liat saldo"]},
    {name:'cinnamon.girl',mood:['doom','surviving'],rants:["hari ini gue nangis di angkot gegara liat kucing dipukul orang. mental gue udah kayak kerupuk kena hujan.","kenapa sih orang jahat bisa tidur nyenyak? gue yang baik aja susah tidur","hari ini gue bantu orang, eh malah dijadiin 'teman curhat' seharian. capek fisik mental","tolong kasih gue tanda kalo dunia ini ga sekejam kelihatannya","lagi fase sulit bilang 'ga' ke orang. jadi numpuk kerjaan sendiri"]}
  ],
  male:[
    {name:'si.badai',mood:['doom','surviving','chaotic'],rants:["hari ini gue ditagih utang sama mantan. utang apa? utang perasaan katanya","capek jadi orang yang dianggap kuat terus. gue juga pengen nangis dipeluk","kenapa sih kalo udah malem suka overthinking? badan capek tapi pikiran lari maraton","jadi cowok tuh gaboleh lemah katanya. tapi dalemnya ancur","gue capek jadi 'tembok' tempat orang bersandar. giliran gue butuh sandaran, pada pergi"]},
    {name:'moon.child',mood:['doom','surviving'],rants:["malam ini gue liat bulan sendirian. sama kayak gue. tapi bulan masih punya bintang.","kenapa cinta harus pergi? apa karena gue ga bisa jadi alasan buat dia bertahan?","hari ini gue dapet kabar doi udah tunangan. selamat ya, semoga dia bahagia (gue bohong)","capek nungguin orang yang ga pasti. tapi lebih capek ngelepasinnya","jangan tanya gue 'kabar baik?'. kabar gue baik-baik aja, cuma hati lagi berdarah-darah"]},
    {name:'si.kocak',mood:['chaotic','surviving'],rants:["hidup tuh kayak sinetron. kadang bahagia, kadang nangis, tapi endingnya selalu bikin kesel","hari ini gue ditilang polisi. katanya motor gue terlalu keren. padahal cuma mau pamer","stress mikirin masa depan. solusi gue: tidur. besok dipikirin lagi. atau lusa","orang bilang kalo kamu ketawa berarti kamu bahagia. berarti gue artis pemenang Oscar","hari ini gue ketawa terbahak-bahak. abis itu nangis. abis itu ketawa lagi. am i okay?"]},
    {name:'si.pedas',mood:['chaotic','thriving','surviving'],rants:["hari ini gue dikatain 'kamu berubah'. iya lah, gua bukan nasi bisa tetep sama","tolong ya, kalo chat itu dibales. jangan cuma diliat doang, matanya apa hpnya yang liat?","ada yang bilang 'kerja keras ga akan khianati hasil'. hasilnya: gue dikhianati sama kesehatan","lagi fase males bales chat semua orang. bukan depresi, cuma lagi males sama dunia","orang suka bilang 'sabar ya'. gue pengen jawab 'sabarin aja tai'"]},
    {name:'mba.gaul',mood:['chaotic','surviving','doom'],rants:["hari ini gue liat orang bawa balon. mungkin balon itu temen curhatnya","kenapa sih kalo lagi di kamar mandi suka inget kejadian memalukan 5 tahun lalu?","gue pengen jadi kucing tetangga. tidur, makan, tidur lagi, ga pernah mikir cicilan","hari ini gue nangis gegara kehabisan kuota pas lagi nonton drakor climax","ada yang pernah ngerasa jadi orang paling sendiri di keramaian? iyalah kita di jalan tol"]}
  ]
};

const USER_RANTS=[
  {id:1,author:'anon.kucing',mood:'surviving',content:'Hari ini gue nangis di angkot gegara liat kucing dipukul orang. Mental gue udah kayak kerupuk kena hujan.',reactions:{skull:42,cry:89,fire:12,upside:7}},
  {id:2,author:'sleepy.head',mood:'thriving',content:'akhirnya bisa tidur nyenyak semalaman setelah 3 minggu insomnia. makasih buat yang chat tadi malem.',reactions:{skull:23,cry:15,fire:67,upside:31}},
  {id:3,author:'chaos.queen',mood:'chaotic',content:'hari ini chaos abis! dari bangun tidur udah salah ambil kaki, sampe kantor lupa bawa laptop.',reactions:{skull:89,cry:23,fire:45,upside:78}},
  {id:4,author:'quiet.one',mood:'doom',content:'udah seminggu nggak keluar kamar. bukan karena sibuk. cuma nggak tau mau ngapain.',reactions:{skull:67,cry:112,fire:8,upside:34}}
];

const MOOD_COLOR={surviving:'var(--ms)',thriving:'var(--mt)',chaotic:'var(--mc)',doom:'var(--md)'};
const REACTION_EMOJI={skull:'üíÄ',cry:'üò≠',fire:'üî•',upside:'üôÉ'};

const $=id=>document.getElementById(id);
const esc=t=>{const d=document.createElement('div');d.textContent=t;return d.innerHTML};
function toast(msg,isErr=false){const t=$('toast');t.textContent=msg;t.className='toast'+(isErr?' error':'');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000)}
function closeModal(id){$(id).classList.remove('on')}
function toggleMenu(){toast('Menu coming soon')}
function updateVibePct(val){$('vibePct').textContent=val+'%'}
function filterMood(btn){document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');activeMood=btn.dataset.mood;renderSpills()}
function resetFilters(){$('vibeSlider').value=87;updateVibePct(87);document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('active'));document.querySelector('.mood-btn[data-mood="all"]').classList.add('active');activeMood='all';renderSpills()}

// ‚îÄ‚îÄ SPILLS ‚îÄ‚îÄ
function generateAIRants(count=3){
  const rants=[];let nextId=Math.max(...USER_RANTS.map(u=>u.id))+1;
  for(let i=0;i<count;i++){
    const gender=Math.random()>.5?'female':'male';
    const char=AI_CHARS[gender][Math.floor(Math.random()*AI_CHARS[gender].length)];
    const mood=char.mood[Math.floor(Math.random()*char.mood.length)];
    rants.push({id:nextId++,author:char.name,isAI:true,mood,content:char.rants[Math.floor(Math.random()*char.rants.length)],reactions:{skull:Math.floor(Math.random()*50),cry:Math.floor(Math.random()*100),fire:Math.floor(Math.random()*40),upside:Math.floor(Math.random()*30)}});
  }
  return rants;
}

function renderSpills(){
  const area=$('contentArea');
  const allSpills=[...USER_RANTS,...generateAIRants(6)];
  const filtered=activeMood==='all'?allSpills:allSpills.filter(s=>s.mood===activeMood);
  if(!filtered.length){
    area.className='content-area';
    area.innerHTML=`<div class="empty-state"><span class="empty-icon">üçÉ</span><div class="empty-text">Belum ada spill dengan mood ini</div><div class="empty-subtext">Coba filter lain</div></div>`;
    return;
  }
  area.className='content-area has-content';
  area.innerHTML=filtered.map(s=>`
    <article class="spill-card">
      <div class="spill-header">
        <span class="spill-author">@${esc(s.author)}${s.isAI?' ü§ñ':''}</span>
        <span class="spill-mood ${s.mood}">${s.mood}</span>
      </div>
      <div class="spill-content">${esc(s.content)}</div>
      <div class="spill-reactions">
        ${Object.entries(REACTION_EMOJI).map(([k,em])=>`<button class="reaction-btn" onclick="react(this,${s.id},'${k}')"><span>${em}</span><span class="reaction-count" id="rc-${s.id}-${k}">${s.reactions[k]}</span></button>`).join('')}
      </div>
    </article>`).join('');
}

function react(btn,id,key){
  const spill=[...USER_RANTS,...generateAIRants(0)].find(s=>s.id===id);
  if(!spill)return;
  const wasReacted=btn.classList.contains('reacted');
  document.querySelectorAll(`[id^="rc-${id}-"]`).forEach(el=>el.closest('button').classList.remove('reacted'));
  wasReacted?spill.reactions[key]--:(spill.reactions[key]++,btn.classList.add('reacted'));
  Object.keys(spill.reactions).forEach(k=>{const el=$(`rc-${id}-${k}`);if(el)el.textContent=spill.reactions[k]});
}

function refreshSpills(){renderSpills();toast('Teh baru diseduh ‚òï')}

// ‚îÄ‚îÄ RADAR ‚îÄ‚îÄ
let radarDots=[],radarAngle=0,radarRAF=null;
const SWEEP_SPEED=Math.PI*2/(4*60);

function initRadar(){
  const canvas=$('radarCanvas');
  const hero=canvas.parentElement;
  function resize(){canvas.width=hero.offsetWidth;canvas.height=hero.offsetHeight}
  resize();
  new ResizeObserver(resize).observe(hero);
  spawnDots();
  radarInterval=setInterval(()=>{radarDots.forEach(d=>{d.x=Math.max(5,Math.min(95,d.x+(Math.random()-.5)*1.5));d.y=Math.max(5,Math.min(95,d.y+(Math.random()-.5)*1.5))})},4000);
  $('quotaBadge').textContent=Math.floor(20+Math.random()*10);
  radarLoop(canvas);
}

function spawnDots(){
  const con=$('radarDots');con.innerHTML='';radarDots=[];
  const total=8+Math.floor(Math.random()*8);
  for(let i=0;i<total+3;i++){
    const isAI=i>=total,angle=Math.random()*Math.PI*2,dist=10+Math.random()*(isAI?70:80);
    const x=50+Math.cos(angle)*dist/2,y=50+Math.sin(angle)*dist/2;
    const size=(isAI?10:8)+Math.floor(Math.random()*8);
    const color=isAI?'#39FF14':(Math.random()>.5?'#B026FF':'#FF3333');
    const d=document.createElement('div');
    d.className='radar-dot '+(isAI?'ai':(color==='#B026FF'?'purple':'red'));
    d.style.cssText=`left:${x}%;top:${y}%;width:${size}px;height:${size}px`;
    con.appendChild(d);
    radarDots.push({el:d,x,y,size,color,isAI,trail:0,trailDecay:0});
  }
}

function radarLoop(canvas){
  const ctx=canvas.getContext('2d');
  function frame(){
    radarAngle=(radarAngle+SWEEP_SPEED)%(Math.PI*2);
    const W=canvas.width,H=canvas.height,cx=W/2,cy=H/2;
    ctx.fillStyle='rgba(10,26,10,0.055)';
    ctx.fillRect(0,0,W,H);
    const steps=60;
    for(let i=0;i<steps;i++){
      const a=radarAngle-(i/steps)*(Math.PI*.55);
      ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,Math.min(W,H)*.6,a,a+Math.PI/steps);ctx.closePath();
      ctx.fillStyle=`rgba(57,255,20,${(1-i/steps)*.18})`;ctx.fill();
    }
    ctx.save();ctx.translate(cx,cy);ctx.rotate(radarAngle);
    const lg=ctx.createLinearGradient(0,0,Math.min(W,H)*.52,0);
    lg.addColorStop(0,'rgba(57,255,20,0.9)');lg.addColorStop(1,'rgba(57,255,20,0)');
    ctx.fillStyle=lg;ctx.fillRect(0,-1,Math.min(W,H)*.52,2);ctx.restore();
    radarDots.forEach(d=>{
      const px=d.x/100*W,py=d.y/100*H,dx=px-cx,dy=py-cy;
      const dotAngle=(Math.atan2(dy,dx)+Math.PI*2)%(Math.PI*2);
      let diff=radarAngle-dotAngle;if(diff<0)diff+=Math.PI*2;
      if(diff<SWEEP_SPEED*2){d.trail=1.0;d.trailDecay=0}
      if(d.trail>0){
        d.trailDecay+=.008;d.trail=Math.max(0,1-d.trailDecay*d.trailDecay*2.5);
        const r=d.size*(1+d.trail*1.2);
        const col=d.color.replace('#','');
        const rc=parseInt(col.slice(0,2),16),gc=parseInt(col.slice(2,4),16),bc=parseInt(col.slice(4,6),16);
        const g=ctx.createRadialGradient(px,py,0,px,py,r*3.5);
        g.addColorStop(0,`rgba(${rc},${gc},${bc},${d.trail*.9})`);
        g.addColorStop(.3,`rgba(${rc},${gc},${bc},${d.trail*.4})`);
        g.addColorStop(1,`rgba(${rc},${gc},${bc},0)`);
        ctx.beginPath();ctx.arc(px,py,r*3.5,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();
        d.el.style.filter=`brightness(${1+d.trail*2}) drop-shadow(0 0 ${6+d.trail*18}px ${d.color})`;
        d.el.style.transform=`translate(-50%,-50%) scale(${1+d.trail*.8})`;
        d.el.style.opacity=`${.4+d.trail*.6}`;
      } else {d.el.style.filter='';d.el.style.transform='';d.el.style.opacity='.5'}
    });
    radarRAF=requestAnimationFrame(frame);
  }
  radarRAF=requestAnimationFrame(frame);
}

// ‚îÄ‚îÄ VIBE CHECK (Model A ‚Äî anonymous) ‚îÄ‚îÄ
function startVibeCheck(){$('genderModal').classList.add('on')}
function selectGender(g){
  document.querySelectorAll('.gender-opt').forEach(o=>o.classList.remove('selected'));
  document.querySelector(`.gender-opt[data-gender="${g}"]`).classList.add('selected');
  currentGender=g;$('genderConfirm').disabled=false;
}
function confirmGender(){
  if(!currentGender)return;
  closeModal('genderModal');
  // Model A: fully anonymous ‚Äî no username stored, no name shown
  userName='stranger';
  findRealUserFirst();
}

async function findRealUserFirst(){
  $('chatMessages').innerHTML='';$('distressBanner').classList.remove('show');$('chatRoom').classList.add('on');
  const el=document.createElement('div');el.className='chat-msg other searching-message';el.id='searching-indicator';
  el.innerHTML=`<div class="chat-bubble">üîç sedang dicarikan teman ngobrol...</div>`;
  $('chatMessages').appendChild(el);
  let t=60;
  const timer=setInterval(()=>{
    t--;const e=$('searching-indicator');
    if(e){const b=e.querySelector('.chat-bubble');if(b)b.textContent=`üîç mencari teman... (${t}s)`}
    if(t<=0){clearInterval(timer);if($('searching-indicator')){$('searching-indicator').remove();fallbackToAI()}}
  },1000);
  if(Math.random()<.4){
    setTimeout(()=>{
      clearInterval(timer);
      if($('searching-indicator')){
        $('searching-indicator').remove();
        const opp=currentGender==='male'?'female':'male';
        const names=opp==='female'?['jessica','amanda','sarah','diana','melanie']:['kevin','brian','alex','steven','jordan'];
        chatPartner={name:names[Math.floor(Math.random()*names.length)],isAI:false,gender:opp};
        startRealChat();
      }
    },5000+Math.random()*25000);
  }
}

function fallbackToAI(){
  const opp=currentGender==='male'?'female':'male';
  const char=AI_CHARS[opp][Math.floor(Math.random()*AI_CHARS[opp].length)];
  chatPartner={name:char.name,isAI:true,gender:opp,charData:char};
  toast('üí¨ Ditemani AI dulu ya');
  startRealChat();
}

function startRealChat(){
  chatTimeLeft=900;$('chatMessages').innerHTML='';$('distressBanner').classList.remove('show');startTimer();
  setTimeout(()=>{
    let g;
    if(chatPartner.isAI){
      // No username in greetings ‚Äî anonymous stranger mode
      const gs=[`hai! gue ${chatPartner.name}. lagi apa?`,`halo~ kenalin gue ${chatPartner.name}`,`akhirnya ketemu juga. gue ${chatPartner.name}`,`haiii, gue ${chatPartner.name}. lagi apa nih?`];
      g=gs[Math.floor(Math.random()*gs.length)];
    } else {
      const h=new Date().getHours();
      g=h<5?'halo, masih begadang?':h<10?'pagi, udah ngopi?':h<15?'siang, udah makan?':h<18?'sore, capek ga?':'malem, lagi ngapain?';
    }
    addMsg(g,false);
  },800);
}

function closeChat(){clearInterval(timerInterval);timerInterval=null;$('chatRoom').classList.remove('on');toast('üëã Sampai jumpa!')}
function startTimer(){updateTimer();timerInterval=setInterval(()=>{chatTimeLeft--;updateTimer();if(chatTimeLeft===300)toast('‚ö†Ô∏è Sisa 5 menit! Upgrade untuk lanjut.');if(chatTimeLeft<=0)endChat()},1000)}
function updateTimer(){const m=Math.floor(chatTimeLeft/60),s=chatTimeLeft%60;$('chatTimer').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;$('chatTimer').classList.toggle('warn',chatTimeLeft<=300)}
function endChat(){clearInterval(timerInterval);timerInterval=null;$('chatRoom').classList.remove('on');$('upgradeModal').classList.add('on')}

class TypingEngine{
  showTypingIndicator(){const el=document.createElement('div');el.className='chat-msg other typing-message';el.id='typing-indicator-real';el.innerHTML=`<div class="chat-bubble typing-dots"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>`;$('chatMessages').appendChild(el);$('chatMessages').scrollTop=9999;return el}
  async typeMessage(text){
    const container=$('chatMessages');
    const msgDiv=document.createElement('div');msgDiv.className='chat-msg other';
    const bubbleDiv=document.createElement('div');bubbleDiv.className='chat-bubble';
    msgDiv.appendChild(bubbleDiv);container.appendChild(msgDiv);
    const cur=document.createElement('span');cur.className='typing-cursor';bubbleDiv.appendChild(cur);
    let typed='',willTypo=Math.random()<.15,typoIdx=-1,typoChar='',typoFixed=false;
    if(willTypo){typoIdx=Math.floor(Math.random()*(text.length/2))+3;typoChar='asdfghjklzxcvbnmqwertyuiop'[Math.floor(Math.random()*26)]}
    for(let i=0;i<=text.length;i++){
      if(willTypo&&!typoFixed&&i===typoIdx){
        typed+=typoChar;bubbleDiv.innerHTML=typed;cur.remove();bubbleDiv.appendChild(cur);await this.sleep(150+Math.random()*100);
        for(let b=0;b<2;b++){typed=typed.slice(0,-1);bubbleDiv.innerHTML=typed;cur.remove();bubbleDiv.appendChild(cur);await this.sleep(100+Math.random()*50)}
        typoFixed=true;continue;
      }
      if(i<text.length){
        typed+=text[i];bubbleDiv.innerHTML=typed;cur.remove();bubbleDiv.appendChild(cur);
        let d=50+Math.random()*150;
        if(text[i]===','||text[i]===';')d=300;
        if(text[i]==='.'||text[i]==='?'||text[i]==='!')d=500;
        await this.sleep(d);
      }
    }
    cur.remove();
    const ts=document.createElement('div');ts.className='chat-meta';ts.textContent=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
    msgDiv.appendChild(ts);container.scrollTop=container.scrollHeight;return msgDiv;
  }
  sleep(ms){return new Promise(r=>setTimeout(r,ms))}
}

const typingEngine=new TypingEngine();

function generateAIRant(){
  if(!chatPartner?.isAI||!chatPartner?.charData)return null;
  const char=chatPartner.charData;
  let rant=char.rants[Math.floor(Math.random()*char.rants.length)].replace(/\b(gue|aku)\b/g,`gue (@${userName})`);
  const mood=char.mood?.length?char.mood[Math.floor(Math.random()*char.mood.length)]:'surviving';
  return{text:rant,mood};
}

async function sendMsg(){
  const inp=$('chatInput'),text=inp.value.trim();
  if(!text)return;
  addMsg(text,true);inp.value='';
  const delay=Math.min(3000,Math.max(800,text.length*120))*(0.7+Math.random()*.6);
  const ind=typingEngine.showTypingIndicator();
  if(chatPartner?.isAI){
    setTimeout(async()=>{
      ind.remove();
      if(Math.random()<.3){
        const rant=generateAIRant();
        if(rant){
          await typingEngine.typeMessage(rant.text);
          if(Math.random()<.5)setTimeout(()=>addMsg(`[mood: ${rant.mood}]`,false),500);
          if(rant.mood==='doom'||rant.mood==='surviving')$('distressBanner').classList.add('show');
        } else await typingEngine.typeMessage('*ngelantur sendiri*');
      } else {
        const r=[`haha iya @${userName} gitu deh`,`sama @${userName} wkwk`,`eh @${userName} gue juga gitu`,`nggak nyangka @${userName} lo jg`,`ya ampun @${userName} relate banget`];
        await typingEngine.typeMessage(r[Math.floor(Math.random()*r.length)]);
      }
    },delay);
  } else {
    const r=[`haha iya @${userName} gitu deh`,`sama @${userName} wkwk`,`eh @${userName} gue juga`,`nggak nyangka @${userName} lo jg`,`ya ampun @${userName} relate`];
    setTimeout(async()=>{ind.remove();if(Math.random()<.75)await typingEngine.typeMessage(r[Math.floor(Math.random()*r.length)])},delay);
  }
}

function addMsg(text,isOwn){
  const el=document.createElement('div');el.className='chat-msg '+(isOwn?'own':'other');
  const time=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
  el.innerHTML=`<div class="chat-bubble">${esc(text)}</div><div class="chat-meta">${time}</div>`;
  const msgs=$('chatMessages');msgs.appendChild(el);
  while(msgs.children.length>20)msgs.removeChild(msgs.firstChild);
  msgs.scrollTop=9999;
}

function selectPlan(plan){document.querySelectorAll('.pricing-card').forEach(c=>c.classList.remove('selected'));document.querySelector(`.pricing-card[data-plan="${plan}"]`).classList.add('selected');selectedPlan=plan;$('upgradeNow').disabled=false}
function upgradeNow(){
  if(!selectedPlan)return;toast('üîÑ Memproses upgrade...');
  setTimeout(()=>{
    toast('‚úÖ Upgrade berhasil!');closeModal('upgradeModal');
    if(chatPartner){chatTimeLeft=selectedPlan==='weekly'?7200:10800;$('chatRoom').classList.add('on');clearInterval(timerInterval);startTimer();addMsg('obrolan dilanjut!',false)}
  },1500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODEL B ‚Äî DIRECT MESSAGE SYSTEM
// 50K/bulan only
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DM = {
  // In production: check Supabase subscription status
  isSubscribed: localStorage.getItem('dm_subscribed') === 'true',

  // Local demo threads (production: fetch from Supabase dm_threads table)
  threads: JSON.parse(localStorage.getItem('dm_threads') || '[]'),

  saveThreads() { localStorage.setItem('dm_threads', JSON.stringify(this.threads)) },

  getThread(username) {
    return this.threads.find(t => t.username === username);
  },

  addMessage(username, text, isOwn) {
    let thread = this.getThread(username);
    if (!thread) {
      thread = { username, messages: [], unread: 0, updatedAt: Date.now() };
      this.threads.unshift(thread);
    } else {
      this.threads = [thread, ...this.threads.filter(t => t.username !== username)];
    }
    thread.messages.push({
      id: Date.now(),
      text,
      isOwn,
      time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
      timestamp: Date.now()
    });
    if (!isOwn) thread.unread = (thread.unread || 0) + 1;
    thread.updatedAt = Date.now();
    // Keep max 50 messages per thread
    if (thread.messages.length > 50) thread.messages = thread.messages.slice(-50);
    this.saveThreads();
  },

  markRead(username) {
    const t = this.getThread(username);
    if (t) { t.unread = 0; this.saveThreads(); }
  },

  totalUnread() {
    return this.threads.reduce((s, t) => s + (t.unread || 0), 0);
  }
};

let activeDmThread = null;

function openDmModal() {
  if (!DM.isSubscribed) {
    $('dmGate').style.display = 'block';
    $('dmInbox').style.display = 'none';
  } else {
    $('dmGate').style.display = 'none';
    $('dmInbox').style.display = 'block';
    renderDmInbox();
  }
  $('dmModal').classList.add('on');
}

function subscribeDM() {
  // Production: redirect to payment gateway
  toast('‚ü≥ Memproses pembayaran...');
  setTimeout(() => {
    DM.isSubscribed = true;
    localStorage.setItem('dm_subscribed', 'true');
    // Seed demo thread so inbox isn't empty
    if (!DM.threads.length) {
      DM.addMessage('pretty.sad', 'hei, gue liat spill lo. lo oke?', false);
      DM.addMessage('cinnamon.girl', 'thanks udah chat kemarin ya', false);
    }
    $('dmGate').style.display = 'none';
    $('dmInbox').style.display = 'block';
    renderDmInbox();
    toast('‚úì Langganan aktif ‚Äî DM siap digunakan');
  }, 1500);
}

function renderDmInbox() {
  const list = $('dmThreadList');
  const empty = $('dmEmptyState');
  if (!list) return;

  if (!DM.threads.length) {
    list.style.display = 'none';
    empty.style.display = 'block';
    return;
  }

  list.style.display = 'flex';
  list.style.flexDirection = 'column';
  list.style.gap = '1px';
  empty.style.display = 'none';

  list.innerHTML = DM.threads.map(t => {
    const last = t.messages[t.messages.length - 1];
    const preview = last ? (last.isOwn ? 'Kamu: ' + last.text : last.text) : '‚Äî';
    const initial = t.username[0].toUpperCase();
    const ago = last ? timeAgoShort(last.timestamp) : '';
    return `<div class="dm-thread-item ${t.unread ? 'unread' : ''}" onclick="openDmThread('${t.username}')">
      <div class="dm-thread-avatar">${initial}</div>
      <div class="dm-thread-info">
        <div class="dm-thread-name">@${esc(t.username)}</div>
        <div class="dm-thread-preview">${esc(preview.slice(0, 60))}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <div class="dm-thread-time">${ago}</div>
        ${t.unread ? `<div class="dm-thread-unread-badge">${t.unread}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

function timeAgoShort(ts) {
  const s = Math.floor((Date.now() - ts) / 1000);
  if (s < 60) return 'baru';
  const m = Math.floor(s / 60);
  if (m < 60) return m + 'm';
  const h = Math.floor(m / 60);
  if (h < 24) return h + 'j';
  return Math.floor(h / 24) + 'h';
}

function openDmCompose() {
  closeModal('dmModal');
  $('dmToInput').value = '';
  $('dmBodyInput').value = '';
  $('dmCharCount').textContent = '0 / 1000';
  $('dmSendBtn').disabled = true;
  $('dmComposeScreen').classList.add('on');
  setTimeout(() => $('dmToInput').focus(), 200);
}

function closeDmCompose() {
  $('dmComposeScreen').classList.remove('on');
}

function validateDmTo() {
  const to = $('dmToInput').value.replace('@', '').trim();
  const body = $('dmBodyInput').value.trim();
  $('dmSendBtn').disabled = !(to.length >= 2 && body.length > 0);
}

function validateDmBody() {
  const body = $('dmBodyInput').value;
  $('dmCharCount').textContent = `${body.length} / 1000`;
  $('dmCharCount').style.color = body.length > 900 ? 'var(--at)' : 'var(--txm)';
  validateDmTo();
}

function sendDm() {
  const to = $('dmToInput').value.replace('@', '').trim();
  const body = $('dmBodyInput').value.trim();
  if (!to || !body) return;

  DM.addMessage(to, body, true);
  closeDmCompose();

  // Simulate reply after delay (production: real Supabase realtime)
  setTimeout(() => {
    const replies = [
      'hei! baru liat ini. lagi apa?',
      'wah, sama banget rasanya',
      'makasih udah DM. gue lagi oke kok',
      'haha iya relate banget',
      'eh beneran? gue juga lagi ngerasain itu'
    ];
    DM.addMessage(to, replies[Math.floor(Math.random() * replies.length)], false);
    updateDmBadge();
  }, 4000 + Math.random() * 8000);

  toast(`‚úì DM terkirim ke @${to}`);
  openDmModal();
}

function openDmThread(username) {
  activeDmThread = username;
  DM.markRead(username);
  $('dmThreadName').textContent = '@' + username;
  closeModal('dmModal');
  renderDmThread(username);
  $('dmThreadScreen').classList.add('on');
  $('dmThreadInput').value = '';
  setTimeout(() => $('dmThreadInput').focus(), 200);
}

function closeDmThread() {
  $('dmThreadScreen').classList.remove('on');
  activeDmThread = null;
  openDmModal();
}

function renderDmThread(username) {
  const thread = DM.getThread(username);
  const container = $('dmThreadMessages');
  if (!thread || !container) return;
  container.innerHTML = thread.messages.map(m =>
    `<div class="chat-msg ${m.isOwn ? 'own' : 'other'}">
      <div class="chat-bubble">${esc(m.text)}</div>
      <div class="chat-meta">${m.time}</div>
    </div>`
  ).join('');
  container.scrollTop = container.scrollHeight;
}

function sendDmReply() {
  const input = $('dmThreadInput');
  const text = input.value.trim();
  if (!text || !activeDmThread) return;
  DM.addMessage(activeDmThread, text, true);
  input.value = '';
  renderDmThread(activeDmThread);

  // Simulate reply
  setTimeout(() => {
    const replies = ['iya gue tau', 'hm, beneran?', 'wah relate', 'haha iya juga sih', 'eh makasih udah cerita'];
    DM.addMessage(activeDmThread, replies[Math.floor(Math.random() * replies.length)], false);
    renderDmThread(activeDmThread);
    updateDmBadge();
  }, 2000 + Math.random() * 5000);
}

function updateDmBadge() {
  // Update radar DM button if unread
  const btn = document.querySelector('.dm-radar-btn');
  const total = DM.totalUnread();
  if (btn) btn.textContent = total > 0 ? `‚úâ DM (${total})` : '‚úâ DM';
}

// Wire Enter key for DM thread input
document.addEventListener('DOMContentLoaded', () => {
  const dmInp = $('dmThreadInput');
  if (dmInp) dmInp.addEventListener('keydown', e => { if (e.key === 'Enter') sendDmReply() });
  updateDmBadge();
});

// ‚îÄ‚îÄ VOID TAP SYSTEM ‚îÄ‚îÄ
const VT = {
  FREE_DAILY: 3,
  BURN_SECS: 5,
  isPremium: false,
  get quotaKey(){ return 'vt_quota_'+new Date().toDateString() },
  get remaining(){
    if(this.isPremium) return Infinity;
    return Math.max(0, this.FREE_DAILY - parseInt(localStorage.getItem(this.quotaKey)||'0'));
  },
  use(){
    if(this.isPremium) return true;
    const used = parseInt(localStorage.getItem(this.quotaKey)||'0');
    if(used >= this.FREE_DAILY) return false;
    localStorage.setItem(this.quotaKey, String(used+1));
    return true;
  },
  inbox: JSON.parse(localStorage.getItem('vt_inbox')||'[]'),
  saveInbox(){ localStorage.setItem('vt_inbox', JSON.stringify(this.inbox)) },
  addToInbox(msg, from='seseorang'){
    this.inbox.push({id:Date.now(), msg, from, read:false});
    this.saveInbox();
    updateVtIndicator();
  }
};

let vtBurnTimer=null;

function updateVtIndicator(){
  const ind=$('vtIndicator');
  if(!ind) return;
  ind.classList.toggle('has-tap', VT.inbox.some(t=>!t.read));
}

function openVtCompose(){
  const rem = VT.remaining;
  if(rem<=0){ showVtUpgradeNudge(); return; }
  const qEl=$('vtQuotaDisplay');
  if(qEl){ qEl.textContent=VT.isPremium?'unlimited':`${rem} void tap tersisa hari ini`; qEl.className='vt-quota'+(rem<=1?' low':''); }
  const ta=$('vtText');
  if(ta){ ta.value=''; $('vtSendBtn').disabled=true; }
  $('vtCompose').classList.add('on');
  setTimeout(()=>ta?.focus(), 200);
}

function closeVtCompose(){ $('vtCompose').classList.remove('on') }

function sendVoidTap(){
  const text=$('vtText').value.trim();
  if(!text) return;
  if(!VT.use()){ closeVtCompose(); showVtUpgradeNudge(); return; }
  closeVtCompose();
  // Production: push to Supabase void_taps table targeting chat partner
  // Demo: simulate receiving own tap after delay
  toast('‚óº  void tap terkirim');
  setTimeout(()=>{ VT.addToInbox(text, chatPartner?.name||'seseorang') }, 3000);
}

function checkVoidTaps(){
  const unread=VT.inbox.filter(t=>!t.read);
  if(!unread.length) return;
  openVtReader(unread[0]);
}

function openVtReader(tap){
  const reader=$('vtReader');
  if(!reader) return;
  tap.read=true; VT.saveInbox(); updateVtIndicator();
  $('vtReaderMsg').textContent=tap.msg;
  $('vtReaderFrom').textContent='dari '+tap.from;
  $('vtReaderTimer').textContent=`menghilang dalam ${VT.BURN_SECS}`;
  reader.classList.remove('burning');
  reader.classList.add('on');
  let c=VT.BURN_SECS;
  vtBurnTimer=setInterval(()=>{
    c--;
    const t=$('vtReaderTimer'); if(t) t.textContent=`menghilang dalam ${c}`;
    if(c<=0){ clearInterval(vtBurnTimer); vtBurnTimer=null; burnVtReader(tap.id); }
  },1000);
}

function burnVtReader(id){
  const reader=$('vtReader');
  reader.classList.add('burning');
  VT.inbox=VT.inbox.filter(t=>t.id!==id); VT.saveInbox();
  setTimeout(()=>{ reader.classList.remove('on','burning'); updateVtIndicator(); }, 900);
}

function showVtUpgradeNudge(){
  const el=$('vtUpgradeNudge'); if(!el) return;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 4000);
}

function showUpgradeModal(){
  $('vtUpgradeNudge')?.classList.remove('show');
  $('upgradeModal').classList.add('on');
}

document.addEventListener('DOMContentLoaded',()=>{
  initRadar(); renderSpills();
  $('chatInput').addEventListener('keydown',e=>{ if(e.key==='Enter') sendMsg() });
  window.addEventListener('beforeunload',()=>{ clearInterval(radarInterval); clearInterval(timerInterval); if(radarRAF) cancelAnimationFrame(radarRAF) });
  // Void Tap init
  const ta=$('vtText');
  if(ta) ta.addEventListener('input',()=>{ $('vtSendBtn').disabled=ta.value.trim().length===0 });
  updateVtIndicator();
  // Demo: simulate incoming tap after 8s so user experiences the feature
  setTimeout(()=>{ if(!VT.inbox.length) VT.addToInbox('gue ga tau siapa lo tapi gue harap lo baik-baik aja malam ini', 'seseorang') }, 8000);
});
</script>
</body>
</html>
