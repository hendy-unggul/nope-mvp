<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=no">
<title>Spill ‚Äî JEJAK</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
<script src="https://unpkg.com/htmx.org@2.0.0"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
:root{
  --bg:#0A0A0A;
  --surface:#141414;
  --surface-light:#1E1E1E;
  --border:#2A2A2A;
  --text:#FFF;
  --text-secondary:#888;
  --text-muted:#555;
  --primary:#FF4D00;
  --emosi:#00F0FF;
  --agak:#FF006E;
  --surviving:#39FF14;
  --chaotic:#00F0FF;
  --doom:#8B5CF6;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:'Plus Jakarta Sans',system-ui,sans-serif;
  min-height:100vh;
  padding-bottom:80px;
}
.wrapper{
  max-width:480px;
  margin:0 auto;
  padding:24px 16px;
}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:32px;
  padding-bottom:16px;
  border-bottom:1px solid var(--border);
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
}
.brand-icon{
  font-size:32px;
}
.brand-text{
  font-size:28px;
  font-weight:800;
  letter-spacing:-.02em;
  background:linear-gradient(135deg, var(--primary), #FF8A5C);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.header-actions{
  display:flex;
  align-items:center;
  gap:12px;
}
.connection-dot{
  width:8px;
  height:8px;
  background:var(--surviving);
  border-radius:50%;
  animation:blink 2s infinite;
  margin-right:8px;
}
@keyframes blink{
  0%,100%{opacity:1}
  50%{opacity:.3}
}
.menu-trigger{
  width:32px;
  height:32px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:3px;
  background:transparent;
  border:none;
  cursor:pointer;
}
.menu-trigger span{
  width:4px;
  height:4px;
  background:var(--text);
  border-radius:50%;
  transition:all .2s;
}
.menu-trigger:hover span{
  background:var(--primary)
}

/* RADAR HERO */
.radar-hero {
  width: 100%;
  aspect-ratio: 1/1;
  margin-bottom: 24px;
  border-radius: 20px;
  overflow: hidden;
  border: 2px solid var(--border);
  position: relative;
  background: #000;
}

.radar-container {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: radial-gradient(circle at 30% 30%, #1A3A1A, #0A1A0A);
}

.radar-grid {
  position: absolute;
  inset: 0;
  background-image: 
    repeating-linear-gradient(0deg, var(--border) 0px, transparent 1px, transparent 20px),
    repeating-linear-gradient(90deg, var(--border) 0px, transparent 1px, transparent 20px);
  opacity: 0.3;
  animation: radar-scan 8s infinite linear;
}

@keyframes radar-scan {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.radar-circles {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  box-shadow: inset 0 0 0 2px var(--surviving);
}

.radar-circles::before,
.radar-circles::after {
  content: '';
  position: absolute;
  inset: 25%;
  border-radius: 50%;
  box-shadow: inset 0 0 0 2px var(--surviving);
  opacity: 0.5;
}

.radar-circles::after {
  inset: 50%;
}

.radar-line {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 50%;
  height: 2px;
  background: linear-gradient(90deg, var(--surviving), transparent);
  transform-origin: left;
  animation: radar-spin 4s infinite linear;
  opacity: 0.8;
  z-index: 25;
  pointer-events: none;
}

@keyframes radar-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.radar-sweep {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 70%;
  height: 70%;
  background: radial-gradient(circle at 0% 50%, rgba(57, 255, 20, 0.3), transparent 70%);
  transform-origin: left;
  animation: radar-sweep 4s infinite linear;
  z-index: 20;
  pointer-events: none;
  filter: blur(10px);
}

@keyframes radar-sweep {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.radar-dot {
  position: absolute;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: radar-blink 1.5s infinite ease-in-out;
  z-index: 30;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 0 10px currentColor;
}

.radar-dot:hover {
  transform: translate(-50%, -50%) scale(2);
  box-shadow: 0 0 30px currentColor;
  z-index: 50;
}

.radar-dot.purple {
  background: #B026FF;
  box-shadow: 0 0 15px #B026FF;
}

.radar-dot.red {
  background: #FF3333;
  box-shadow: 0 0 15px #FF3333;
}

.radar-dot.ai {
  background: var(--surviving);
  box-shadow: 0 0 15px var(--surviving);
  animation: radar-blink 2.5s infinite;
}

@keyframes radar-blink {
  0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  50% { opacity: 0.7; transform: translate(-50%, -50%) scale(0.9); }
}

.radar-dot.highlighted {
  filter: brightness(1.5);
  box-shadow: 0 0 30px currentColor;
  transform: translate(-50%, -50%) scale(1.3);
  z-index: 40;
  transition: all 0.1s;
}

.radar-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: flex-start;
  text-align: left;
  z-index: 10;
  pointer-events: none;
  padding: 16px;
}

.radar-title {
  font-size: 24px;
  font-weight: 800;
  text-transform: uppercase;
  color: #fff;
  text-shadow: 
    2px 0 0 #FF3333,
    -2px 0 0 #B026FF,
    0 0 20px var(--surviving);
  letter-spacing: 4px;
  margin-bottom: 8px;
  position: relative;
  pointer-events: auto;
  background: rgba(0,0,0,0.5);
  padding: 4px 12px;
  border-radius: 30px;
  backdrop-filter: blur(5px);
  border: 1px solid var(--border);
}

.quota-display {
  display: flex;
  align-items: center;
  gap: 12px;
  background: rgba(0,0,0,0.7);
  padding: 4px 12px;
  border-radius: 30px;
  backdrop-filter: blur(5px);
  border: 1px solid var(--border);
  font-size: 12px;
  pointer-events: auto;
  margin-top: 8px;
}

.quota-badge {
  color: var(--surviving);
  font-weight: 700;
}

.quota-badge.empty {
  color: #FF3333;
}

/* VIBE CHECK BUTTON */
.vibe-check-btn {
  position: absolute;
  bottom: 16px;
  right: 16px;
  background: var(--primary);
  color: var(--bg);
  border: none;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
  border-radius: 40px;
  transition: all 0.2s;
  z-index: 30;
  pointer-events: auto;
  box-shadow: 0 0 20px rgba(255,77,0,0.5);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.vibe-check-btn:hover {
  background: var(--text);
  color: var(--bg);
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(255,255,255,0.5);
}

/* FILTER SECTION */
.filter-section{
  background:var(--surface);
  border:1px solid var(--border);
  padding:20px;
  margin-bottom:24px;
  border-radius:20px;
}
.filter-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}
.filter-title{
  font-size:14px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.05em;
  display:flex;
  align-items:center;
  gap:8px;
}
.vibe-percentage{
  color:var(--primary);
  font-weight:800;
}
.reset-btn{
  background:transparent;
  border:1px solid var(--primary);
  color:var(--primary);
  padding:6px 12px;
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  cursor:pointer;
  border-radius:30px;
  transition:all .2s;
}
.reset-btn:hover{
  background:var(--primary);
  color:var(--bg);
}
.vibe-slider{
  width:100%;
  height:4px;
  background:var(--border);
  outline:none;
  -webkit-appearance:none;
  margin-bottom:8px;
  display:block;
}
.vibe-slider::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:24px;
  height:24px;
  background:var(--primary);
  border:2px solid var(--text);
  border-radius:50%;
  cursor:pointer;
}
.vibe-labels{
  display:flex;
  justify-content:space-between;
  font-size:11px;
  color:var(--text-muted);
  text-transform:uppercase;
  margin-bottom:20px;
}
.mood-filters{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.mood-btn{
  padding:8px 16px;
  background:var(--surface-light);
  border:1px solid var(--border);
  color:var(--text-secondary);
  font-size:12px;
  font-weight:600;
  text-transform:uppercase;
  cursor:pointer;
  border-radius:30px;
  transition:all .2s;
}
.mood-btn.active{
  background:var(--primary);
  border-color:var(--primary);
  color:var(--bg);
}
.mood-btn:hover:not(.active){
  border-color:var(--text);
}

/* CONTENT AREA */
.content-area{
  min-height:300px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  border:2px dashed var(--border);
  padding:40px;
  border-radius:20px;
  margin-bottom:24px;
}
.content-area.has-content{
  border-style:solid;
  border-color:var(--border);
  padding:0;
  align-items:stretch;
  justify-content:flex-start;
  gap:16px;
  background:transparent;
  border:none;
}
.spinner{
  width:48px;
  height:48px;
  border:3px solid var(--border);
  border-top-color:var(--primary);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:16px;
}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{
  color:var(--text-secondary);
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.1em;
}

/* SPILL CARD */
.spill-card{
  background:var(--surface);
  border:1px solid var(--border);
  padding:20px;
  border-radius:20px;
  animation:fadeIn .4s ease;
  margin-bottom:16px;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:translateY(0)}
}
.spill-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
  padding-bottom:12px;
  border-bottom:1px solid var(--border);
}
.spill-author{
  font-size:12px;
  font-weight:700;
  color:var(--text-secondary);
  cursor:pointer;
  transition:color .2s;
}
.spill-author:hover{
  color:var(--primary);
}
.spill-mood{
  font-size:10px;
  padding:4px 8px;
  border:1px solid currentColor;
  border-radius:30px;
  text-transform:uppercase;
}
.spill-content{
  font-size:15px;
  line-height:1.6;
  margin-bottom:16px;
}

/* REACTIONS */
.spill-reactions{
  display:flex;
  gap:6px;
  flex-wrap:nowrap;
  justify-content:space-between;
}
.reaction-btn{
  display:flex;
  align-items:center;
  gap:4px;
  background:var(--surface-light);
  border:1px solid var(--border);
  color:var(--text-secondary);
  padding:6px 10px;
  font-size:12px;
  cursor:pointer;
  transition:all .2s;
  border-radius:30px;
  flex:1;
  justify-content:center;
}
.reaction-btn:hover{
  border-color:var(--primary);
  background:var(--primary);
  color:var(--bg);
  transform:scale(1.05);
}
.reaction-btn.reacted{
  background:var(--primary);
  border-color:var(--primary);
  color:var(--bg);
}
.reaction-emoji{
  font-size:14px;
}
.reaction-count{
  font-weight:600;
  font-size:11px;
  min-width:14px;
  text-align:center;
}

/* NEW SPILL BUTTON */
.new-spill-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  width:100%;
  padding:16px;
  background:transparent;
  border:2px solid var(--primary);
  color:var(--primary);
  font-size:14px;
  font-weight:700;
  text-transform:uppercase;
  cursor:pointer;
  margin-top:24px;
  margin-bottom:32px;
  border-radius:40px;
  transition:all .2s;
}
.new-spill-btn:hover{
  background:var(--primary);
  color:var(--bg);
}

/* EMPTY STATE */
.empty-state{
  text-align:center;
  padding:40px;
}
.empty-icon{
  font-size:48px;
  margin-bottom:16px;
  opacity:0.5;
}
.empty-text{
  color:var(--text-secondary);
  font-style:italic;
  margin-bottom:8px;
}
.empty-subtext{
  color:var(--text-muted);
  font-size:12px;
}

/* TOAST */
.toast{
  position:fixed;
  bottom:100px;
  left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--text);
  color:var(--bg);
  padding:12px 24px;
  font-size:13px;
  font-weight:600;
  border-radius:40px;
  z-index:10000;
  opacity:0;
  transition:all .3s;
  box-shadow:0 4px 20px rgba(0,0,0,0.5);
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}
.toast.error{
  background:#FF3333;
  color:var(--text);
}

/* MODAL GENDER */
.gender-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.98);
  z-index: 20000;
  padding: 20px;
  overflow-y: auto;
  backdrop-filter: blur(10px);
}

.gender-modal.on { display: flex; align-items: center; justify-content: center; }

.gender-container {
  max-width: 480px;
  width: 100%;
  background: var(--surface);
  border: 3px solid var(--primary);
  padding: 32px 24px;
  position: relative;
  box-shadow: 10px 10px 0 var(--primary);
}

.gender-container::before {
  content: 'VIBE CHECK';
  position: absolute;
  top: -12px;
  left: 20px;
  background: var(--surface);
  padding: 0 10px;
  font-size: 12px;
  font-weight: 800;
  color: var(--primary);
  letter-spacing: 2px;
}

.gender-title {
  font-size: 32px;
  font-weight: 800;
  text-transform: uppercase;
  margin-bottom: 8px;
  background: linear-gradient(135deg, var(--primary), #FF8A5C);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-align: center;
}

.gender-sub {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 32px;
  text-align: center;
  font-style: italic;
}

.gender-options {
  display: flex;
  gap: 16px;
  margin-bottom: 32px;
}

.gender-option {
  flex: 1;
  background: var(--surface-light);
  border: 3px solid var(--border);
  padding: 24px 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.gender-option:hover {
  border-color: var(--primary);
  transform: translateY(-4px);
}

.gender-option.selected {
  border-color: var(--primary);
  background: linear-gradient(145deg, var(--surface-light), #2A2A2A);
}

.gender-option.selected::after {
  content: '‚úì';
  position: absolute;
  top: 8px;
  right: 8px;
  color: var(--primary);
  font-weight: 800;
}

.gender-icon {
  font-size: 48px;
  margin-bottom: 12px;
  display: block;
}

.gender-label {
  font-size: 18px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 4px;
}

.gender-desc {
  font-size: 11px;
  color: var(--text-secondary);
}

.gender-note {
  background: rgba(255,77,0,0.1);
  border-left: 4px solid var(--primary);
  padding: 16px;
  margin-bottom: 24px;
  font-size: 13px;
  color: var(--text-secondary);
}

.gender-note strong {
  color: var(--primary);
}

.gender-confirm {
  width: 100%;
  padding: 16px;
  background: var(--primary);
  color: var(--bg);
  border: none;
  font-size: 16px;
  font-weight: 800;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 6px 6px 0 var(--bg), 6px 6px 0 2px var(--primary);
}

.gender-confirm:hover {
  transform: translate(3px, 3px);
  box-shadow: 3px 3px 0 var(--bg), 3px 3px 0 2px var(--primary);
}

.gender-confirm:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* MODAL UPGRADE */
.upgrade-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.98);
  z-index: 20001;
  padding: 20px;
  overflow-y: auto;
  backdrop-filter: blur(10px);
}

.upgrade-modal.on { display: flex; align-items: center; justify-content: center; }

.upgrade-container {
  max-width: 480px;
  width: 100%;
  background: var(--surface);
  border: 3px solid var(--primary);
  padding: 32px 24px;
  position: relative;
  box-shadow: 10px 10px 0 var(--primary);
}

.upgrade-container::before {
  content: 'WAKTU HABIS';
  position: absolute;
  top: -12px;
  left: 20px;
  background: var(--surface);
  padding: 0 10px;
  font-size: 12px;
  font-weight: 800;
  color: #FF3333;
  letter-spacing: 2px;
}

.upgrade-title {
  font-size: 32px;
  font-weight: 800;
  text-transform: uppercase;
  margin-bottom: 16px;
  background: linear-gradient(135deg, #FF3333, #FF8A5C);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-align: center;
}

.upgrade-sub {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 24px;
  text-align: center;
  font-style: italic;
}

.timer-warning {
  background: rgba(255,51,51,0.1);
  border: 2px solid #FF3333;
  padding: 20px;
  margin-bottom: 24px;
  text-align: center;
}

.timer-warning .big {
  font-size: 48px;
  font-weight: 800;
  color: #FF3333;
  line-height: 1;
  margin-bottom: 8px;
}

.timer-warning .small {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 2px;
}

.pricing-grid {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 24px;
}

.pricing-card {
  background: var(--surface-light);
  border: 3px solid var(--border);
  padding: 20px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  display: flex;
  align-items: center;
  gap: 16px;
}

.pricing-card:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}

.pricing-card.selected {
  border-color: var(--primary);
  background: linear-gradient(145deg, var(--surface-light), #2A2A2A);
}

.pricing-card.selected::after {
  content: '‚úì';
  position: absolute;
  top: 8px;
  right: 8px;
  color: var(--primary);
  font-weight: 800;
}

.pricing-left {
  flex: 1;
}

.pricing-price {
  font-size: 28px;
  font-weight: 800;
  color: var(--primary);
  line-height: 1;
  margin-bottom: 4px;
}

.pricing-desc {
  font-size: 11px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.pricing-right {
  text-align: right;
}

.pricing-duration {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}

.pricing-limit {
  font-size: 11px;
  color: var(--surviving);
  background: rgba(57,255,20,0.1);
  padding: 2px 8px;
  border-radius: 20px;
}

.pricing-total {
  font-size: 10px;
  color: var(--text-muted);
}

.upgrade-actions {
  display: flex;
  gap: 12px;
}

.upgrade-btn {
  flex: 1;
  padding: 16px;
  background: var(--primary);
  color: var(--bg);
  border: none;
  font-size: 14px;
  font-weight: 800;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 4px 4px 0 var(--bg), 4px 4px 0 2px var(--primary);
}

.upgrade-btn:hover {
  transform: translate(2px, 2px);
  box-shadow: 2px 2px 0 var(--bg), 2px 2px 0 2px var(--primary);
}

.upgrade-btn.secondary {
  background: transparent;
  color: var(--text);
  border: 2px solid var(--border);
  box-shadow: none;
}

.upgrade-btn.secondary:hover {
  background: var(--surface-light);
}

/* CHAT ROOM */
.chat-room {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 15000;
  flex-direction: column;
}

.chat-room.on { display: flex; }

.chat-header {
  padding: 16px 20px;
  border-bottom: 3px solid var(--primary);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--surface);
}

.chat-info {
  display: flex;
  flex-direction: column;
}

.chat-with {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.chat-name {
  font-size: 18px;
  font-weight: 800;
  color: var(--primary);
}

.chat-timer {
  background: var(--surface-light);
  border: 2px solid var(--border);
  padding: 8px 16px;
  font-size: 20px;
  font-weight: 800;
  font-family: monospace;
  color: var(--surviving);
}

.chat-timer.warning {
  color: #FF3333;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  background: var(--bg);
}

.chat-message {
  display: flex;
  flex-direction: column;
  max-width: 80%;
}

.chat-message.own {
  align-self: flex-end;
}

.chat-message.other {
  align-self: flex-start;
}

.chat-bubble {
  padding: 12px 16px;
  border-radius: 20px;
  font-size: 14px;
  line-height: 1.5;
  word-wrap: break-word;
  border: 2px solid var(--border);
}

.own .chat-bubble {
  background: var(--primary);
  color: var(--bg);
  border-color: var(--primary);
  border-bottom-right-radius: 4px;
}

.other .chat-bubble {
  background: var(--surface);
  color: var(--text);
  border-bottom-left-radius: 4px;
}

.chat-meta {
  font-size: 10px;
  color: var(--text-muted);
  margin: 4px 8px 0;
}

.chat-input-area {
  padding: 16px;
  border-top: 3px solid var(--border);
  display: flex;
  gap: 12px;
  background: var(--surface);
}

.chat-input {
  flex: 1;
  background: var(--bg);
  border: 2px solid var(--border);
  color: var(--text);
  padding: 12px 16px;
  font-size: 14px;
  font-family: inherit;
}

.chat-input:focus {
  outline: none;
  border-color: var(--primary);
}

.chat-send {
  background: var(--primary);
  color: var(--bg);
  border: none;
  padding: 0 24px;
  font-size: 14px;
  font-weight: 800;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s;
}

.chat-send:hover {
  background: var(--text);
  color: var(--bg);
}

.chat-fifo-note {
  font-size: 10px;
  color: var(--text-muted);
  text-align: center;
  padding: 4px;
  background: var(--surface);
  border-top: 1px solid var(--border);
}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:var(--surface);
  border-top:2px solid var(--border);
  z-index:1000;
}
.nav-container{
  max-width:480px;
  margin:0 auto;
  display:flex;
  justify-content:space-around;
  align-items:center;
  height:70px;
}
.nav-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:4px;
  background:transparent;
  border:none;
  color:var(--text-muted);
  cursor:pointer;
  padding:8px 0;
  transition:all .2s;
  text-decoration:none;
  flex:1;
  font-size:12px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:.05em;
}
.nav-item.active{
  color:var(--primary);
}
.nav-item.active .nav-icon{
  color:var(--primary);
}
.nav-item:hover{
  color:var(--text);
}
.nav-icon{
  font-size:20px;
  margin-bottom:2px;
}
</style>
</head>
<body>
<div class="wrapper">
  <header>
    <div class="brand">
      <span class="brand-icon">üçµ</span>
      <span class="brand-text">Spill</span>
    </div>
    <div class="header-actions">
      <div class="connection-dot" id="connectionDot"></div>
      <button class="menu-trigger" onclick="toggleMenu()">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- RADAR HERO -->
  <section class="radar-hero" id="radarHero">
    <div class="radar-container">
      <div class="radar-grid"></div>
      <div class="radar-circles"></div>
      <div class="radar-line"></div>
      <div class="radar-sweep"></div>
      
      <div class="radar-dots" id="radarDots"></div>
      
      <div class="radar-overlay">
        <div class="radar-title">VIBE RADAR</div>
        <div class="quota-display">
          <span class="quota-badge" id="quotaBadge">30:00 tersisa</span>
        </div>
      </div>
      
      <!-- VIBE CHECK BUTTON -->
      <button class="vibe-check-btn" onclick="startVibeCheck()">
        <span>‚ú®</span> Vibe Check
      </button>
    </div>
  </section>

  <div class="filter-section">
    <div class="filter-header">
      <span class="filter-title">
        <span id="vibe-percentage" class="vibe-percentage">87%</span>
        <span>Keselarasan</span>
      </span>
      <button class="reset-btn" onclick="resetFilters()">Reset</button>
    </div>
    <input type="range" class="vibe-slider" id="vibe-slider" min="0" max="100" value="87">
    <div class="vibe-labels"><span>Homie Only</span><span>Semi-Selaras</span><span>Semua</span></div>
    <div class="mood-filters" id="mood-filters">
      <button class="mood-btn active" data-mood="all" onclick="filterMood('all')">Semua</button>
      <button class="mood-btn" data-mood="surviving" onclick="filterMood('surviving')">üòÆ‚Äçüí® Surviving</button>
      <button class="mood-btn" data-mood="thriving" onclick="filterMood('thriving')">‚ú® Thriving</button>
      <button class="mood-btn" data-mood="chaotic" onclick="filterMood('chaotic')">üåÄ Chaotic</button>
      <button class="mood-btn" data-mood="doom" onclick="filterMood('doom')">üõå Doom</button>
    </div>
  </div>

  <div class="content-area loading" id="content-area">
    <div class="spinner"></div>
    <p class="loading-text">Menyedu teh...</p>
  </div>

  <button class="new-spill-btn" onclick="refreshSpills()">
    <span>üîÑ</span><span>Seduh Teh Baru</span>
  </button>
</div>

<!-- GENDER MODAL -->
<div class="gender-modal" id="genderModal">
  <div class="gender-container">
    <div class="gender-title">VIBE CHECK</div>
    <div class="gender-sub">pilih identitasmu untuk bertemu lawan jenis</div>
    
    <div class="gender-options">
      <div class="gender-option" data-gender="male" onclick="selectGender('male')">
        <span class="gender-icon">‚ôÇÔ∏è</span>
        <div class="gender-label">PRIA</div>
        <div class="gender-desc">akan bertemu cewek</div>
      </div>
      <div class="gender-option" data-gender="female" onclick="selectGender('female')">
        <span class="gender-icon">‚ôÄÔ∏è</span>
        <div class="gender-label">WANITA</div>
        <div class="gender-desc">akan bertemu cowok</div>
      </div>
    </div>
    
    <div class="gender-note">
      <strong>üîí GRATIS 30 MENIT</strong><br>
      Sesi akan berakhir otomatis. Chat hanya disimpan selama sesi berlangsung (FIFO 20 pesan).
    </div>
    
    <button class="gender-confirm" id="genderConfirm" onclick="confirmGender()" disabled>Mulai Vibe Check</button>
  </div>
</div>

<!-- UPGRADE MODAL -->
<div class="upgrade-modal" id="upgradeModal">
  <div class="upgrade-container">
    <div class="upgrade-title">WAKTU HABIS</div>
    <div class="upgrade-sub">lanjutkan obrolan dengan upgrade</div>
    
    <div class="timer-warning">
      <div class="big">30:00</div>
      <div class="small">sesi gratis selesai</div>
    </div>
    
    <div class="pricing-grid">
      <div class="pricing-card" data-plan="weekly" onclick="selectPlan('weekly')">
        <div class="pricing-left">
          <div class="pricing-price">Rp 10k</div>
          <div class="pricing-desc">7 hari</div>
        </div>
        <div class="pricing-right">
          <div class="pricing-duration">@ 2jam/hari</div>
          <div class="pricing-limit">14 jam total</div>
          <div class="pricing-total">Rp 1.428/jam</div>
        </div>
      </div>
      
      <div class="pricing-card" data-plan="monthly" onclick="selectPlan('monthly')">
        <div class="pricing-left">
          <div class="pricing-price">Rp 50k</div>
          <div class="pricing-desc">30 hari</div>
        </div>
        <div class="pricing-right">
          <div class="pricing-duration">@ 3jam/hari</div>
          <div class="pricing-limit">90 jam total</div>
          <div class="pricing-total">Rp 555/jam</div>
        </div>
      </div>
    </div>
    
    <div class="upgrade-actions">
      <button class="upgrade-btn" id="upgradeNow" onclick="upgradeNow()" disabled>Upgrade</button>
      <button class="upgrade-btn secondary" onclick="closeUpgradeModal()">Nanti aja</button>
    </div>
  </div>
</div>

<!-- CHAT ROOM -->
<div class="chat-room" id="chatRoom">
  <div class="chat-header">
    <div class="chat-info">
      <span class="chat-with">ngobrol dengan</span>
      <span class="chat-name" id="chatPartnerName">@beby.manis</span>
    </div>
    <div class="chat-timer" id="chatTimer">30:00</div>
  </div>
  
  <div class="chat-messages" id="chatMessages"></div>
  
  <div class="chat-input-area">
    <input type="text" class="chat-input" id="chatInput" placeholder="Tulis pesan..." maxlength="200">
    <button class="chat-send" onclick="sendChatMessage()">Kirim</button>
  </div>
  <div class="chat-fifo-note">FIFO ‚Ä¢ maks 20 pesan ‚Ä¢ chat dihapus setelah sesi</div>
</div>

<div class="toast" id="toast"></div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="nav-container">
    <a href="/jejak" class="nav-item" hx-get="jejak.html" hx-target=".wrapper" hx-push-url="true" hx-select=".wrapper" hx-swap="outerHTML">
      <span class="nav-icon">‚ú¶</span>
      <span class="nav-label">Jejak</span>
    </a>
    <a href="/spill" class="nav-item active" hx-get="spill.html" hx-target=".wrapper" hx-push-url="true" hx-select=".wrapper" hx-swap="outerHTML">
      <span class="nav-icon">‚úï</span>
      <span class="nav-label">Spill</span>
    </a>
    <a href="/cocomeo" class="nav-item" hx-get="cocomeo.html" hx-target=".wrapper" hx-push-url="true" hx-select=".wrapper" hx-swap="outerHTML">
      <span class="nav-icon">„Äú</span>
      <span class="nav-label">Cocomeo</span>
    </a>
    <a href="/glitch" class="nav-item" hx-get="glitch.html" hx-target=".wrapper" hx-push-url="true" hx-select=".wrapper" hx-swap="outerHTML">
      <span class="nav-icon">‚ö°</span>
      <span class="nav-label">Glitch</span>
    </a>
  </div>
</nav>

<script>
// ============================================
// VIBE CHECK STATE
// ============================================
let currentGender = null;
let chatPartner = null;
let chatMessages = [];
let chatTimerInterval = null;
let chatTimeLeft = 30 * 60; // 30 menit dalam detik
let selectedPlan = null;

// AI Characters pool
const AI_CHARACTERS = {
  male: [
    { name: 'si.badai', avatar: 'üå™Ô∏è' },
    { name: 'moon.child', avatar: 'üåô' },
    { name: 'si.kocak', avatar: 'üòÇ' },
    { name: 'si.pedas', avatar: 'üå∂Ô∏è' },
    { name: 'mba.gaul', avatar: 'üî•' }
  ],
  female: [
    { name: 'beby.manis', avatar: 'ü•∫' },
    { name: 'strawberry.shortcake', avatar: 'üçì' },
    { name: 'pretty.sad', avatar: 'üòî' },
    { name: 'little.fairy', avatar: 'üßö' },
    { name: 'cinnamon.girl', avatar: 'ü•®' }
  ]
};
// ============================================
// TYPING INDICATOR REALISTIS
// ============================================
function simulateTyping(characterName, messageLength) {
  const typingEl = document.createElement('div');
  typingEl.className = 'chat-message other';
  typingEl.innerHTML = `
    <div class="chat-bubble typing">
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
      <span class="dot-typing"></span>
    </div>
  `;
  
  document.getElementById('chatMessages').appendChild(typingEl);
  
  // Hitung delay berdasarkan panjang pesan (realistis)
  // Rata-rata orang ngetik 40 kata/menit = 0.67 kata/detik
  // Asumsi 1 kata = 5 karakter
  const wordCount = messageLength / 5;
  const baseDelay = 1000; // 1 detik minimal
  const typingDelay = baseDelay + (wordCount * 150); // 150ms per kata
  
  // Tambah variasi random (¬±30%)
  const finalDelay = typingDelay * (0.7 + Math.random() * 0.6);
  
  // Hapus typing indicator setelah delay
  setTimeout(() => {
    typingEl.remove();
  }, finalDelay);
  
  return finalDelay;
}

// Update fungsi sendChatMessage
async function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  
  // Add user message
  addMessage(text, true);
  input.value = '';
  
  // Show typing indicator
  const typingDelay = simulateTyping(chatPartner.name, text.length);
  
  // Kirim ke API setelah typing selesai
  setTimeout(async () => {
    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message: text,
          characterName: chatPartner.name,
          userName: currentUser,
          room: 'private',
          lastMessages: getLastMessages(5)
        })
      });
      
      const data = await response.json();
      if (data.reply) {
        addMessage(data.reply, false);
      }
    } catch (e) {
      console.error('Chat error:', e);
      addMessage('*error koneksi*', false);
    }
  }, typingDelay);
}

// Ambil last messages untuk konteks
function getLastMessages(count) {
  const messages = [];
  const msgElements = document.querySelectorAll('#chatMessages .chat-message');
  
  for (let i = Math.max(0, msgElements.length - count); i < msgElements.length; i++) {
    const el = msgElements[i];
    const isOwn = el.classList.contains('own');
    const bubble = el.querySelector('.chat-bubble');
    
    if (bubble && !bubble.classList.contains('typing')) {
      messages.push({
        role: isOwn ? 'user' : 'assistant',
        content: bubble.textContent
      });
    }
  }
  
  return messages;
}
// ============================================
// RADAR EFFECTS
// ============================================
let radarInterval = null;
let sweepInterval = null;

function initRadar() {
  generateRadarDots();
  
  radarInterval = setInterval(() => {
    updateRadarDots();
  }, 5000);
  
  startSweepEffect();
}

function generateRadarDots() {
  const container = document.getElementById('radarDots');
  if (!container) return;
  
  container.innerHTML = '';
  
  // Generate 8-15 dots random
  const dotCount = 8 + Math.floor(Math.random() * 8);
  
  for (let i = 0; i < dotCount; i++) {
    const gender = Math.random() > 0.5 ? 'purple' : 'red';
    const angle = Math.random() * Math.PI * 2;
    const distance = 10 + Math.random() * 80;
    
    const x = 50 + Math.cos(angle) * distance / 2;
    const y = 50 + Math.sin(angle) * distance / 2;
    
    const size = 8 + Math.floor(Math.random() * 8);
    
    const dot = document.createElement('div');
    dot.className = `radar-dot ${gender}`;
    dot.style.left = x + '%';
    dot.style.top = y + '%';
    dot.style.width = size + 'px';
    dot.style.height = size + 'px';
    
    container.appendChild(dot);
  }
  
  // Add AI dots
  for (let i = 0; i < 3; i++) {
    const gender = Math.random() > 0.5 ? 'purple' : 'red';
    const angle = Math.random() * Math.PI * 2;
    const distance = 10 + Math.random() * 70;
    
    const x = 50 + Math.cos(angle) * distance / 2;
    const y = 50 + Math.sin(angle) * distance / 2;
    
    const size = 10 + Math.floor(Math.random() * 8);
    
    const dot = document.createElement('div');
    dot.className = `radar-dot ${gender} ai`;
    dot.style.left = x + '%';
    dot.style.top = y + '%';
    dot.style.width = size + 'px';
    dot.style.height = size + 'px';
    
    container.appendChild(dot);
  }
}

function updateRadarDots() {
  const container = document.getElementById('radarDots');
  if (!container) return;
  
  const dots = container.querySelectorAll('.radar-dot');
  
  dots.forEach(dot => {
    const currentLeft = parseFloat(dot.style.left);
    const currentTop = parseFloat(dot.style.top);
    
    if (!isNaN(currentLeft) && !isNaN(currentTop)) {
      let newLeft = currentLeft + (Math.random() - 0.5) * 3;
      let newTop = currentTop + (Math.random() - 0.5) * 3;
      
      newLeft = Math.max(5, Math.min(95, newLeft));
      newTop = Math.max(5, Math.min(95, newTop));
      
      dot.style.left = newLeft + '%';
      dot.style.top = newTop + '%';
    }
  });
}

function startSweepEffect() {
  sweepInterval = setInterval(() => {
    const dots = document.querySelectorAll('.radar-dot');
    const sweepAngle = (Date.now() / 150) % 360;
    
    dots.forEach(dot => {
      dot.classList.remove('highlighted');
      
      const left = parseFloat(dot.style.left);
      const top = parseFloat(dot.style.top);
      
      if (!isNaN(left) && !isNaN(top)) {
        const relX = left - 50;
        const relY = top - 50;
        const dotAngle = (Math.atan2(relY, relX) * 180 / Math.PI + 360) % 360;
        
        let angleDiff = Math.abs(dotAngle - sweepAngle);
        angleDiff = Math.min(angleDiff, 360 - angleDiff);
        
        if (angleDiff < 35) {
          dot.classList.add('highlighted');
          const intensity = 1 - (angleDiff / 35);
          dot.style.filter = `brightness(${1 + intensity}) drop-shadow(0 0 ${10 + intensity * 20}px currentColor)`;
          dot.style.transform = `translate(-50%, -50%) scale(${1.2 + intensity * 0.5})`;
        } else {
          dot.style.filter = '';
          dot.style.transform = '';
        }
      }
    });
  }, 50);
}

// ============================================
// VIBE CHECK FLOW
// ============================================
function startVibeCheck() {
  document.getElementById('genderModal').classList.add('on');
}

function selectGender(gender) {
  // Remove selected class from all options
  document.querySelectorAll('.gender-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  
  // Add selected class to clicked option
  document.querySelector(`.gender-option[data-gender="${gender}"]`).classList.add('selected');
  
  currentGender = gender;
  document.getElementById('genderConfirm').disabled = false;
}

function confirmGender() {
  if (!currentGender) return;
  
  // Close gender modal
  document.getElementById('genderModal').classList.remove('on');
  
  // Find chat partner (real user first, then AI)
  findChatPartner();
}

function findChatPartner() {
  // Simulate finding real user (70% chance)
  const foundRealUser = Math.random() < 0.7;
  
  if (foundRealUser) {
    // Fake real user
    const oppositeGender = currentGender === 'male' ? 'female' : 'male';
    const names = oppositeGender === 'female' 
      ? ['jessica', 'amanda', 'sarah', 'diana', 'melanie']
      : ['kevin', 'brian', 'alex', 'steven', 'jordan'];
    
    chatPartner = {
      name: names[Math.floor(Math.random() * names.length)],
      isAI: false,
      gender: oppositeGender
    };
    
    toast(`‚ú® Bertemu dengan @${chatPartner.name}`);
  } else {
    // AI partner
    const oppositePool = currentGender === 'male' ? AI_CHARACTERS.female : AI_CHARACTERS.male;
    const aiChar = oppositePool[Math.floor(Math.random() * oppositePool.length)];
    
    chatPartner = {
      name: aiChar.name,
      avatar: aiChar.avatar,
      isAI: true,
      gender: currentGender === 'male' ? 'female' : 'male'
    };
    
    toast(`üí¨ Bertemu dengan @${chatPartner.name} (AI)`);
  }
  
  // Open chat room
  openChatRoom();
}

function openChatRoom() {
  // Reset chat
  chatMessages = [];
  chatTimeLeft = 30 * 60;
  
  // Clear messages
  document.getElementById('chatMessages').innerHTML = '';
  
  // Show chat room
  document.getElementById('chatRoom').classList.add('on');
  
  // Start timer
  startChatTimer();
  
  // Add casual greeting based on partner type and time
  setTimeout(() => {
    const greeting = getCasualGreeting(chatPartner);
    addMessage(greeting, false);
  }, 800);
}

function getCasualGreeting(partner) {
  const hour = new Date().getHours();
  const greetings = [];
  
  if (partner.isAI) {
    // AI greetings
    if (partner.gender === 'female') {
      greetings.push(
        "pa kabar cuy?",
        "haloo, lg ngapain?",
        "eh ada temen baru, pa kabar?",
        "wih ada yang nyapa, gimana kabarnya?",
        "halo halo, santuy aja ya?"
      );
    } else {
      greetings.push(
        "pa kabar bro?",
        "waduh ada yang chat, lg apa?",
        "eh lo, pa kabar?",
        "gas ngobrol yuk, lg apa?",
        "halo, lg sibuk ga?"
      );
    }
  } else {
    // Real user greetings (simulasi)
    greetings.push(
      "halo juga, pa kabar?",
      "eh ada yang chat, lg apa?",
      "hai hai, gimana kabarnya?",
      "wkwk halo, pa kabar cuy?"
    );
  }
  
  // Add time-based greeting
  if (hour < 5) {
    greetings.push("eh masih begadang? sama wkwk");
  } else if (hour < 10) {
    greetings.push("pagi, udah ngopi belom?");
  } else if (hour < 15) {
    greetings.push("siang, udah makan?");
  } else if (hour < 18) {
    greetings.push("sore, capek ga?");
  } else if (hour < 22) {
    greetings.push("malem, lagi santuy?");
  } else {
    greetings.push("udah malem, belum tidur?");
  }
  
  return greetings[Math.floor(Math.random() * greetings.length)];
}
function startChatTimer() {
  updateTimerDisplay();
  
  chatTimerInterval = setInterval(() => {
    chatTimeLeft--;
    updateTimerDisplay();
    
    // Warning at 5 minutes
    if (chatTimeLeft === 300) {
      toast('‚ö†Ô∏è Sisa 5 menit! Upgrade untuk lanjut.');
    }
    
    // Time's up
    if (chatTimeLeft <= 0) {
      endChatSession();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const mins = Math.floor(chatTimeLeft / 60);
  const secs = chatTimeLeft % 60;
  const timerEl = document.getElementById('chatTimer');
  
  timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  
  if (chatTimeLeft <= 300) {
    timerEl.classList.add('warning');
  } else {
    timerEl.classList.remove('warning');
  }
}

function endChatSession() {
  // Stop timer
  if (chatTimerInterval) {
    clearInterval(chatTimerInterval);
    chatTimerInterval = null;
  }
  
  // Hide chat room
  document.getElementById('chatRoom').classList.remove('on');
  
  // Show upgrade modal
  document.getElementById('upgradeModal').classList.add('on');
  
  toast('‚è∞ Sesi chat selesai');
}

function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  
  if (!text) return;
  
  // Add user message
  addMessage(text, true);
  input.value = '';
  
  // Simulate reply (only if partner is AI or simulate real user typing)
  setTimeout(() => {
    if (chatPartner.isAI) {
      // AI reply
      const replies = [
        'iya, aku setuju banget!',
        'wkwk ngakak bacanya',
        'ceritain lebih lanjut dong',
        'aku juga ngerasain kok',
        'seriusan? gila sih'
      ];
      const reply = replies[Math.floor(Math.random() * replies.length)];
      addMessage(reply, false);
    } else {
      // Random reply (simulate real user)
      if (Math.random() < 0.7) {
        const replies = [
          'haha iya nih',
          'sama wkwk',
          'eh gue juga lagi',
          'nggak nyangka lo jg',
          'ya ampun relate banget'
        ];
        const reply = replies[Math.floor(Math.random() * replies.length)];
        addMessage(reply, false);
      }
    }
  }, 1000 + Math.random() * 2000);
}

function addMessage(text, isOwn) {
  const messagesEl = document.getElementById('chatMessages');
  
  const messageDiv = document.createElement('div');
  messageDiv.className = `chat-message ${isOwn ? 'own' : 'other'}`;
  
  const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
  
  messageDiv.innerHTML = `
    <div class="chat-bubble">${esc(text)}</div>
    <div class="chat-meta">${time}</div>
  `;
  
  messagesEl.appendChild(messageDiv);
  
  // FIFO: keep only last 20 messages
  while (messagesEl.children.length > 20) {
    messagesEl.removeChild(messagesEl.firstChild);
  }
  
  messagesEl.scrollTop = messagesEl.scrollHeight;
}
function closeChat() {
  // Stop timer
  if (chatTimerInterval) {
    clearInterval(chatTimerInterval);
    chatTimerInterval = null;
  }
  
  // Hide chat room
  document.getElementById('chatRoom').classList.remove('on');
  
  // Optional: show confirmation
  toast('üëã Sampai jumpa!');
}
// ============================================
// UPGRADE FLOW
// ============================================
function selectPlan(plan) {
  // Remove selected class from all cards
  document.querySelectorAll('.pricing-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Add selected class to clicked card
  document.querySelector(`.pricing-card[data-plan="${plan}"]`).classList.add('selected');
  
  selectedPlan = plan;
  document.getElementById('upgradeNow').disabled = false;
}

function upgradeNow() {
  if (!selectedPlan) return;
  
  const planDetails = selectedPlan === 'weekly' 
    ? { price: 10000, days: 7, hoursPerDay: 2 }
    : { price: 50000, days: 30, hoursPerDay: 3 };
  
  toast(`üîÑ Proses upgrade ${selectedPlan}... (integrasi payment nanti)`);
  
  // Simulate success
  setTimeout(() => {
    toast(`‚úÖ Upgrade berhasil! ${planDetails.days} hari @ ${planDetails.hoursPerDay}jam/hari`);
    closeUpgradeModal();
    
    // Reopen chat with extended time (simulate)
    if (chatPartner) {
      chatTimeLeft = planDetails.hoursPerDay * 3600;
      document.getElementById('chatRoom').classList.add('on');
      startChatTimer();
      addMessage('Obrolan dilanjut!', false);
    }
  }, 1500);
}

function closeUpgradeModal() {
  document.getElementById('upgradeModal').classList.remove('on');
}

// ============================================
// UTILS
// ============================================
function toast(msg, isErr = false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isErr ? ' error' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

function esc(t) {
  if (!t) return '';
  const d = document.createElement('div');
  d.textContent = t;
  return d.innerHTML;
}

function toggleMenu() {
  toast('Menu coming soon');
}

function filterMood(mood) {
  console.log('Filter mood:', mood);
}

function resetFilters() {
  console.log('Reset filters');
}

function refreshSpills() {
  console.log('Refresh spills');
}

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
  initRadar();
  
  // Cleanup intervals on page unload
  window.addEventListener('beforeunload', () => {
    if (radarInterval) clearInterval(radarInterval);
    if (sweepInterval) clearInterval(sweepInterval);
    if (chatTimerInterval) clearInterval(chatTimerInterval);
  });
});
</script>
</body>
</html>
