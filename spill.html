<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>SPXLL ‚Äî Spill</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ RESET & VARIABLES ‚îÄ‚îÄ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

:root {
  /* Colors */
  --bg: #000000;
  --sf: #0a0a0a;
  --sfe: #111111;
  --bd: #1a1a1a;
  --tx: #ffffff;
  --txs: #666666;
  --txm: #444444;
  --ap: #ff3d00;
  --as: #00f0ff;
  --aq: #00ff41;
  --war: #ff0040;
  --ms: #ff9500;
  --mt: #00ff41;
  --mc: #00f0ff;
  --md: #8b5cf6;
  
  /* Spacing */
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
  
  /* Typography - Responsive */
  --fs-base: clamp(14px, 4vw, 16px);
  --fs-small: clamp(10px, 3vw, 12px);
  --fs-mono: clamp(10px, 3vw, 12px);
  --fs-large: clamp(18px, 6vw, 24px);
  --fs-xl: clamp(24px, 8vw, 32px);
}

/* ‚îÄ‚îÄ BASE ‚îÄ‚îÄ */
html {
  height: 100%;
  overflow: hidden;
}

body {
  height: 100%;
  background: var(--bg);
  color: var(--tx);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: var(--fs-base);
  line-height: 1.4;
  overflow: hidden;
  position: fixed;
  width: 100%;
  overscroll-behavior: none;
  -webkit-font-smoothing: antialiased;
}

/* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
.app {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ‚îÄ‚îÄ SCROLL AREA ‚îÄ‚îÄ */
.scroll {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
  scrollbar-width: none;
}

.scroll::-webkit-scrollbar {
  display: none;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header {
  padding: 12px 16px;
  padding-top: calc(12px + var(--safe-top));
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid var(--bd);
  background: var(--bg);
  flex-shrink: 0;
}

.logo {
  font-size: 28px;
  font-weight: 800;
  letter-spacing: -2px;
  line-height: 1;
}

.logo span {
  color: var(--ap);
}

.status {
  display: flex;
  align-items: center;
  gap: 6px;
}

.pulse {
  width: 6px;
  height: 6px;
  background: var(--aq);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.live {
  font-size: var(--fs-small);
  font-weight: 600;
  color: var(--txs);
  letter-spacing: 0.5px;
}

/* ‚îÄ‚îÄ RADAR SECTION ‚îÄ‚îÄ */
.radar-sect {
  background: var(--sf);
  border-bottom: 1px solid var(--bd);
  padding: 12px 0;
}

.radar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 16px 12px;
}

.radar-label {
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--aq);
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.radar-label::before {
  content: '';
  width: 6px;
  height: 6px;
  background: var(--aq);
  border-radius: 50%;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.radar-stat {
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--txs);
}

.radar-wrapper {
  padding: 0 16px;
}

/* Radar Bezel - Military Style */
.radar-bezel {
  position: relative;
  border-radius: 16px;
  padding: clamp(12px, 4vw, 18px);
  background: linear-gradient(160deg, #3c3c3c 0%, #282828 8%, #1e1e1e 30%, #161616 50%, #1a1a1a 72%, #242424 92%, #2e2e2e 100%);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), inset 1px 0 0 rgba(255,255,255,0.04),
              inset 0 -2px 0 rgba(0,0,0,0.7), inset -1px 0 0 rgba(0,0,0,0.5),
              0 2px 0 #0a0a0a, 0 4px 0 #060606, 0 8px 24px rgba(0,0,0,0.85);
  background-image: repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(0,0,0,0.08) 3px, rgba(0,0,0,0.08) 4px),
                    linear-gradient(160deg, #3c3c3c 0%, #282828 8%, #1e1e1e 30%, #161616 50%, #1a1a1a 72%, #242424 92%, #2e2e2e 100%);
}

/* Screws */
.radar-screw {
  position: absolute;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  z-index: 20;
  background: radial-gradient(circle at 38% 32%, #4a4a4a 0%, #2e2e2e 35%, #1a1a1a 65%, #111 100%);
  box-shadow: 0 0 0 2px #0e0e0e, 0 0 0 3px #2a2a2a,
              inset 0 1px 2px rgba(255,255,255,0.12),
              inset 0 -1px 2px rgba(0,0,0,0.9),
              0 1px 3px rgba(0,0,0,0.8);
}

.radar-screw::before, .radar-screw::after {
  content: '';
  position: absolute;
  border-radius: 1px;
  background: rgba(0,0,0,0.65);
}

.radar-screw::before {
  width: 7px;
  height: 1.5px;
  top: 6.25px;
  left: 3.5px;
  transform: rotate(var(--sr, 0deg));
}

.radar-screw::after {
  width: 1.5px;
  height: 7px;
  top: 3.5px;
  left: 6.25px;
  transform: rotate(var(--sr, 0deg));
}

.screw-tl { top: 7px; left: 7px; --sr: 15deg; }
.screw-tr { top: 7px; right: 7px; --sr: -20deg; }
.screw-bl { bottom: 11px; left: 7px; --sr: -10deg; }
.screw-br { bottom: 11px; right: 7px; --sr: 25deg; }

.radar-bezel-label {
  position: absolute;
  top: 6px;
  left: 0;
  right: 0;
  text-align: center;
  font-family: 'Space Mono', monospace;
  font-size: 7px;
  font-weight: 700;
  letter-spacing: 5px;
  text-transform: uppercase;
  pointer-events: none;
  z-index: 21;
  color: transparent;
  text-shadow: 0 1px 0 rgba(255,255,255,0.1), 0 -1px 0 rgba(0,0,0,0.8);
  -webkit-text-stroke: 0.5px rgba(255,255,255,0.15);
}

.radar-bezel-range {
  position: absolute;
  bottom: 7px;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  padding: 0 22px;
  font-family: 'Space Mono', monospace;
  font-size: 6px;
  color: rgba(255,255,255,0.14);
  letter-spacing: 1px;
  pointer-events: none;
  z-index: 21;
}

.radar-bezel::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 18px;
  right: 18px;
  height: 3px;
  border-radius: 0 0 14px 14px;
  background: linear-gradient(90deg, transparent, var(--ap) 30%, var(--ap) 70%, transparent);
  opacity: 0.35;
}

.radar-cont {
  position: relative;
  width: 100%;
  aspect-ratio: 1/1;
  background: radial-gradient(ellipse at 42% 38%, #0b1a0b 0%, #040d04 55%, #010501 100%);
  border-radius: 6px;
  overflow: hidden;
  box-shadow: inset 0 0 0 2px #000, inset 0 2px 8px rgba(0,0,0,0.95),
              inset 0 0 60px rgba(0,0,0,0.9);
}

.radar-cont::after {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 30;
  pointer-events: none;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px,
                                         rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 3px);
}

.radar-cont::before {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 31;
  pointer-events: none;
  background: radial-gradient(ellipse at 28% 22%, rgba(255,255,255,0.04) 0%, transparent 55%),
              linear-gradient(135deg, rgba(255,255,255,0.015) 0%, transparent 50%);
}

.radar-grid {
  position: absolute;
  inset: 0;
  opacity: 0.065;
  background-image: repeating-linear-gradient(0deg, rgba(0,255,65,0.7) 0px, transparent 1px, transparent 22px),
                    repeating-linear-gradient(90deg, rgba(0,255,65,0.7) 0px, transparent 1px, transparent 22px);
}

.radar-ring {
  position: absolute;
  inset: 6%;
  border: 1px solid rgba(0,255,65,0.1);
  border-radius: 50%;
}

.radar-ring::before, .radar-ring::after {
  content: '';
  position: absolute;
  border-radius: 50%;
  border: 1px solid rgba(0,255,65,0.07);
}

.radar-ring::before { inset: 25%; }
.radar-ring::after { inset: 50%; border-color: rgba(0,255,65,0.05); }

.radar-cross {
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent calc(50% - 0.5px), rgba(0,255,65,0.06) calc(50% - 0.5px), rgba(0,255,65,0.06) calc(50% + 0.5px), transparent calc(50% + 0.5px)),
              linear-gradient(0deg, transparent calc(50% - 0.5px), rgba(0,255,65,0.06) calc(50% - 0.5px), rgba(0,255,65,0.06) calc(50% + 0.5px), transparent calc(50% + 0.5px));
}

.radar-canvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 5;
}

.radar-dots {
  position: absolute;
  inset: 0;
  z-index: 10;
}

.radar-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  opacity: 0.35;
  will-change: transform, opacity, filter;
  transition: opacity 0.1s ease-out;
}

.radar-dot.active {
  opacity: 1;
  transform: translate(-50%, -50%) scale(2.2);
  filter: brightness(2) drop-shadow(0 0 6px currentColor);
}

.radar-dot.purple { background: #b026ff; box-shadow: 0 0 6px #b026ff; }
.radar-dot.red { background: var(--war); box-shadow: 0 0 6px var(--war); }
.radar-dot.ai { background: var(--aq); box-shadow: 0 0 6px var(--aq); }

.radar-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px 0;
  gap: 10px;
  flex-wrap: wrap;
}

@media (max-width: 380px) {
  .radar-footer {
    flex-direction: column;
    align-items: stretch;
  }
}

.radar-info {
  display: flex;
  flex-direction: column;
  min-width: 56px;
}

.radar-count {
  font-family: 'Space Mono', monospace;
  font-size: clamp(28px, 8vw, 32px);
  font-weight: 700;
  color: var(--aq);
  line-height: 1;
  text-shadow: 0 0 15px rgba(0,255,65,0.4);
  letter-spacing: -2px;
}

.radar-sub {
  font-size: var(--fs-small);
  color: var(--txs);
  margin-top: 2px;
  font-weight: 500;
}

@media (max-width: 320px) {
  .radar-sub { display: none; }
}

.vibe-btn, .whisper-btn {
  padding: clamp(12px, 3vw, 14px) clamp(16px, 4vw, 22px);
  font-size: clamp(12px, 3.5vw, 13px);
  font-weight: 700;
  letter-spacing: 0.3px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
  touch-action: manipulation;
  cursor: pointer;
  transition: all 0.1s;
  border: none;
  min-height: 44px;
}

.vibe-btn {
  background: var(--ap);
  color: #000;
  box-shadow: 0 4px 0 rgba(255,61,0,0.3);
}

.vibe-btn:active {
  transform: translateY(4px);
  box-shadow: 0 0 0 rgba(255,61,0,0.3);
}

.whisper-btn {
  position: relative;
  background: transparent;
  color: var(--as);
  border: 1px solid rgba(0,240,255,0.25);
}

.whisper-btn:active {
  transform: translateY(2px);
  opacity: 0.8;
}

.ws-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  min-width: 18px;
  height: 18px;
  background: var(--as);
  color: #000;
  font-size: 9px;
  font-weight: 800;
  border-radius: 9px;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  border: 2px solid var(--bg);
}

.ws-badge.show { display: flex; }

/* ‚îÄ‚îÄ FILTER SECTION ‚îÄ‚îÄ */
.filter-sect {
  padding: 16px;
  border-bottom: 1px solid var(--bd);
}

.filter-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.filter-title {
  font-size: 11px;
  font-weight: 700;
  color: var(--txs);
  letter-spacing: 0.5px;
}

.match-pct {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  color: var(--ap);
  font-weight: 700;
}

.vibe-slider {
  width: 100%;
  height: 4px;
  background: var(--bd);
  border-radius: 2px;
  outline: none;
  -webkit-appearance: none;
  display: block;
  margin-bottom: 6px;
}

.vibe-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px;
  height: 24px;
  background: var(--ap);
  border: 3px solid var(--bg);
  border-radius: 50%;
  box-shadow: 0 0 0 1px var(--ap), 0 2px 8px rgba(255,61,0,0.4);
  margin-top: -10px;
}

.vibe-slider::-webkit-slider-runnable-track {
  height: 4px;
  background: linear-gradient(90deg, var(--ap) 0%, var(--ap) 87%, var(--bd) 87%);
  border-radius: 2px;
}

.slider-labels {
  display: flex;
  justify-content: space-between;
  font-size: 9px;
  color: var(--txm);
  font-weight: 600;
  margin-top: 4px;
  margin-bottom: 12px;
}

@media (max-width: 320px) {
  .slider-labels span:first-child,
  .slider-labels span:last-child {
    display: none;
  }
}

.mood-scroll {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  margin: 0 -16px;
  padding: 0 16px 4px;
  scrollbar-width: none;
}

.mood-scroll::-webkit-scrollbar { display: none; }

.mood-chip {
  flex-shrink: 0;
  padding: 10px 16px;
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 24px;
  font-size: var(--fs-small);
  font-weight: 600;
  color: var(--txs);
  white-space: nowrap;
  touch-action: manipulation;
  transition: all 0.15s;
  cursor: pointer;
  font-family: inherit;
  min-height: 44px;
}

.mood-chip.active {
  background: var(--ap);
  border-color: var(--ap);
  color: #000;
}

.mood-chip:active {
  transform: scale(0.95);
  opacity: 0.8;
}

/* ‚îÄ‚îÄ SPILLS SECTION ‚îÄ‚îÄ */
.spills-sect {
  padding: 16px;
  padding-bottom: calc(80px + var(--safe-bottom));
}

.sect-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.sect-title {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: var(--txs);
}

.sect-meta {
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--txm);
}

.spill-card {
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 16px;
  margin-bottom: 12px;
  overflow: hidden;
}

.spill-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 1px solid var(--bd);
  background: var(--bg);
}

.spill-user {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  color: var(--txs);
  font-weight: 600;
}

.spill-mood {
  font-size: var(--fs-small);
  font-weight: 700;
  padding: 6px 12px;
  border-radius: 20px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.spill-mood.surviving { color: var(--ms); background: rgba(255,149,0,0.1); }
.spill-mood.thriving { color: var(--mt); background: rgba(57,255,20,0.1); }
.spill-mood.chaotic { color: var(--mc); background: rgba(0,240,255,0.1); }
.spill-mood.doom { color: var(--md); background: rgba(139,92,246,0.1); }

.spill-body {
  padding: 16px;
  font-size: var(--fs-base);
  line-height: 1.6;
  color: var(--tx);
}

.spill-actions {
  display: flex;
  gap: 8px;
  padding: 12px 16px;
  border-top: 1px solid var(--bd);
  background: var(--bg);
  overflow-x: auto;
  scrollbar-width: none;
}

.spill-actions::-webkit-scrollbar { display: none; }

.react-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 16px;
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 24px;
  font-size: var(--fs-base);
  color: var(--txs);
  flex-shrink: 0;
  touch-action: manipulation;
  transition: all 0.15s;
  cursor: pointer;
  font-family: inherit;
  min-height: 44px;
}

.react-btn.active {
  background: var(--ap);
  border-color: var(--ap);
  color: #000;
}

.react-btn:active {
  transform: scale(0.95);
}

.react-count {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  font-weight: 700;
  min-width: 18px;
}

/* VT Dot */
.vt-dot-wrap {
  position: relative;
  width: 14px;
  height: 14px;
  flex-shrink: 0;
}

.vt-dot-inner {
  width: 8px;
  height: 8px;
  background: #111;
  border: 1px solid #1e1e1e;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  transition: all 0.5s;
}

.vt-dot-wrap.has-tap .vt-dot-inner {
  animation: vt-breathe 3s ease-in-out infinite;
}

@keyframes vt-breathe {
  0%, 100% { box-shadow: none; border-color: #1e1e1e; }
  50% { box-shadow: 0 0 0 3px rgba(30,30,30,0.5); border-color: #2a2a2a; }
}

.refresh-btn {
  width: 100%;
  padding: 16px;
  background: transparent;
  border: 1px dashed var(--bd);
  border-radius: 16px;
  color: var(--txs);
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 8px;
  touch-action: manipulation;
  transition: all 0.15s;
  cursor: pointer;
  font-family: inherit;
  min-height: 56px;
}

.refresh-btn:active {
  background: var(--sf);
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-title {
  font-size: var(--fs-large);
  font-weight: 700;
  color: var(--txs);
  margin-bottom: 6px;
}

.empty-text {
  font-size: var(--fs-small);
  color: var(--txm);
}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bnav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0,0,0,0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--bd);
  padding-bottom: var(--safe-bottom);
  padding-left: var(--safe-left);
  padding-right: var(--safe-right);
  z-index: 100;
}

.bnav-inner {
  display: flex;
  justify-content: space-around;
  align-items: center;
  height: 60px;
  max-width: 480px;
  margin: 0 auto;
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  height: 100%;
  color: var(--txs);
  text-decoration: none;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.3px;
  position: relative;
  touch-action: manipulation;
  transition: all 0.15s;
  min-height: 44px;
  min-width: 44px;
}

.nav-item.active {
  color: var(--ap);
}

.nav-item.active::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 2px;
  background: var(--ap);
  border-radius: 0 0 2px 2px;
}

.nav-icon {
  font-size: 22px;
  line-height: 1;
  margin-bottom: -2px;
}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 200;
  flex-direction: column;
  overflow: hidden;
}

.modal.on {
  display: flex;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  padding-top: calc(16px + var(--safe-top));
  border-bottom: 1px solid var(--bd);
}

.modal-title {
  font-size: 17px;
  font-weight: 700;
  letter-spacing: -0.3px;
}

.modal-close {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 10px;
  color: var(--txs);
  font-size: 18px;
  touch-action: manipulation;
  cursor: pointer;
  transition: all 0.15s;
}

.modal-close:active {
  background: var(--bd);
}

.modal-body {
  flex: 1;
  overflow-y: auto;
  padding: clamp(16px, 5vw, 20px) clamp(16px, 4vw, 20px)
           calc(clamp(16px, 5vw, 20px) + var(--safe-bottom));
  -webkit-overflow-scrolling: touch;
}

.modal-tag {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  color: var(--ap);
  margin-bottom: 8px;
  letter-spacing: 1px;
  font-weight: 700;
  display: block;
}

.modal-h {
  font-size: clamp(22px, 6vw, 26px);
  font-weight: 800;
  margin-bottom: 6px;
  letter-spacing: -0.5px;
  line-height: 1.2;
}

.modal-sub {
  font-size: 14px;
  color: var(--txs);
  margin-bottom: 28px;
  line-height: 1.5;
}

.gender-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 24px;
}

.gender-card {
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 20px;
  padding: clamp(20px, 6vw, 28px) clamp(12px, 4vw, 16px);
  text-align: center;
  touch-action: manipulation;
  transition: all 0.15s;
  cursor: pointer;
  min-height: 44px;
}

.gender-card.selected {
  border-color: var(--ap);
  background: rgba(255,61,0,0.08);
}

.gender-card:active {
  transform: scale(0.96);
}

.gender-icon {
  font-size: 36px;
  margin-bottom: 12px;
  display: block;
}

.gender-label {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 4px;
}

.gender-desc {
  font-size: var(--fs-small);
  color: var(--txs);
}

.info-box {
  background: var(--sf);
  border-left: 3px solid var(--ap);
  padding: 16px;
  margin-bottom: 28px;
  border-radius: 0 16px 16px 0;
}

.info-box p {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  color: var(--txs);
  line-height: 1.7;
}

.info-box strong {
  color: var(--ap);
  font-weight: 700;
}

.action-btn {
  width: 100%;
  padding: 18px;
  background: var(--ap);
  color: #000;
  border: none;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.3px;
  touch-action: manipulation;
  cursor: pointer;
  transition: all 0.15s;
  font-family: inherit;
  min-height: 56px;
}

.action-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.action-btn:active {
  transform: scale(0.98);
}

.action-btn.sec {
  background: var(--sf);
  color: var(--tx);
  border: 1px solid var(--bd);
}

.modal-hint {
  font-size: var(--fs-small);
  color: var(--txm);
  text-align: center;
  margin-top: 16px;
  line-height: 1.6;
}

.modal-hint-link {
  background: none;
  border: none;
  color: var(--as);
  font-size: var(--fs-small);
  font-weight: 700;
  cursor: pointer;
  text-decoration: underline;
  font-family: inherit;
  padding: 0;
}

/* ‚îÄ‚îÄ PRICING ‚îÄ‚îÄ */
.price-card {
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 20px;
  padding: 24px 20px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  touch-action: manipulation;
  transition: all 0.15s;
  cursor: pointer;
  min-height: 44px;
}

.price-card.selected {
  border-color: var(--ap);
  background: rgba(255,61,0,0.08);
}

.price-card:active {
  transform: scale(0.98);
}

.price-main {
  font-size: clamp(28px, 8vw, 32px);
  font-weight: 800;
  color: var(--ap);
  letter-spacing: -2px;
  line-height: 1;
}

.price-sub {
  font-size: var(--fs-small);
  color: var(--txs);
  margin-top: 4px;
  font-family: 'Space Mono', monospace;
}

.price-right {
  text-align: right;
}

.price-tag {
  font-size: 13px;
  font-weight: 700;
  color: var(--aq);
  margin-bottom: 3px;
}

.price-note {
  font-size: 11px;
  color: var(--txm);
  font-family: 'Space Mono', monospace;
}

.timer-big {
  text-align: center;
  padding: 40px 24px;
  background: var(--sf);
  border-radius: 20px;
  margin-bottom: 24px;
  border: 1px solid var(--bd);
}

.timer-big .num {
  font-family: 'Space Mono', monospace;
  font-size: 56px;
  font-weight: 700;
  color: var(--war);
  line-height: 1;
  letter-spacing: -3px;
}

.timer-big .label {
  font-size: var(--fs-small);
  color: var(--txs);
  margin-top: 12px;
  text-transform: uppercase;
  letter-spacing: 2px;
  font-weight: 600;
}

/* ‚îÄ‚îÄ CHAT ROOM ‚îÄ‚îÄ */
.chat-room {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 300;
  flex-direction: column;
}

.chat-room.on {
  display: flex;
}

.chat-head {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  padding-top: calc(12px + var(--safe-top));
  border-bottom: 1px solid var(--bd);
  background: var(--sf);
}

.chat-info {
  flex: 1;
}

.chat-label {
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--aq);
  letter-spacing: 1px;
  margin-bottom: 3px;
  font-weight: 700;
}

.chat-name {
  font-size: 15px;
  font-weight: 700;
}

.chat-timer {
  font-family: 'Space Mono', monospace;
  font-size: 16px;
  font-weight: 700;
  color: var(--aq);
  background: var(--bg);
  padding: 8px 14px;
  border-radius: 10px;
  border: 1px solid var(--bd);
  letter-spacing: -1px;
}

.chat-timer.warn {
  color: var(--war);
  border-color: var(--war);
  animation: blink 1s infinite;
  background: rgba(255,0,64,0.1);
}

.chat-close {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg);
  border: 1px solid var(--bd);
  border-radius: 12px;
  color: var(--txs);
  margin-left: 12px;
  font-size: 18px;
  touch-action: manipulation;
  cursor: pointer;
  transition: all 0.15s;
  flex-shrink: 0;
}

.chat-close:active {
  background: var(--bd);
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  -webkit-overflow-scrolling: touch;
}

.chat-bubble {
  max-width: min(85%, 320px);
  padding: clamp(12px, 3vw, 14px) clamp(14px, 4vw, 18px);
  font-size: var(--fs-base);
  line-height: 1.5;
  word-wrap: break-word;
  border-radius: 20px;
  animation: popIn 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn {
  from { opacity: 0; transform: scale(0.8) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.chat-bubble.me {
  align-self: flex-end;
  background: var(--ap);
  color: #000;
  border-bottom-right-radius: 6px;
  font-weight: 600;
}

.chat-bubble.them {
  align-self: flex-start;
  background: var(--sf);
  border: 1px solid var(--bd);
  border-bottom-left-radius: 6px;
}

.chat-time {
  font-size: 10px;
  color: var(--txm);
  margin-top: 6px;
  font-family: 'Space Mono', monospace;
  font-weight: 600;
}

/* Typing Indicator */
.typing {
  display: flex;
  gap: 4px;
  padding: 18px 22px;
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 20px;
  border-bottom-left-radius: 6px;
  align-self: flex-start;
  width: fit-content;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--aq);
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-5px); }
}

.typing-cursor {
  display: inline-block;
  width: 2px;
  height: 14px;
  background: var(--aq);
  margin-left: 2px;
  animation: blink 1s infinite;
  vertical-align: middle;
}

/* Searching Message */
.searching-msg .chat-bubble {
  background: var(--sfe) !important;
  color: var(--txs) !important;
  border: 1px dashed var(--aq) !important;
  font-style: italic;
  text-align: center;
}

/* Distress Banner */
.distress {
  display: none;
  padding: 14px 16px;
  background: var(--war);
  color: #fff;
  font-size: var(--fs-small);
  font-weight: 700;
  text-align: center;
  letter-spacing: 0.3px;
}

.distress.show { display: block; }

/* Chat Input Area */
.chat-input-wrap {
  padding: 12px 16px;
  padding-bottom: calc(12px + var(--safe-bottom));
  border-top: 1px solid var(--bd);
  background: var(--sf);
  display: flex;
  gap: 10px;
  align-items: center;
}

.vt-trigger {
  width: 40px;
  height: 48px;
  background: transparent;
  border: 1px solid #1a1a1a;
  color: #333;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  cursor: pointer;
  border-radius: 12px;
  font-size: 13px;
  transition: all 0.2s;
}

.vt-trigger:hover {
  border-color: #333;
  color: #555;
}

.chat-input {
  flex: 1;
  background: var(--bg);
  border: 1px solid var(--bd);
  border-radius: 24px;
  padding: 14px 18px;
  font-size: 16px; /* Prevents zoom on iOS */
  color: var(--tx);
  outline: none;
  -webkit-appearance: none;
  transition: all 0.15s;
  font-family: inherit;
}

.chat-input:focus {
  border-color: var(--ap);
}

.chat-send {
  width: 48px;
  height: 48px;
  background: var(--ap);
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #000;
  font-size: 20px;
  flex-shrink: 0;
  touch-action: manipulation;
  cursor: pointer;
  box-shadow: 0 4px 0 rgba(255,61,0,0.3);
  transition: all 0.15s;
}

.chat-send:active {
  transform: translateY(4px);
  box-shadow: 0 0 0 rgba(255,61,0,0.3);
}

/* ‚îÄ‚îÄ WHISPERER MODAL ‚îÄ‚îÄ */
.ws-feature-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}

.ws-feature {
  font-size: var(--fs-small);
  color: var(--txs);
  padding: 10px 14px;
  background: var(--sfe);
  border-left: 2px solid var(--as);
  border-radius: 0 8px 8px 0;
  font-weight: 600;
}

.ws-price-box {
  background: var(--sf);
  border: 1px solid rgba(0,240,255,0.25);
  padding: 20px;
  text-align: center;
  margin-bottom: 20px;
  border-radius: 16px;
}

.ws-price {
  font-size: 40px;
  font-weight: 800;
  color: var(--as);
  letter-spacing: -2px;
  line-height: 1;
}

.ws-price-sub {
  font-size: 11px;
  color: var(--txm);
  margin-top: 6px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  font-weight: 700;
  font-family: 'Space Mono', monospace;
}

.ws-inbox-hdr {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.ws-compose-btn {
  background: var(--as);
  color: #000;
  border: none;
  padding: 10px 18px;
  font-size: var(--fs-small);
  font-weight: 700;
  border-radius: 10px;
  cursor: pointer;
  font-family: inherit;
  touch-action: manipulation;
  min-height: 44px;
}

.ws-compose-btn:active { opacity: 0.8; }

.ws-thread-item {
  background: var(--sf);
  border: 1px solid var(--bd);
  border-radius: 14px;
  padding: clamp(12px, 3vw, 14px) clamp(14px, 4vw, 16px);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  touch-action: manipulation;
  transition: all 0.15s;
  position: relative;
  overflow: hidden;
  min-height: 44px;
}

.ws-thread-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--as);
  opacity: 0;
  transition: opacity 0.15s;
  border-radius: 3px 0 0 3px;
}

.ws-thread-item.unread::before { opacity: 1; }
.ws-thread-item:active { transform: scale(0.98); }

.ws-avatar {
  width: 40px;
  height: 40px;
  background: var(--sfe);
  border: 1px solid var(--bd);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 800;
  color: var(--txs);
  flex-shrink: 0;
}

.ws-thread-info {
  flex: 1;
  min-width: 0;
}

.ws-thread-name {
  font-size: 13px;
  font-weight: 700;
  color: var(--tx);
  margin-bottom: 3px;
}

.ws-thread-preview {
  font-size: 11px;
  color: var(--txm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ws-thread-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 5px;
  flex-shrink: 0;
}

.ws-thread-time {
  font-size: 9px;
  color: var(--txm);
  font-family: 'Space Mono', monospace;
}

.ws-unread-badge {
  min-width: 20px;
  height: 20px;
  background: var(--as);
  color: #000;
  font-size: 9px;
  font-weight: 800;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 5px;
}

.ws-empty {
  text-align: center;
  padding: 40px 0;
}

.ws-empty-icon {
  font-size: 36px;
  display: block;
  margin-bottom: 12px;
  opacity: 0.3;
}

.ws-empty-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--txs);
  margin-bottom: 4px;
}

.ws-empty-sub {
  font-size: var(--fs-small);
  color: var(--txm);
}

/* ‚îÄ‚îÄ WHISPERER COMPOSE ‚îÄ‚îÄ */
.ws-compose {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 350;
  flex-direction: column;
}

.ws-compose.on { display: flex; }

.ws-compose-head {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  padding-top: calc(14px + var(--safe-top));
  border-bottom: 1px solid var(--bd);
  background: var(--sf);
}

.ws-to-label {
  font-size: 11px;
  font-weight: 700;
  color: var(--txm);
  white-space: nowrap;
  font-family: 'Space Mono', monospace;
}

.ws-to-input {
  flex: 1;
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--bd);
  color: var(--tx);
  font-size: 16px;
  font-family: inherit;
  padding: 4px 0;
  outline: none;
  transition: border-color 0.15s;
}

.ws-to-input:focus { border-bottom-color: var(--as); }
.ws-to-input::placeholder { color: var(--txm); }

.ws-close-btn {
  width: 36px;
  height: 36px;
  background: var(--bg);
  border: 1px solid var(--bd);
  border-radius: 10px;
  color: var(--txs);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  flex-shrink: 0;
}

.ws-body {
  flex: 1;
  background: transparent;
  border: none;
  color: var(--tx);
  font-family: inherit;
  font-size: 16px;
  line-height: 1.6;
  resize: none;
  padding: 20px 16px;
  outline: none;
}

.ws-body::placeholder { color: var(--txm); }

.ws-compose-foot {
  padding: 12px 16px;
  padding-bottom: calc(12px + var(--safe-bottom));
  border-top: 1px solid var(--bd);
  background: var(--sf);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.ws-char-count {
  font-size: 10px;
  color: var(--txm);
  font-family: 'Space Mono', monospace;
}

.ws-send-btn {
  background: var(--as);
  color: #000;
  border: none;
  padding: 12px 24px;
  font-size: 13px;
  font-weight: 700;
  border-radius: 12px;
  cursor: pointer;
  font-family: inherit;
  transition: all 0.15s;
  box-shadow: 0 4px 0 rgba(0,240,255,0.2);
  min-height: 44px;
}

.ws-send-btn:active {
  transform: translateY(3px);
  box-shadow: none;
}

.ws-send-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
  box-shadow: none;
}

/* ‚îÄ‚îÄ WHISPERER THREAD ‚îÄ‚îÄ */
.ws-thread {
  display: none;
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 350;
  flex-direction: column;
}

.ws-thread.on { display: flex; }

.ws-thread-head {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  padding-top: calc(12px + var(--safe-top));
  border-bottom: 1px solid var(--bd);
  background: var(--sf);
}

.ws-back-btn {
  width: 36px;
  height: 36px;
  background: var(--bg);
  border: 1px solid var(--bd);
  border-radius: 10px;
  color: var(--txs);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
  flex-shrink: 0;
  touch-action: manipulation;
}

.ws-thread-title {
  flex: 1;
  font-size: 15px;
  font-weight: 700;
}

.ws-vt-btn {
  background: transparent;
  border: 1px solid #1a1a1a;
  color: #333;
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s;
  flex-shrink: 0;
}

.ws-vt-btn:hover {
  border-color: #333;
  color: #555;
}

.ws-thread-msgs {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  -webkit-overflow-scrolling: touch;
}

.ws-thread-input-wrap {
  padding: 12px 16px;
  padding-bottom: calc(12px + var(--safe-bottom));
  border-top: 1px solid var(--bd);
  background: var(--sf);
  display: flex;
  gap: 10px;
  align-items: center;
}

.ws-thread-input {
  flex: 1;
  background: var(--bg);
  border: 1px solid var(--bd);
  border-radius: 24px;
  padding: 14px 18px;
  font-size: 16px;
  color: var(--tx);
  outline: none;
  font-family: inherit;
  transition: border-color 0.15s;
}

.ws-thread-input:focus { border-color: var(--as); }

.ws-thread-send {
  width: 48px;
  height: 48px;
  background: var(--as);
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #000;
  font-size: 20px;
  flex-shrink: 0;
  cursor: pointer;
  touch-action: manipulation;
  transition: all 0.15s;
  box-shadow: 0 4px 0 rgba(0,240,255,0.2);
}

.ws-thread-send:active {
  transform: translateY(4px);
  box-shadow: none;
}

/* ‚îÄ‚îÄ VOID TAP ‚îÄ‚îÄ */
.vt-compose {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 500;
  flex-direction: column;
  align-items: stretch;
  justify-content: center;
}

.vt-compose.on {
  display: flex;
  animation: vtFade 0.2s ease;
}

@keyframes vtFade {
  from { opacity: 0; }
  to { opacity: 1; }
}

.vt-compose-inner {
  max-width: 480px;
  width: 100%;
  margin: 0 auto;
  padding: 40px 24px;
  display: flex;
  flex-direction: column;
  gap: 28px;
}

.vt-lbl {
  font-size: 9px;
  font-weight: 700;
  color: #2a2a2a;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  font-family: 'Space Mono', monospace;
}

.vt-textarea {
  background: transparent;
  border: none;
  border-bottom: 1px solid #1a1a1a;
  color: #444;
  font-family: 'Inter', sans-serif;
  font-size: 18px;
  line-height: 1.7;
  resize: none;
  height: 130px;
  outline: none;
  caret-color: #333;
  padding: 8px 0;
}

.vt-textarea::placeholder {
  color: #1a1a1a;
  font-style: italic;
}

.vt-textarea:focus {
  border-bottom-color: #252525;
}

.vt-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.vt-quota {
  font-size: 10px;
  color: #222;
  font-family: 'Space Mono', monospace;
}

.vt-quota.low { color: #331111; }

.vt-actions {
  display: flex;
  gap: 8px;
}

.vt-cancel {
  background: transparent;
  border: 1px solid #181818;
  color: #2a2a2a;
  padding: 10px 18px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
  font-family: inherit;
  border-radius: 8px;
}

.vt-cancel:hover {
  border-color: #2a2a2a;
  color: #444;
}

.vt-send {
  background: #0a0a0a;
  border: 1px solid #1e1e1e;
  color: #333;
  padding: 10px 22px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
  font-family: inherit;
  border-radius: 8px;
  transition: all 0.15s;
}

.vt-send:hover:not(:disabled) {
  border-color: #333;
  color: #666;
}

.vt-send:disabled {
  opacity: 0.2;
  cursor: not-allowed;
}

.vt-reader {
  display: none;
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 500;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  user-select: none;
}

.vt-reader.on {
  display: flex;
  animation: vtFade 0.2s ease;
}

.vt-reader-from {
  position: absolute;
  top: calc(52px + var(--safe-top));
  left: 50%;
  transform: translateX(-50%);
  font-size: 9px;
  color: #1a1a1a;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.25em;
  white-space: nowrap;
  font-family: 'Space Mono', monospace;
}

.vt-reader-msg {
  max-width: 300px;
  padding: 0 24px;
  text-align: center;
  color: #3d3d3d;
  font-size: 17px;
  line-height: 1.8;
}

.vt-reader-timer {
  position: absolute;
  bottom: calc(52px + var(--safe-bottom));
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  color: #1e1e1e;
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

.vt-reader.burning .vt-reader-msg,
.vt-reader.burning .vt-reader-timer,
.vt-reader.burning .vt-reader-from {
  animation: vtBurn 0.7s ease forwards;
}

@keyframes vtBurn {
  0% { opacity: 1; filter: none; }
  50% { opacity: 0.4; filter: blur(2px); }
  100% { opacity: 0; filter: blur(12px); }
}

.vt-upgrade-nudge {
  display: none;
  position: fixed;
  bottom: calc(84px + var(--safe-bottom));
  left: 50%;
  transform: translateX(-50%) translateY(16px);
  background: #0a0a0a;
  border: 1px solid #1a1a1a;
  padding: 12px 20px;
  font-size: 12px;
  color: #333;
  white-space: nowrap;
  z-index: 400;
  opacity: 0;
  transition: all 0.3s;
  cursor: pointer;
  border-radius: 20px;
}

.vt-upgrade-nudge.show {
  display: block;
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.vt-upgrade-nudge b {
  color: #555;
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--tx);
  color: var(--bg);
  padding: 14px 24px;
  border-radius: 30px;
  font-size: 14px;
  font-weight: 700;
  z-index: 600;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  pointer-events: none;
  white-space: nowrap;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.toast.error {
  background: var(--war);
  color: #fff;
}

/* Landscape optimizations */
@media (orientation: landscape) and (max-height: 500px) {
  .radar-sect {
    display: none;
  }
  .scroll {
    padding-bottom: 60px;
  }
  .bnav {
    padding-left: var(--safe-left);
    padding-right: var(--safe-right);
  }
}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  .vibe-btn:hover,
  .whisper-btn:hover,
  .mood-chip:hover,
  .react-btn:hover,
  .refresh-btn:hover,
  .modal-close:hover,
  .action-btn:hover,
  .chat-send:hover,
  .ws-send-btn:hover,
  .ws-thread-send:hover {
    transform: none;
    opacity: 1;
  }
}
</style>
</head>
<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <div class="logo">SP<span>‚úï</span>LL</div>
  <div class="status"><div class="pulse"></div><span class="live">LIVE</span></div>
</div>

<!-- SCROLL AREA -->
<div class="scroll">

<!-- RADAR SECTION -->
<div class="radar-sect">
  <div class="radar-header">
    <span class="radar-label">VIBE RADAR</span>
    <span class="radar-stat">ONLINE</span>
  </div>
  <div class="radar-wrapper">
    <div class="radar-bezel">
      <div class="radar-screw screw-tl"></div>
      <div class="radar-screw screw-tr"></div>
      <div class="radar-screw screw-bl"></div>
      <div class="radar-screw screw-br"></div>
      <div class="radar-bezel-label">VIBE RADAR ‚Äî SYS ACTIVE</div>
      <div class="radar-cont" id="radarCont">
        <div class="radar-grid"></div>
        <div class="radar-ring"></div>
        <div class="radar-cross"></div>
        <canvas class="radar-canvas" id="radarCanvas"></canvas>
        <div class="radar-dots" id="radarDots"></div>
      </div>
      <div class="radar-bezel-range"><span>0.5km</span><span>RNG</span><span>50km</span></div>
    </div>
  </div>
  <div class="radar-footer">
    <div class="radar-info">
      <div class="radar-count" id="quotaBadge">‚Äî</div>
      <div class="radar-sub">Online ¬∑ Ready</div>
    </div>
    <button class="vibe-btn" onclick="startVibeCheck()"><span>‚¨°</span><span>VIBE CHECK</span></button>
    <button class="whisper-btn" onclick="openWsModal()">
      <span>‚ú¶</span><span>Whisper</span>
      <div class="ws-badge" id="wsBadge">0</div>
    </button>
  </div>
</div>

<!-- FILTER SECTION -->
<div class="filter-sect">
  <div class="filter-top">
    <span class="filter-title">KESELARASAN</span>
    <span class="match-pct" id="vibePct">87%</span>
  </div>
  <input type="range" class="vibe-slider" id="vibeSlider" min="0" max="100" value="87" oninput="updateVibePct(this.value)">
  <div class="slider-labels"><span>Homie</span><span>Semi</span><span>All</span></div>
  <div class="mood-scroll">
    <button class="mood-chip active" data-mood="all" onclick="filterMood(this)">Semua</button>
    <button class="mood-chip" data-mood="surviving" onclick="filterMood(this)">üòÆ‚Äçüí® Surviving</button>
    <button class="mood-chip" data-mood="thriving" onclick="filterMood(this)">‚ú® Thriving</button>
    <button class="mood-chip" data-mood="chaotic" onclick="filterMood(this)">üåÄ Chaotic</button>
    <button class="mood-chip" data-mood="doom" onclick="filterMood(this)">üõå Doom</button>
  </div>
</div>

<!-- SPILLS SECTION -->
<div class="spills-sect">
  <div class="sect-header">
    <span class="sect-title">SPILL TERKINI</span>
    <span class="sect-meta">FIFO</span>
  </div>
  <div id="spillsList"></div>
  <button class="refresh-btn" onclick="refreshSpills()">
    <div class="vt-dot-wrap" id="vtIndicator" onclick="event.stopPropagation();checkVoidTaps()">
      <div class="vt-dot-inner"></div>
    </div>
    <span>‚Üª</span>
    <span>Seduh Teh Baru</span>
  </button>
</div>

</div><!-- /scroll -->

<!-- BOTTOM NAV -->
<nav class="bnav">
  <div class="bnav-inner">
    <a href="jejak.html" class="nav-item"><span class="nav-icon">‚ú¶</span><span>Jejak</span></a>
    <a href="spill.html" class="nav-item active"><span class="nav-icon">‚úï</span><span>Spill</span></a>
    <a href="cocomeo.html" class="nav-item"><span class="nav-icon">„Äú</span><span>Cocomeo</span></a>
    <a href="glitch.html" class="nav-item"><span class="nav-icon">‚ö°</span><span>Glitch</span></a>
  </div>
</nav>

</div><!-- /app -->

<!-- MODAL: GENDER / VIBE CHECK -->
<div class="modal" id="genderModal">
  <div class="modal-header">
    <span class="modal-title">Vibe Check</span>
    <button class="modal-close" onclick="closeModal('genderModal')">‚úï</button>
  </div>
  <div class="modal-body">
    <div class="modal-tag">MODEL_A // STRANGER</div>
    <div class="modal-h">Siapa Kamu?</div>
    <div class="modal-sub">Ketemu stranger lawan jenis ‚Äî zero identity, zero history</div>
    <div class="gender-grid">
      <div class="gender-card" onclick="selectGender(this,'male')">
        <span class="gender-icon">‚ôÇ</span>
        <div class="gender-label">Pria</div>
        <div class="gender-desc">Match dengan wanita</div>
      </div>
      <div class="gender-card" onclick="selectGender(this,'female')">
        <span class="gender-icon">‚ôÄ</span>
        <div class="gender-label">Wanita</div>
        <div class="gender-desc">Match dengan pria</div>
      </div>
    </div>
    <div class="info-box">
      <p><strong>>> GRATIS 15 MENIT/HARI</strong><br>Tidak ada username. Chat FIFO 20 pesan. Tidak tersimpan.</p>
    </div>
    <button class="action-btn" id="genderConfirm" onclick="confirmGender()" disabled>Cari Stranger</button>
    <div class="modal-hint">Mau lebih lama? <strong style="color:var(--txs)">10k/minggu</strong> @2jam ¬∑ <strong style="color:var(--txs)">50k/bulan</strong> @3jam</div>
  </div>
</div>

<!-- MODAL: UPGRADE -->
<div class="modal" id="upgradeModal">
  <div class="modal-header">
    <span class="modal-title">Waktu Habis</span>
    <button class="modal-close" onclick="closeModal('upgradeModal')">‚úï</button>
  </div>
  <div class="modal-body">
    <div class="timer-big"><div class="num">15:00</div><div class="label">Sesi Gratis Selesai</div></div>
    <div class="price-card" id="pc-weekly" onclick="selectPlan(this,'weekly')">
      <div><div class="price-main">10K</div><div class="price-sub">7 HARI ¬∑ 2 JAM/HARI</div></div>
      <div class="price-right"><div class="price-tag">14 JAM</div><div class="price-note">@1.428/jam</div></div>
    </div>
    <div class="price-card" id="pc-monthly" onclick="selectPlan(this,'monthly')">
      <div><div class="price-main">50K</div><div class="price-sub">30 HARI ¬∑ 3 JAM/HARI</div></div>
      <div class="price-right"><div class="price-tag">90 JAM</div><div class="price-note">@555/jam</div></div>
    </div>
    <div style="display:flex;gap:12px;margin-top:8px">
      <button class="action-btn" id="upgradeNow" onclick="upgradeNow()" disabled style="flex:1">Lanjut Chat</button>
      <button class="action-btn sec" onclick="closeModal('upgradeModal')" style="flex:1">Nanti</button>
    </div>
    <div class="modal-hint">Perlu DM ke username spesifik? <button class="modal-hint-link" onclick="closeModal('upgradeModal');openWsModal()">Coba Whisperer ‚Üí</button></div>
  </div>
</div>

<!-- CHAT ROOM -->
<div class="chat-room" id="chatRoom">
  <div class="chat-head">
    <div class="chat-info">
      <div class="chat-label">ANON CHAT // STRANGER</div>
      <div class="chat-name" id="chatPartnerName">Connecting...</div>
    </div>
    <div class="chat-timer" id="chatTimer">15:00</div>
    <button class="chat-close" onclick="closeChat()">‚úï</button>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="distress" id="distressBanner">Butuh bantuan? Into The Light: 119 ext 8</div>
  <div class="chat-input-wrap">
    <button class="vt-trigger" onclick="openVtCompose()" title="Void Tap">‚óº</button>
    <input type="text" class="chat-input" id="chatInput" placeholder="Ketik pesan..." maxlength="200">
    <button class="chat-send" onclick="sendMsg()">‚û§</button>
  </div>
</div>

<!-- MODAL: WHISPERER -->
<div class="modal" id="wsModal">
  <div class="modal-header">
    <span class="modal-title">Whisperer</span>
    <button class="modal-close" onclick="closeModal('wsModal')">‚úï</button>
  </div>
  <div class="modal-body">
    <!-- Gate (not subscribed) -->
    <div id="wsGate">
      <div class="modal-tag" style="color:var(--as)">MODEL_B // PRIVATE</div>
      <div class="modal-h">Whisperer</div>
      <div class="modal-sub">DM ke username spesifik ‚Äî subscribers only</div>
      <div class="ws-feature-list">
        <div class="ws-feature">‚ú¶ DM ke username manapun di JEJAK</div>
        <div class="ws-feature">‚ú¶ Riwayat pesan tersimpan</div>
        <div class="ws-feature">‚ú¶ Void Tap unlimited (5s burn)</div>
        <div class="ws-feature">‚ú¶ Stranger Chat 3jam/hari included</div>
      </div>
      <div class="ws-price-box">
        <div class="ws-price">Rp 50K</div>
        <div class="ws-price-sub">per bulan ¬∑ cancel kapanpun</div>
      </div>
      <button class="action-btn" style="background:var(--as);color:#000" onclick="subscribeWs()">Subscribe & Aktifkan</button>
      <div class="modal-hint"><button class="modal-hint-link" onclick="closeModal('wsModal')">Nanti aja</button></div>
    </div>
    <!-- Inbox (subscribed) -->
    <div id="wsInbox" style="display:none">
      <div class="ws-inbox-hdr">
        <div>
          <div class="modal-tag" style="color:var(--as)">MODEL_B // PRIVATE</div>
          <div style="font-size:20px;font-weight:800;letter-spacing:-0.5px">Pesan</div>
        </div>
        <button class="ws-compose-btn" onclick="openWsCompose()">+ Tulis</button>
      </div>
      <div id="wsThreadList"></div>
      <div class="ws-empty" id="wsEmptyState" style="display:none">
        <span class="ws-empty-icon">‚úâ</span>
        <div class="ws-empty-title">Belum ada pesan</div>
        <div class="ws-empty-sub">Mulai whisper ke seseorang</div>
        <button class="action-btn" style="margin-top:20px;background:var(--as);color:#000" onclick="openWsCompose()">Mulai Whisper</button>
      </div>
    </div>
  </div>
</div>

<!-- WHISPERER COMPOSE -->
<div class="ws-compose" id="wsComposeScreen">
  <div class="ws-compose-head">
    <span class="ws-to-label">KE:</span>
    <input class="ws-to-input" id="wsToInput" placeholder="@username" maxlength="32" oninput="validateWsTo()">
    <button class="ws-close-btn" onclick="closeWsCompose()">‚úï</button>
  </div>
  <textarea class="ws-body" id="wsBodyInput" placeholder="Tulis pesanmu..." maxlength="1000" oninput="validateWsBody()"></textarea>
  <div class="ws-compose-foot">
    <span class="ws-char-count" id="wsCharCount">0 / 1000</span>
    <button class="ws-send-btn" id="wsSendBtn" onclick="sendWs()" disabled>Kirim ‚ú¶</button>
  </div>
</div>

<!-- WHISPERER THREAD -->
<div class="ws-thread" id="wsThreadScreen">
  <div class="ws-thread-head">
    <button class="ws-back-btn" onclick="closeWsThread()">‚Üê</button>
    <div class="ws-thread-title" id="wsThreadTitle">@username</div>
    <button class="ws-vt-btn" onclick="openVtCompose()" title="Void Tap">‚óº</button>
  </div>
  <div class="ws-thread-msgs" id="wsThreadMsgs"></div>
  <div class="ws-thread-input-wrap">
    <input class="ws-thread-input" id="wsThreadInput" placeholder="Balas..." maxlength="1000">
    <button class="ws-thread-send" onclick="sendWsReply()">‚û§</button>
  </div>
</div>

<!-- VOID TAP COMPOSE -->
<div class="vt-compose" id="vtCompose">
  <div class="vt-compose-inner">
    <div class="vt-lbl">Void Tap ‚Äî hilang 5 detik setelah dibuka</div>
    <textarea class="vt-textarea" id="vtText" placeholder="tulis sesuatu yang ga bisa kamu bilang di tempat lain..." maxlength="280"></textarea>
    <div class="vt-meta">
      <span class="vt-quota" id="vtQuotaDisplay">3 void tap tersisa hari ini</span>
      <div class="vt-actions">
        <button class="vt-cancel" onclick="closeVtCompose()">Batal</button>
        <button class="vt-send" id="vtSendBtn" onclick="sendVoidTap()" disabled>Kirim</button>
      </div>
    </div>
  </div>
</div>

<!-- VOID TAP READER -->
<div class="vt-reader" id="vtReader">
  <div class="vt-reader-from" id="vtReaderFrom">dari seseorang</div>
  <div class="vt-reader-msg" id="vtReaderMsg"></div>
  <div class="vt-reader-timer" id="vtReaderTimer">menghilang dalam 5</div>
</div>

<!-- UPGRADE NUDGE -->
<div class="vt-upgrade-nudge" id="vtUpgradeNudge" onclick="showUpgradeModal()">
  limit harian habis ‚Äî <b>upgrade untuk unlimited void tap</b>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let currentGender = null;
let chatPartner = null;
let timerInterval = null;
let chatTimeLeft = 900;
let selectedPlan = null;
let activeMood = 'all';
let radarInterval;
let radarRAF = null;
let userName = 'stranger';

// ‚îÄ‚îÄ AI CHARACTERS ‚îÄ‚îÄ
const AI_CHARS = {
  female: [
    {name:'beby.manis', mood:['surviving','thriving','chaotic'], rants:["hari ini gue liat mantan sama cewek baru, dan tau gak? rambutnya lebih bagus dari rambut gue üò≠","cape bener jadi cewek, setiap bulan harus nahan sakit perut sambil tetep senyum di depan client","kenapa sih cowok kalo ditanya 'lagi apa' pasti jawabnya 'lagi main'? ga ada variasi lain?","gue lagi fase pengen dimengerti tanpa harus jelasin panjang lebar","bete banget skincare gue habis, padahal baru kemarin beli. ada yang ngutil?"]},
    {name:'strawberry.shortcake', mood:['surviving','doom','chaotic'], rants:["hari ini gue salah kirim chat pacar ke grup keluarga. isinya 'sayang udah mandi belom?' üò≠","kenapa orangtua selalu curiga kalo kita lagi seneng? 'lagi seneng-seneng ya? nanti belajar'","gue lagi diet, tapi tiap liat roti, rotinya yang liat gue duluan","stress skripsi tapi yang keluar peluh dan air mata doang","hari ini gue nangis karena ga bisa buka toples. lemah?"]},
    {name:'pretty.sad', mood:['doom','surviving'], rants:["kadang gue mikir, apa kita yang terlalu berharap atau emang janjinya ga pernah ditepatin?","hujan hari ini, tapi gaada yang tanya 'udah makan belom?'","capek pura-pura baik-baik aja. gue juga manusia, bisa hancur","kenapa ya orang lebih peduli sama 'kabar' daripada 'perasaan'?","malam ini gue lagi fase nerima kenyataan kalo dia ga akan balik"]},
    {name:'little.fairy', mood:['chaotic','thriving','surviving'], rants:["kalo gue jadi kucing, gue bakal tidur 20 jam sehari dan ga bakal di-judge malas","hari ini gue nangis karena liat video kura-kura lagi berantem. mereka kayak 'ga ada yang mundur!'","kok bisa sih orang dagang pake sound toa keras banget? emang gaada kerjaan lain?","gue percaya kalo alam semesta itu lagi iseng sama gue","ada yang percaya rejeki ga bakal kemana? gue, tapi tetep nangis tiap liat saldo"]},
    {name:'cinnamon.girl', mood:['doom','surviving'], rants:["hari ini gue nangis di angkot gegara liat kucing dipukul orang. mental gue udah kayak kerupuk kena hujan.","kenapa sih orang jahat bisa tidur nyenyak? gue yang baik aja susah tidur","hari ini gue bantu orang, eh malah dijadiin 'teman curhat' seharian. capek fisik mental","tolong kasih gue tanda kalo dunia ini ga sekejam kelihatannya","lagi fase sulit bilang 'ga' ke orang. jadi numpuk kerjaan sendiri"]}
  ],
  male: [
    {name:'si.badai', mood:['doom','surviving','chaotic'], rants:["hari ini gue ditagih utang sama mantan. utang apa? utang perasaan katanya","capek jadi orang yang dianggap kuat terus. gue juga pengen nangis dipeluk","kenapa sih kalo udah malem suka overthinking? badan capek tapi pikiran lari maraton","jadi cowok tuh gaboleh lemah katanya. tapi dalemnya ancur","gue capek jadi 'tembok' tempat orang bersandar. giliran gue butuh sandaran, pada pergi"]},
    {name:'moon.child', mood:['doom','surviving'], rants:["malam ini gue liat bulan sendirian. sama kayak gue. tapi bulan masih punya bintang.","kenapa cinta harus pergi? apa karena gue ga bisa jadi alasan buat dia bertahan?","hari ini gue dapet kabar doi udah tunangan. selamat ya, semoga dia bahagia (gue bohong)","capek nungguin orang yang ga pasti. tapi lebih capek ngelepasinnya","jangan tanya gue 'kabar baik?'. kabar gue baik-baik aja, cuma hati lagi berdarah-darah"]},
    {name:'si.kocak', mood:['chaotic','surviving'], rants:["hidup tuh kayak sinetron. kadang bahagia, kadang nangis, tapi endingnya selalu bikin kesel","hari ini gue ditilang polisi. katanya motor gue terlalu keren. padahal cuma mau pamer","stress mikirin masa depan. solusi gue: tidur. besok dipikirin lagi. atau lusa","orang bilang kalo kamu ketawa berarti kamu bahagia. berarti gue artis pemenang Oscar","hari ini gue ketawa terbahak-bahak. abis itu nangis. abis itu ketawa lagi. am i okay?"]},
    {name:'si.pedas', mood:['chaotic','thriving','surviving'], rants:["hari ini gue dikatain 'kamu berubah'. iya lah, gua bukan nasi bisa tetep sama","tolong ya, kalo chat itu dibales. jangan cuma diliat doang, matanya apa hpnya yang liat?","ada yang bilang 'kerja keras ga akan khianati hasil'. hasilnya: gue dikhianati sama kesehatan","lagi fase males bales chat semua orang. bukan depresi, cuma lagi males sama dunia","orang suka bilang 'sabar ya'. gue pengen jawab 'sabarin aja tai'"]},
    {name:'abang.gaul', mood:['chaotic','surviving','doom'], rants:["hari ini gue liat orang bawa balon. mungkin balon itu temen curhatnya","kenapa sih kalo lagi di kamar mandi suka inget kejadian memalukan 5 tahun lalu?","gue pengen jadi kucing tetangga. tidur, makan, tidur lagi, ga pernah mikir cicilan","hari ini gue nangis gegara kehabisan kuota pas lagi nonton drakor climax","ada yang pernah ngerasa jadi orang paling sendiri di keramaian? iyalah kita di jalan tol"]}
  ]
};

// ‚îÄ‚îÄ USER RANTS (DUMMY DATA) ‚îÄ‚îÄ
const USER_RANTS = [
  {id:1, author:'anon.kucing', mood:'surviving', content:'Hari ini gue nangis di angkot gegara liat kucing dipukul orang. Mental gue udah kayak kerupuk kena hujan.', reactions:{skull:42,cry:89,fire:12,upside:7}, userReacted:null},
  {id:2, author:'sleepy.head', mood:'thriving', content:'akhirnya bisa tidur nyenyak semalaman setelah 3 minggu insomnia. makasih buat yang chat tadi malem.', reactions:{skull:23,cry:15,fire:67,upside:31}, userReacted:null},
  {id:3, author:'chaos.queen', mood:'chaotic', content:'hari ini chaos abis! dari bangun tidur udah salah ambil kaki, sampe kantor lupa bawa laptop.', reactions:{skull:89,cry:23,fire:45,upside:78}, userReacted:null},
  {id:4, author:'quiet.one', mood:'doom', content:'udah seminggu nggak keluar kamar. bukan karena sibuk. cuma nggak tau mau ngapain.', reactions:{skull:67,cry:112,fire:8,upside:34}, userReacted:null}
];

const REACTION_EMOJI = {skull:'üíÄ', cry:'üò≠', fire:'üî•', upside:'üôÉ'};
const $ = id => document.getElementById(id);
const esc = t => {const d=document.createElement('div'); d.textContent=t; return d.innerHTML};

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ
function toast(msg, isErr=false) {
  const t = $('toast');
  t.textContent = msg;
  t.className = 'toast' + (isErr ? ' error' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

function closeModal(id) { $(id).classList.remove('on'); }

function updateVibePct(val) { $('vibePct').textContent = val+'%'; }

function filterMood(btn) {
  document.querySelectorAll('.mood-chip').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  activeMood = btn.dataset.mood;
  renderSpills();
}

// ‚îÄ‚îÄ SPILLS ‚îÄ‚îÄ
function generateAIRants(count=3) {
  const rants = [];
  let nextId = Math.max(...USER_RANTS.map(u => u.id)) + 1;
  for (let i = 0; i < count; i++) {
    const gender = Math.random() > 0.5 ? 'female' : 'male';
    const char = AI_CHARS[gender][Math.floor(Math.random() * AI_CHARS[gender].length)];
    const mood = char.mood[Math.floor(Math.random() * char.mood.length)];
    rants.push({
      id: nextId++,
      author: char.name,
      isAI: true,
      mood,
      content: char.rants[Math.floor(Math.random() * char.rants.length)],
      reactions: {
        skull: Math.floor(Math.random() * 50),
        cry: Math.floor(Math.random() * 100),
        fire: Math.floor(Math.random() * 40),
        upside: Math.floor(Math.random() * 30)
      },
      userReacted: null
    });
  }
  return rants;
}

function renderSpills() {
  const list = $('spillsList');
  const allSpills = [...USER_RANTS, ...generateAIRants(6)];
  const filtered = activeMood === 'all' ? allSpills : allSpills.filter(s => s.mood === activeMood);
  
  if (!filtered.length) {
    list.innerHTML = '<div class="empty-state"><div class="empty-icon">üçÉ</div><div class="empty-title">Belum ada spill</div><div class="empty-text">Coba filter lain</div></div>';
    return;
  }
  
  list.innerHTML = filtered.map(s => `
    <div class="spill-card">
      <div class="spill-head">
        <span class="spill-user">@${esc(s.author)}${s.isAI ? ' ü§ñ' : ''}</span>
        <span class="spill-mood ${s.mood}">${s.mood}</span>
      </div>
      <div class="spill-body">${esc(s.content)}</div>
      <div class="spill-actions">
        ${Object.entries(REACTION_EMOJI).map(([k, em]) => `
          <button class="react-btn ${s.userReacted === k ? 'active' : ''}" onclick="react(this, ${s.id}, '${k}')">
            ${em}<span class="react-count" id="rc-${s.id}-${k}">${s.reactions[k]}</span>
          </button>
        `).join('')}
      </div>
    </div>
  `).join('');
}

function react(btn, id, key) {
  const spill = [...USER_RANTS, ...generateAIRants(0)].find(s => s.id === id);
  if (!spill) return;
  
  const was = btn.classList.contains('active');
  document.querySelectorAll(`[id^="rc-${id}-"]`).forEach(el => el.closest('button').classList.remove('active'));
  
  if (was) {
    spill.reactions[key]--;
  } else {
    spill.reactions[key]++;
    btn.classList.add('active');
  }
  
  spill.userReacted = was ? null : key;
  
  Object.keys(spill.reactions).forEach(k => {
    const el = $(`rc-${id}-${k}`);
    if (el) el.textContent = spill.reactions[k];
  });
}

function refreshSpills() { renderSpills(); toast('Teh baru diseduh ‚òï'); }

// ‚îÄ‚îÄ RADAR ‚îÄ‚îÄ
let radarDots = [];
let needleAngle = 0;
let needleOmega = 0;
let phaseA = Math.random() * Math.PI * 2;
let phaseB = Math.random() * Math.PI * 2;
let phaseC = Math.random() * Math.PI * 2;

const BASE_RPM = 60 / 4;
const BASE_OMEGA = (BASE_RPM * Math.PI * 2) / (60 * 60);
const TRAIL_CAP = 120;
const trail = new Float32Array(TRAIL_CAP);
let trailPtr = 0;
const dotGlow = new Map();

function initRadar() {
  const canvas = $('radarCanvas');
  const cont = $('radarCont');
  
  function resize() {
    const r = cont.getBoundingClientRect();
    canvas.width = r.width;
    canvas.height = r.height;
  }
  
  resize();
  window.addEventListener('resize', resize, {passive: true});
  
  spawnDots();
  
  radarInterval = setInterval(() => {
    radarDots.forEach(d => {
      d.vx = (d.vx * 0.88) + (Math.random() - 0.5) * 0.3;
      d.vy = (d.vy * 0.88) + (Math.random() - 0.5) * 0.3;
      d.x = Math.max(9, Math.min(91, d.x + d.vx));
      d.y = Math.max(9, Math.min(91, d.y + d.vy));
      d.el.style.left = d.x + '%';
      d.el.style.top = d.y + '%';
    });
  }, 100);
  
  $('quotaBadge').textContent = Math.floor(18 + Math.random() * 15);
  needleAngle = Math.random() * Math.PI * 2;
  trail.fill(needleAngle);
  
  radarLoop(canvas);
}

function spawnDots() {
  const con = $('radarDots');
  con.innerHTML = '';
  radarDots = [];
  
  const count = 5 + Math.floor(Math.random() * 5);
  for (let i = 0; i < count + 2; i++) {
    const isAI = i >= count;
    const ang = Math.random() * Math.PI * 2;
    const dist = 12 + Math.random() * 70;
    const x = 50 + Math.cos(ang) * dist / 2;
    const y = 50 + Math.sin(ang) * dist / 2;
    const dot = document.createElement('div');
    const type = isAI ? 'ai' : (Math.random() > 0.5 ? 'purple' : 'red');
    dot.className = 'radar-dot ' + type;
    dot.style.left = x + '%';
    dot.style.top = y + '%';
    con.appendChild(dot);
    radarDots.push({el:dot, x, y, vx:0, vy:0, type, id:i});
  }
}

function radarLoop(canvas) {
  const ctx = canvas.getContext('2d');
  
  function frame(now) {
    const W = canvas.width, H = canvas.height;
    const cx = W / 2, cy = H / 2;
    const R = Math.min(cx, cy) * 0.88;
    
    // Organic speed variation
    phaseA += 0.007;
    phaseB += 0.013;
    phaseC += 0.041;
    const speedMult = 1.0 + Math.sin(phaseA) * 0.35 + Math.sin(phaseB) * 0.18 + Math.sin(phaseC) * 0.04;
    const targetOmega = BASE_OMEGA * speedMult;
    needleOmega += (targetOmega - needleOmega) * 0.028;
    needleAngle = (needleAngle + needleOmega) % (Math.PI * 2);
    
    // Store trail
    trail[trailPtr] = needleAngle;
    trailPtr = (trailPtr + 1) % TRAIL_CAP;
    
    // Fade canvas
    const fade = 0.09 + Math.sin(now * 0.0011) * 0.008;
    ctx.fillStyle = `rgba(1,5,1,${fade})`;
    ctx.fillRect(0, 0, W, H);
    
    // Draw phosphor trail
    for (let i = 0; i < TRAIL_CAP - 1; i++) {
      const newer = (trailPtr - 1 - i + TRAIL_CAP) % TRAIL_CAP;
      const older = (trailPtr - 2 - i + TRAIL_CAP) % TRAIL_CAP;
      const a0 = trail[older];
      const a1 = trail[newer];
      const recency = 1 - i / TRAIL_CAP;
      const alpha = Math.pow(recency, 1.6) * 0.52;
      
      if (alpha < 0.003) break;
      
      let start = a0, end = a1;
      if (end - start > Math.PI) start += Math.PI * 2;
      if (start - end > Math.PI) end += Math.PI * 2;
      
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.arc(0, 0, R, start, end, false);
      ctx.closePath();
      ctx.fillStyle = `rgba(0,255,65,${alpha})`;
      ctx.fill();
      ctx.restore();
    }
    
    // Draw needle
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(needleAngle);
    ctx.shadowColor = 'rgba(0,255,65,0.9)';
    ctx.shadowBlur = 10;
    
    const lg = ctx.createLinearGradient(0, 0, R, 0);
    lg.addColorStop(0, 'rgba(0,255,65,1)');
    lg.addColorStop(0.55, 'rgba(0,255,65,0.8)');
    lg.addColorStop(0.85, 'rgba(0,255,65,0.35)');
    lg.addColorStop(1, 'rgba(0,255,65,0)');
    
    ctx.beginPath();
    ctx.moveTo(4, 0);
    ctx.lineTo(R, 0);
    ctx.strokeStyle = lg;
    ctx.lineWidth = 1.8;
    ctx.stroke();
    
    ctx.shadowBlur = 16;
    ctx.beginPath();
    ctx.arc(0, 0, 3.5, 0, Math.PI * 2);
    ctx.fillStyle = '#00ff41';
    ctx.fill();
    ctx.restore();
    
    // Dot hit detection
    radarDots.forEach((d, di) => {
      const px = d.x / 100 * W;
      const py = d.y / 100 * H;
      const dxp = px - cx, dyp = py - cy;
      let dotAng = Math.atan2(dyp, dxp);
      if (dotAng < 0) dotAng += Math.PI * 2;
      let diff = needleAngle - dotAng;
      if (diff < 0) diff += Math.PI * 2;
      
      const age = dotGlow.get(di) ?? 999;
      
      if (diff < 0.14 && age > 40) {
        dotGlow.set(di, 0);
        d.el.classList.add('active');
        setTimeout(() => d.el.classList.remove('active'), 700);
      } else {
        dotGlow.set(di, age + 1);
      }
      
      // Draw glow
      if (age < 60) {
        const t = age / 60;
        const ga = (1 - t) * (1 - t) * 0.9;
        if (ga > 0.01) {
          const col = d.type === 'purple' ? [176,38,255] : d.type === 'red' ? [255,0,64] : [0,255,65];
          const gr = ctx.createRadialGradient(px, py, 0, px, py, 14 * (1-t) + 4);
          gr.addColorStop(0, `rgba(${col[0]},${col[1]},${col[2]},${ga})`);
          gr.addColorStop(1, `rgba(${col[0]},${col[1]},${col[2]},0)`);
          ctx.beginPath();
          ctx.arc(px, py, 14 * (1-t) + 4, 0, Math.PI * 2);
          ctx.fillStyle = gr;
          ctx.fill();
        }
      }
    });
    
    radarRAF = requestAnimationFrame(frame);
  }
  
  radarRAF = requestAnimationFrame(frame);
}

// ‚îÄ‚îÄ MODEL A: VIBE CHECK ‚îÄ‚îÄ
function startVibeCheck() { $('genderModal').classList.add('on'); }

function selectGender(el, g) {
  document.querySelectorAll('.gender-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  currentGender = g;
  $('genderConfirm').disabled = false;
}

function confirmGender() {
  if (!currentGender) return;
  closeModal('genderModal');
  userName = 'stranger';
  findRealUserFirst();
}

async function findRealUserFirst() {
  $('chatMessages').innerHTML = '';
  $('distressBanner').classList.remove('show');
  $('chatRoom').classList.add('on');
  $('chatPartnerName').textContent = 'MENCARI...';
  
  const el = document.createElement('div');
  el.className = 'chat-bubble them searching-msg';
  el.id = 'searching-indicator';
  el.style.alignSelf = 'center';
  el.style.fontStyle = 'italic';
  el.style.borderStyle = 'dashed';
  el.style.borderColor = 'var(--aq)';
  el.style.color = 'var(--txs)';
  el.textContent = 'üîç sedang dicarikan teman ngobrol...';
  $('chatMessages').appendChild(el);
  
  let t = 60;
  const searchTimer = setInterval(() => {
    t--;
    const e = $('searching-indicator');
    if (e) e.textContent = `üîç mencari teman... (${t}s)`;
    if (t <= 0) {
      clearInterval(searchTimer);
      if ($('searching-indicator')) {
        $('searching-indicator').remove();
        fallbackToAI();
      }
    }
  }, 1000);
  
  if (Math.random() < 0.4) {
    setTimeout(() => {
      clearInterval(searchTimer);
      if ($('searching-indicator')) {
        $('searching-indicator').remove();
        const opp = currentGender === 'male' ? 'female' : 'male';
        const names = opp === 'female' ? ['jessica','amanda','sarah','diana','melanie'] : ['kevin','brian','alex','steven','jordan'];
        chatPartner = {name: names[Math.floor(Math.random() * names.length)], isAI: false, gender: opp};
        startRealChat();
      }
    }, 5000 + Math.random() * 25000);
  }
}

function fallbackToAI() {
  const opp = currentGender === 'male' ? 'female' : 'male';
  const char = AI_CHARS[opp][Math.floor(Math.random() * AI_CHARS[opp].length)];
  chatPartner = {name: char.name, isAI: true, gender: opp, charData: char};
  toast('üí¨ Ditemani AI dulu ya');
  startRealChat();
}

function startRealChat() {
  chatTimeLeft = 900;
  $('chatMessages').innerHTML = '';
  $('distressBanner').classList.remove('show');
  $('chatPartnerName').textContent = 'STRANGER_' + String(Math.floor(Math.random() * 99)).padStart(2, '0');
  startTimer();
  
  setTimeout(() => {
    const g = chatPartner.isAI
      ? [`hai! gue ${chatPartner.name}. lagi apa?`, `halo~ kenalin gue ${chatPartner.name}`, `akhirnya ketemu. gue ${chatPartner.name}`, `haiii, gue ${chatPartner.name}. lagi apa nih?`]
      : ['halo! ada cerita apa hari ini? üëã', 'hei, akhirnya nyambung juga', 'hai! lagi gimana?'];
    addMsg(g[Math.floor(Math.random() * g.length)], false);
  }, 800);
}

function closeChat() {
  clearInterval(timerInterval);
  timerInterval = null;
  $('chatRoom').classList.remove('on');
  toast('üëã Sampai jumpa!');
}

function startTimer() {
  updateTimer();
  timerInterval = setInterval(() => {
    chatTimeLeft--;
    updateTimer();
    if (chatTimeLeft === 300) toast('‚ö†Ô∏è Sisa 5 menit! Upgrade untuk lanjut.');
    if (chatTimeLeft <= 0) endChat();
  }, 1000);
}

function updateTimer() {
  const m = Math.floor(chatTimeLeft / 60);
  const s = chatTimeLeft % 60;
  $('chatTimer').textContent = `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
  $('chatTimer').classList.toggle('warn', chatTimeLeft <= 300);
}

function endChat() {
  clearInterval(timerInterval);
  timerInterval = null;
  $('chatRoom').classList.remove('on');
  $('upgradeModal').classList.add('on');
}

// ‚îÄ‚îÄ TYPING ENGINE ‚îÄ‚îÄ
class TypingEngine {
  showTypingIndicator() {
    const el = document.createElement('div');
    el.className = 'typing';
    el.id = 'typing-indicator-real';
    el.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
    $('chatMessages').appendChild(el);
    $('chatMessages').scrollTop = 9999;
    return el;
  }
  
  async typeMessage(text) {
    const container = $('chatMessages');
    const msgDiv = document.createElement('div');
    msgDiv.className = 'chat-bubble them';
    container.appendChild(msgDiv);
    
    const cur = document.createElement('span');
    cur.className = 'typing-cursor';
    msgDiv.appendChild(cur);
    
    let typed = '';
    let willTypo = Math.random() < 0.15;
    let typoIdx = -1, typoChar = '', typoFixed = false;
    
    if (willTypo) {
      typoIdx = Math.floor(Math.random() * (text.length / 2)) + 3;
      typoChar = 'asdfghjklzxcvbnmqwertyuiop'[Math.floor(Math.random() * 26)];
    }
    
    for (let i = 0; i <= text.length; i++) {
      if (willTypo && !typoFixed && i === typoIdx) {
        typed += typoChar;
        msgDiv.innerHTML = typed;
        msgDiv.appendChild(cur);
        await this.sleep(150 + Math.random() * 100);
        
        for (let b = 0; b < 2; b++) {
          typed = typed.slice(0, -1);
          msgDiv.innerHTML = typed;
          msgDiv.appendChild(cur);
          await this.sleep(100 + Math.random() * 50);
        }
        typoFixed = true;
        continue;
      }
      
      if (i < text.length) {
        typed += text[i];
        msgDiv.innerHTML = typed;
        msgDiv.appendChild(cur);
        
        let d = 50 + Math.random() * 150;
        if (text[i] === ',' || text[i] === ';') d = 300;
        if (text[i] === '.' || text[i] === '?' || text[i] === '!') d = 500;
        await this.sleep(d);
      }
    }
    
    cur.remove();
    
    const ts = document.createElement('div');
    ts.className = 'chat-time';
    ts.textContent = new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});
    msgDiv.appendChild(ts);
    
    container.scrollTop = container.scrollHeight;
    return msgDiv;
  }
  
  sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
}

const typingEngine = new TypingEngine();

function generateAIRant() {
  if (!chatPartner?.isAI || !chatPartner?.charData) return null;
  const char = chatPartner.charData;
  const rant = char.rants[Math.floor(Math.random() * char.rants.length)];
  const mood = char.mood?.length ? char.mood[Math.floor(Math.random() * char.mood.length)] : 'surviving';
  return {text: rant, mood};
}

async function sendMsg() {
  const inp = $('chatInput');
  const text = inp.value.trim();
  if (!text) return;
  
  addMsg(text, true);
  inp.value = '';
  
  const delay = Math.min(3000, Math.max(800, text.length * 120)) * (0.7 + Math.random() * 0.6);
  const ind = typingEngine.showTypingIndicator();
  
  if (chatPartner?.isAI) {
    setTimeout(async () => {
      ind.remove();
      if (Math.random() < 0.3) {
        const rant = generateAIRant();
        if (rant) {
          await typingEngine.typeMessage(rant.text);
          if (Math.random() < 0.5) setTimeout(() => addMsg(`[mood: ${rant.mood}]`, false), 500);
          if (rant.mood === 'doom' || rant.mood === 'surviving') $('distressBanner').classList.add('show');
        } else {
          await typingEngine.typeMessage('*ngelantur sendiri*');
        }
      } else {
        const r = ['haha iya gitu deh', 'sama wkwk', 'eh gue juga gitu', 'nggak nyangka lo jg', 'ya ampun relate banget'];
        await typingEngine.typeMessage(r[Math.floor(Math.random() * r.length)]);
      }
    }, delay);
  } else {
    const r = ['haha iya gitu deh', 'sama wkwk', 'eh gue juga', 'nggak nyangka lo jg', 'ya ampun relate'];
    setTimeout(async () => {
      ind.remove();
      if (Math.random() < 0.75) await typingEngine.typeMessage(r[Math.floor(Math.random() * r.length)]);
    }, delay);
  }
}

function addMsg(text, isOwn) {
  const div = document.createElement('div');
  div.className = 'chat-bubble ' + (isOwn ? 'me' : 'them');
  const time = new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});
  div.innerHTML = esc(text) + `<div class="chat-time">${time}</div>`;
  
  const msgs = $('chatMessages');
  msgs.appendChild(div);
  
  while (msgs.children.length > 20) msgs.removeChild(msgs.firstChild);
  msgs.scrollTop = msgs.scrollHeight;
}

function selectPlan(el, plan) {
  document.querySelectorAll('.price-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPlan = plan;
  $('upgradeNow').disabled = false;
}

function upgradeNow() {
  if (!selectedPlan) return;
  toast('üîÑ Memproses upgrade...');
  setTimeout(() => {
    toast('‚úÖ Upgrade berhasil!');
    closeModal('upgradeModal');
    if (chatPartner) {
      chatTimeLeft = selectedPlan === 'weekly' ? 7200 : 10800;
      $('chatRoom').classList.add('on');
      clearInterval(timerInterval);
      startTimer();
      addMsg('obrolan dilanjut!', false);
    }
  }, 1500);
}

// ‚îÄ‚îÄ MODEL B: WHISPERER ‚îÄ‚îÄ
const WS = {
  isSubscribed: localStorage.getItem('ws_subscribed') === 'true',
  threads: JSON.parse(localStorage.getItem('ws_threads') || '[]'),
  save() { localStorage.setItem('ws_threads', JSON.stringify(this.threads)); },
  getThread(u) { return this.threads.find(t => t.username === u); },
  addMessage(u, text, isOwn) {
    let t = this.getThread(u);
    if (!t) {
      t = {username: u, messages: [], unread: 0, updatedAt: Date.now()};
      this.threads.unshift(t);
    } else {
      this.threads = [t, ...this.threads.filter(x => x.username !== u)];
    }
    t.messages.push({
      id: Date.now(),
      text,
      isOwn,
      time: new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'}),
      timestamp: Date.now()
    });
    if (!isOwn) t.unread = (t.unread || 0) + 1;
    t.updatedAt = Date.now();
    if (t.messages.length > 50) t.messages = t.messages.slice(-50);
    this.save();
  },
  markRead(u) { const t = this.getThread(u); if (t) { t.unread = 0; this.save(); } },
  totalUnread() { return this.threads.reduce((s, t) => s + (t.unread || 0), 0); }
};

let activeWsThread = null;

function openWsModal() {
  if (!WS.isSubscribed) {
    $('wsGate').style.display = 'block';
    $('wsInbox').style.display = 'none';
  } else {
    $('wsGate').style.display = 'none';
    $('wsInbox').style.display = 'block';
    renderWsInbox();
  }
  $('wsModal').classList.add('on');
}

function subscribeWs() {
  toast('‚ü≥ Memproses pembayaran...');
  setTimeout(() => {
    WS.isSubscribed = true;
    localStorage.setItem('ws_subscribed', 'true');
    if (!WS.threads.length) {
      WS.addMessage('pretty.sad', 'hei, gue liat spill lo. lo oke?', false);
      WS.addMessage('cinnamon.girl', 'thanks udah chat kemarin ya', false);
    }
    $('wsGate').style.display = 'none';
    $('wsInbox').style.display = 'block';
    renderWsInbox();
    toast('‚úì Whisperer aktif');
  }, 1500);
}

function renderWsInbox() {
  const list = $('wsThreadList');
  const empty = $('wsEmptyState');
  if (!list) return;
  
  if (!WS.threads.length) {
    list.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  
  empty.style.display = 'none';
  list.innerHTML = WS.threads.map(t => {
    const last = t.messages[t.messages.length - 1];
    const preview = last ? (last.isOwn ? 'Kamu: ' + last.text : last.text) : '‚Äî';
    const ago = last ? timeAgoShort(last.timestamp) : '';
    return `
      <div class="ws-thread-item${t.unread ? ' unread' : ''}" onclick="openWsThread('${t.username}')">
        <div class="ws-avatar">${t.username[0].toUpperCase()}</div>
        <div class="ws-thread-info">
          <div class="ws-thread-name">@${esc(t.username)}</div>
          <div class="ws-thread-preview">${esc(preview.slice(0, 60))}</div>
        </div>
        <div class="ws-thread-right">
          <div class="ws-thread-time">${ago}</div>
          ${t.unread ? `<div class="ws-unread-badge">${t.unread}</div>` : ''}
        </div>
      </div>
    `;
  }).join('');
}

function timeAgoShort(ts) {
  const s = Math.floor((Date.now() - ts) / 1000);
  if (s < 60) return 'baru';
  const m = Math.floor(s / 60);
  if (m < 60) return m + 'm';
  const h = Math.floor(m / 60);
  if  const s = Math.floor((Date.now() - ts) / 1000);
  if (s < 60) return 'baru';
  const m = Math.floor(s / 60);
  if (m < 60) return m + 'm';
  const h = Math.floor(m / 60);
  if (h < 24) return h + 'j';
  return Math.floor(h / 24) + 'h';
}

function openWsCompose() {
  closeModal('wsModal');
  $('wsToInput').value = '';
  $('wsBodyInput').value = '';
  $('wsCharCount').textContent = '0 / 1000';
  $ (h < 24) return h + 'j';
  return Math.floor(h / 24) + 'h';
}

function openWsCompose() {
  closeModal('wsModal');
  $('wsToInput').value = '';
  $('wsBodyInput').value = '';
  $('wsCharCount').textContent = '0 / 1000';
  $('wsSendBtn').disabled = true;
  $('wsComposeScreen').classList.add('on');
  setTimeout(() => $('wsToInput').focus(), 200);
}

function('wsSendBtn').disabled = true;
  $('wsComposeScreen').classList.add('on');
  setTimeout(() => $('wsToInput').focus(), 200);
}

function closeWsCompose() { $(' closeWsCompose() { $('wsComposeScreen').classwsComposeScreen').classList.remove('onList.remove('on'); }

'); }

function validatefunction validateWsToWsTo() {
  const() {
  const to = to = $('wsTo $('wsToInput').Input').value.replace('@value.replace('@', ''', '').trim();
  const body = $('wsBodyInput').value.trim();
  $('wsSendBtn').disabled = !(to.length >= 2 && body.length >).trim();
  const body = $('wsBodyInput').value.trim();
  $('wsSendBtn').disabled = !(to.length >= 2 && body.length > 0 0);
}

function validateWsBody);
}

function validateWsBody() {
() {
  const body =  const body = $('wsBodyInput'). $('wsBodyvalue;
  $Input').value;
  $('wsCharCount('ws').textContent =CharCount').textContent = `${body.length} / 1000 `${body.length} / 1000`;
 `;
  $(' $('wsCharwsCharCount').Count').style.color = bodystyle.color = body.length >.length > 900 ? ' 900 ? 'var(--var(--war)' : 'var(--txm)';
  validateWsTo();
}

function sendWs() {
 war)' : 'var(--txm)';
  validateWsTo();
}

function sendWs() {
  const to = $('wsToInput').value.replace(' const to = $('wsToInput').value.replace('@', '').@', '').trim();
trim();
  const  const body = $(' body = $('wsBodywsBodyInput').value.trimInput').value.trim();
 ();
  if (!to || if (!to || !body !body) return;
  
) return;
  
  WS  WS.addMessage.addMessage(to, body,(to, body, true);
 true);
  close  closeWsCompose();
WsCompose();
  
   
  setTimeout(() => {
 setTimeout(() => {
    const    const r = ['hei! baru liat r = ['hei! baru liat ini. ini. lagi apa lagi apa?', 'wah?', 'wah,, sama banget rasanya', ' sama banget rasanyamakasih udah DM. gue lagi oke kok', 'haha iya relate banget', 'eh beneran', 'makasih udah DM. gue lagi oke kok', 'haha iya relate banget', 'eh beneran? g? gue juga lagi nue juga lagi ngerasgerasain ituain itu'];
   '];
    WS.addMessage(to, r[Math.floor(Math.random() * r.length)], WS.addMessage(to, r[Math.floor(Math.random() * r.length)], false);
 false);
    update    updateWsBadge();
WsBadge();
  }, 400  }, 4000 +0 + Math.random Math.random() *() * 800 8000);
  
 0);
  
  toast(` toast(`‚úì Whisper terkirim‚úì Whisper terkirim ke @${to ke @${to}`);
  openWsModal();
}

function openWs}`);
  openWsModal();
}

function openWsThread(u) {
  activeWsThread = u;
  WS.markRead(u);
  $('wsThreadTitle').textContent = '@' +Thread(u) {
  activeWsThread = u;
  WS.markRead(u);
  $('wsThreadTitle').textContent = '@' + u;
 u;
  closeModal('wsModal');
   closeModal('wsModal');
  renderWsThread(u);
  renderWsThread(u);
  $('wsThreadScreen'). $('wsThreadScreen').classList.add('classList.add('on');
  setTimeout(() =>on');
 $('  setTimeout(() => $('wsThreadInput').focus(),wsThreadInput').focus(), 200);
}

 200);
}

function closefunction closeWsThread() {
  $WsThread() {
  $('wsThreadScreen').classList.remove('wsThreadScreen').classList.remove('on');
  activeWsThread =('on');
  activeWsThread = null;
 null;
  openWsModal  openWsModal();
}

function renderWsThread(u) {
  const thread();
}

function renderWsThread(u) {
  const thread = WS.getThread(u);
  const container = $('wsThreadMsgs');
  if (!thread || !container = WS.getThread(u);
  const container = $('wsThreadMsgs');
  if (!thread || !container) return;
  
  container) return;
  
  container.innerHTML = thread.m.innerHTML = thread.messages.map(m =>essages.map(m => `
    `
    <div class="chat-bubble ${ <div class="chat-bm.isOwn ?ubble ${m.isOwn ? 'me' : 'them 'me' : 'them'}">
      ${'}">
      ${esc(m.text)}<divesc(m.text)}<div class=" class="chat-time">${chat-time">${m.time}</div>
   m.time}</div>
    </div </div>
  `).>
  `).join('');
  container.scrollTop = container.scrollHeight;
}

function sendWsReply() {
join('');
  container.scrollTop = container.scrollHeight;
}

function sendWsReply() {
  const inp = $('wsThreadInput');
  const text = inp.value  const inp = $('wsThreadInput');
  const text = inp.value.trim();
.trim();
  if (!text  if (!text || ! || !activeWsThread)activeWsThread) return;
 return;
  
  WS.add  
  WS.addMessage(activeWsThread,Message(activeWsThread, text, true);
  inp text, true);
  inp.value =.value = '';
  renderWsThread( '';
  renderWsThread(activeWsThread);
  
 activeWsThread);
  
  setTimeout(() => {
    const setTimeout(() => {
    const r = ['iya gue r = ['iya gue tau', tau', 'hm, beneran 'hm, beneran?', 'wah?', 'wah relate', relate', 'haha iya juga sih', 'eh makas 'haha iya juga sih', 'eh makasih udahih udah cerita'];
    WS.addMessage(activeWsThread, r[Math.floor(Math.random() * r.length)], false cerita'];
    WS.addMessage(activeWsThread, r[Math.floor(Math.random() * r.length)], false);
    renderWsThread();
    renderWsThread(activeWsThread);
    updateactiveWsThread);
    updateWsBadge();
WsBadge();
  }, 200  }, 2000 + Math.random0 + Math.random() * 500() * 5000);
}

function updateWsBadge() {
0);
}

function updateWsBadge() {
  const badge =  const badge = $(' $('wsBadwsBadge');
  constge');
  const total = WS.total total = WS.totalUnreadUnread();
  badge.text();
  badge.textContent =Content = total;
  badge.classList.toggle('show', total > 0);
}

 total;
  badge.classList.toggle('show', total > 0);
}

// ‚îÄ‚îÄ VOID TAP ‚îÄ‚îÄ
const VT = {
// ‚îÄ‚îÄ VOID TAP ‚îÄ‚îÄ
const VT = {
  FREE_DA  FREE_DAILY: 3ILY: 3,
 ,
  BURN_SECS BURN_SECS: : 5,
5,
  isPremium: false,
  isPremium: false,
  get quotaKey() {  get quotaKey() { return 'vt_ return 'vt_quotaquota_' + new Date_' + new Date().toDateString().toDateString(); },
(); },
  get remaining() {  get remaining() { if ( if (this.isPremium) return Infinity; returnthis.isPremium) return Infinity; return Math.max Math.max(0(0, this.FREE, this.FREE_DAILY - (parseInt(localStorage.getItem(this.quotaKey) || '_DAILY - (parseInt(localStorage.getItem(this.quotaKey) || '0'))); },
  use() {
    if (this.isPremium) return true;
    const0'))); },
  use() {
    if (this.isPremium) return true;
    const used = parseInt(l used = parseInt(localStorageocalStorage.getItem(this.qu.getItem(this.quotaKeyotaKey) || '0');
    if () || '0');
    if (used >= this.Fused >= this.FREE_DAILY) returnREE_DAILY) return false;
 false;
    localStorage    localStorage.setItem(this..setItem(this.quotaKey,quotaKey, String(used + 1));
    return true;
  },
  inbox: String(used + 1));
    return true;
  },
  inbox: JSON.parse JSON.parse(localStorage.getItem('vt_inbox') ||(localStorage.getItem('vt_inbox') || '[]'),
  saveInbox() { localStorage.setItem('vt_inbox', JSON.stringify(this.inbox)); },
  add '[]'),
  saveInbox() { localStorage.setItem('vt_inbox', JSON.stringify(this.inbox)); },
  addToInToInbox(msg, frombox(msg, from = 'seseorang = 'seseorang') {
    this.inbox.push({id: Date.now(), msg') {
    this.inbox.push({id: Date.now(), msg, from, read: false, from, read: false});
    this.saveInbox});
    this.saveInbox();
    updateV();
    updateVtIndicatortIndicator();
  }
};

let vt();
  }
};

let vtBurnTimer =BurnTimer = null null;

function updateV;

functiontIndicator() {
  const updateVtIndicator() {
  const ind = ind = $('vtIndicator');
  if (!ind) return;
  ind.classList.toggle('has-tap', VT.inbox.s $('vtIndicator');
  if (!ind) return;
  ind.classList.toggle('has-tap', VT.inbox.some(t => !t.read));
}

function openome(t => !t.read));
}

function openVtVtCompose() {
Compose() {
  const  const rem = VT. rem = VT.remaining;
remaining;
  if (rem  if (rem <=  <= 0)0) {
    showVtUp {
    showVtUpgradeNgradeNudge();
udge();
    return    return;
  }
  
  const;
  }
  
  const qEl qEl = $('vt = $('vtQuotaQuotaDisplay');
  ifDisplay');
  if (q (qEl) {
    qElEl) {
    qEl.textContent = VT.textContent = VT.isPremium.isPremium ? 'unlimited' : `${rem} void tap tersisa hari ini`;
    qEl.className = 'vt-quota' + (rem ? 'unlimited' : `${rem} void tap tersisa hari ini`;
    qEl.className = 'vt-quota' + (rem <= 1 ? <= 1 ? ' low' : '');
 ' low' : '');
  }
  }
  
  const ta  
  const ta = $('vtText');
 = $('vtText');
  if (ta) {
  if (ta) {
    ta    ta.value =.value = '';
    '';
    $('vtSendBtn'). $('vtSendBtn').disabled = true;
  }
  
 disabled = true;
  }
 $('  
  $('vtCompose').classListvtCompose').classList.add('on');
.add('on');
  setTimeout(() =>  setTimeout ta?.focus(),(() => ta?.focus(), 200 200);
}

function closeVtCompose);
}

function closeVtCompose() {() { $('vtCompose').classList.remove('on'); }

function sendVoidTap() {
  const text = $('vtText').value.trim();
 $('vtCompose').classList.remove('on'); }

function sendVoidTap() {
  const text = $('vtText').value.trim();
  if (!text) return  if (!text) return;
  
;
  
  if (!VT.use())  if (!VT.use()) {
    closeVtCom {
    closeVpose();
    showVttCompose();
    showUpgradeNudge();
   VtUpgradeNudge return;
  }
();
    return;
  }
  
   
  closeV closeVtCompose();
tCom  toast('pose();
  toast('‚óº  void tap terkir‚óº  void tap terkirim');
im');
  
   
  setTimeout(() setTimeout(() => VT.addToInbox => VT.addToInbox(text, chatPartner(text, chatPartner?.name || activeWsThread || 'seseorang'), 3000);
}

function checkVoidTaps?.name || activeWsThread || 'seseorang'), 3000);
}

function checkVoidTaps() {
() {
  const  const unread = VT.in unread = VT.inbox.filter(t => !box.filter(t => !t.read);
  if (!t.read);
  if (!unreadunread.length) return;
.length) return;
  openVtReader(un  openVtReader(unreadread[0]);
[0]);
}

function openV}

function openVtReader(taptReader(tap) {
  const) {
  const reader = reader = $(' $('vtReader');
 vtReader');
  if (!reader) return;
 if (!reader) return;
  
  tap.read = true;
  
  tap.read = true;
   VT.save VT.saveInbox();
  updateVtIndicatorInbox();
  updateVtIndicator();
  
();
  
  $('vtReaderMsg').textContent = tap.  $('vtReaderMsg').textContent = tap.msg;
  $('vtReaderFrom').textContent = 'dari ' + tap.from;
  $('vtReaderTimermsg;
  $('vtReaderFrom').textContent = 'dari ' + tap.from;
  $('vtReaderTimer').text').textContent = `menghilang dalamContent = `menghil ${VTang dalam ${VT.BURN_SECS.BURN_SECS}`;
}`;
  
  reader.classList  
 .remove('burning reader.classList.remove('burning');
  reader.classList.add('');
  reader.classList.add('on');
on');
  
  let c  
  let c = VT.BURN = VT.BURN_SECS;
  vtBurn_SECS;
 Timer = vtBurn setInterval(() => {
   Timer = setInterval(() => {
    c--;
 c--;
    const t = $('vtReaderTimer');
    if (t    const t = $('vtReaderTimer');
    if (t) t.textContent = `menghilang dalam ${c}`;
    if (c <= 0) t.textContent = `menghilang dalam ${c}`;
    if (c <= 0) {
) {
      clearInterval(vtBurn      clearInterval(vtBurnTimer);
      vtBurnTimerTimer);
      vtBurnTimer = null;
      = null;
      burnVtReader(tap burnVtReader(tap.id);
.id);
    }
  }, 100    }
  }, 1000);
}

function0);
}

function burnVtReader(id) {
  burnVtReader(id) {
  const reader = $('vt const reader = $('vtReader');
  reader.classList.addReader');
  reader.classList.add('burning');
('burning');
  
  VT.inbox =  
  VT.inbox = VT.inbox.filter(t => t.id !== id);
  VT.saveInbox();
  
  setTimeout VT.inbox.filter(t => t.id !== id);
  VT.saveInbox();
  
  setTimeout(() => {
   (() => {
    reader.classList.remove('on', 'burning');
    updateVtIndicator();
 reader.classList.remove('on', 'burning');
    updateVtIndicator();
  }, 900);
}

  }, 900function show);
}

function showVtVtUpgradeNudgeUpgrade() {
  constNudge() {
  const el = el = $('vtUp $('vtUpgradeNgradeNudge');
udge');
  if (!el  if (!el) return) return;
  el.classList;
  el.classList.add('.add('show');
show');
  setTimeout(() => el.classList  setTimeout(() => el.classList.remove('show'), .remove('show'), 4004000);
0);
}

function}

function showUp showUpgradeModalgradeModal() {
  $('vt() {
  $('vtUpgradeNudgeUpgradeNudge')?.classList.remove('show');
  $('upgradeModal').classList.add('on');
}

// ‚îÄ‚îÄ INIT')?.classList.remove('show');
  $('upgradeModal').classList.add('on');
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ ‚îÄ‚îÄ
document.addEventListener('DOMContent
document.addEventListener('DOMContentLoaded', () => {
 Loaded', () => {
  // Deb // Debounce resizeounce resize events
  events
  let resizeTimeout;
 let resizeTimeout;
  window  window.addEventListener('.addEventListener('resize', ()resize', () => {
    clear => {
    clearTimeout(resizeTimeoutTimeout(resizeTimeout);
    resizeTimeout = setTimeout);
    resizeTimeout(() => = setTimeout {
      if ((() => {
      if (typeof initRadar === 'typeof initRadarfunction') initRadar();
 === 'function') initRadar();
    }, 150);
  }, {    }, 150);
  }, { passive: passive: true });
  
  // Defer non-critical initialization
  setTimeout(() => {
    initRadar();
  }, 100);
  
  true });
  
  // Defer non-critical initialization
  setTimeout(() => {
    initRadar();
  }, 100);
  
  renderSp renderSpills();
  
  $('chatInputills();
  
  $('').addchatInput').addEventListener('EventListener('keydown', ekeydown', e => { if ( => {e.key === 'Enter') if (e.key === ' sendMsgEnter') sendMsg(); });
  $('ws(); });
  $('wsThreadInput').addThreadInput').addEventListener('keydownEventListener('keydown', e => { if (', e => { if (e.keye.key === ' === 'Enter')Enter') sendWsReply(); });
  
 sendWsReply(); });
  
  window  window.addEventListener('beforeunload', () => {
    clearInterval(radarInterval.addEventListener('beforeunload', () => {
    clearInterval(radarInterval);
    clearInterval(timerInterval);
    if (radarRAF) cancelAnimationFrame(rad);
    clearInterval(timerInterval);
    if (radarRAF) cancelAnimationFrame(radarRAF);
 arRAF);
  });
  
 });
  
  const ta =  const $('vtText ta = $('vtText');
');
  if (ta)  if ( {
   ta) ta.addEventListener('input {
    ta.addEventListener('input', ()', () => {
      $('vt => {
      $('vtSendBtn').disabledSendBtn').disabled = ta.value.trim = ta.value.trim().length === ().length === 0;
0;
    });
    });
  }
  
   }
  
  updateV updateVtIndicator();
 tIndicator updateWsBadge();
  updateWsBadge();
  
();
  
  // Demo VT  // Demo VT after  after 8s
  setTimeout(() => {
    if (!VT.inbox.length) {
      VT.addToIn8s
  setTimeout(() => {
    if (!VT.inbox.length) {
      VT.addToInbox('gue ga tau siapa lo tapi gue harap lo baik-baik aja malam ini',box('gue ga tau siapa lo tapi gue harap lo baik-baik aja malam ini', 'seseorang');
    }
 'seseorang');
    }
  }, 8000);
  }, 8000);
});
</});
</script>
</body>
</html>
script>
</body>
</html>
