<!DOCTYPE html>
<html lang="id" data-theme="glitch">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NOPE ‚Äî JURNAL | Emotional Dumping Ground</title>
  
  <!-- PWA -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2300FF88'/%3E%3Ctext x='50' y='70' font-size='60' font-weight='bold' font-family='Space Grotesk' text-anchor='middle' fill='%23000'%3ENO%3C/text%3E%3C/svg%3E">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- Fonts: Space Grotesk untuk brutal heading, Inter untuk body -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'nope-black': '#0A0A0A',
            'nope-surface': '#151A21',
            'nope-green': '#00FF88',
            'nope-green-glow': 'rgba(0, 255, 136, 0.3)',
            'nope-electric': '#40E0FF',
            'nope-fire': '#FF6A3D',
            'nope-gray': '#8A8A8A',
            'nope-dark-gray': '#222222'
          },
          fontFamily: {
            'space': ['Space Grotesk', 'sans-serif'],
            'inter': ['Inter', 'sans-serif']
          },
          animation: {
            'glitch': 'glitch 1s linear infinite',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
          }
        }
      }
    }
  </script>
  
  <style>
    :root {
      --bg: #0A0A0A;
      --surface: #151A21;
      --border: #222222;
      --text: #E9EEF5;
      --muted: #8A8A8A;
      --accent: #00FF88;
      --accent-glow: rgba(0, 255, 136, 0.4);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-weight: 400;
      font-size: 15px;
      line-height: 1.6;
      padding-bottom: 100px;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Brutalist Typography */
    .brutal-heading {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: -0.02em;
    }
    
    .brutal-shadow {
      box-shadow: 4px 4px 0px #00FF88;
    }
    
    .brutal-shadow-sm {
      box-shadow: 2px 2px 0px #00FF88;
    }
    
    /* Noise overlay */
    .noise-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.02;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }
    
    /* Juicy interactions */
    .juicy-btn {
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }
    
    .juicy-btn:hover {
      transform: scale(1.02) translateY(-1px);
      box-shadow: 0 8px 30px var(--accent-glow);
    }
    
    .juicy-btn:active {
      transform: scale(0.98);
    }
    
    .juicy-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .juicy-btn:active::after {
      width: 300px;
      height: 300px;
    }
    
    /* Glow borders */
    .glow-hover {
      transition: all 0.3s ease;
    }
    
    .glow-hover:hover {
      border-color: var(--accent);
      box-shadow: 0 0 20px var(--accent-glow);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: var(--bg);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 3px;
    }
    
    /* Glitch effect for special elements */
    @keyframes glitch {
      0%, 100% { transform: translate(0); }
      33% { transform: translate(-2px, 2px); }
      66% { transform: translate(2px, -2px); }
    }
    
    .glitch-text:hover {
      animation: glitch 0.3s linear infinite;
    }
    
    /* Marquee for live feeling */
    .marquee-container {
      overflow: hidden;
      white-space: nowrap;
    }
    .marquee-content {
      display: inline-block;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    
    /* Skew cards for energy */
    .skew-card {
      transform: skew(-1deg);
    }
    .skew-content {
      transform: skew(1deg);
    }
    
    /* Pulse animation for uploads */
    .pulse-ring {
      position: absolute;
      border-radius: 50%;
      animation: pulse-ring 1.4s cubic-bezier(0.2, 0.8, 0.4, 1) infinite;
    }
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 0.8; }
      100% { transform: scale(2); opacity: 0; }
    }
    
    /* Emotional intensity indicator */
    .intensity-bar {
      background: linear-gradient(90deg, #00FF88 0%, #40E0FF 50%, #FF6A3D 100%);
      height: 3px;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <div class="noise-bg"></div>

  <!-- Sticky Header: Brutalist & Bold -->
  <header class="fixed top-0 w-full bg-nope-black/95 backdrop-blur-md border-b border-nope-dark-gray z-50">
    <div class="max-w-lg mx-auto px-4 h-16 flex justify-between items-center">
      <!-- Logo: Skewed, bold, with brutal shadow -->
      <div class="flex items-center gap-3">
        <h1 class="brutal-heading text-3xl text-white transform -skew-x-6 cursor-pointer hover:text-nope-green transition-colors" 
            onclick="window.location.href='index.html'"
            style="text-shadow: 3px 3px 0px #00FF88;">
          NOPE
        </h1>
        <span class="bg-nope-green text-black text-[10px] font-bold px-2 py-0.5 rounded transform skew-x-6 font-space">
          JURNAL
        </span>
      </div>
      
      <!-- Navigation: Minimal, high contrast -->
      <div class="flex items-center gap-1">
        <button class="juicy-btn bg-nope-surface border border-nope-dark-gray text-nope-gray hover:text-white hover:border-nope-green px-3 py-1.5 rounded-lg text-xs font-semibold transition-all">
          ‚ö° Zones
        </button>
        <button class="juicy-btn bg-nope-green text-black px-3 py-1.5 rounded-lg text-xs font-bold transform hover:scale-105">
          üíæ Save
        </button>
      </div>
    </div>
    
    <!-- Live indicator marquee -->
    <div class="bg-nope-green/5 border-b border-nope-green/20 py-1 overflow-hidden">
      <div class="marquee-container">
        <div class="marquee-content font-mono text-[10px] text-nope-green">
          üî• 47 ORANG LAGI NYAMBAT ‚Ä¢ ‚ö° STREAK HARI INI: 5 ‚Ä¢ üéØ EMOSI TERBANYAK: CEMBURU ‚Ä¢ üí¨ 128 PESAN BARU ‚Ä¢ üî• 47 ORANG LAGI NYAMBAT ‚Ä¢ ‚ö° STREAK HARI INI: 5 ‚Ä¢ üéØ EMOSI TERBANYAK: CEMBURU ‚Ä¢ üí¨ 128 PESAN BARU
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-lg mx-auto px-4 pt-28 pb-24 space-y-6">
    
    <!-- Hero Artefak: Large, immersive, with notation overlay -->
    <div class="relative w-full aspect-[4/5] bg-nope-surface rounded-2xl overflow-hidden border border-nope-dark-gray group glow-hover">
      <img id="hero-img" src="https://picsum.photos/seed/nope-hero/800/1000" 
           class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
           alt="artefak">
      
      <!-- Notation: Brutalist typography -->
      <div class="absolute top-4 left-4 right-4">
        <div id="hero-notation-display" 
             class="brutal-heading text-2xl md:text-3xl text-white leading-tight break-words"
             style="text-shadow: 2px 2px 0px #000, -1px -1px 0 #00FF88;">
        </div>
      </div>
      
      <!-- Upload button: Floating, juicy -->
      <button id="upload-artefak-btn" 
              class="absolute bottom-4 right-4 juicy-btn bg-nope-green text-black font-bold px-4 py-2 rounded-lg text-sm border-2 border-black brutal-shadow-sm flex items-center gap-2 z-10">
        <span>üì§</span> Unggah
      </button>
      
      <!-- Decorative corner accents -->
      <div class="absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-nope-green"></div>
      <div class="absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-nope-green"></div>
      <div class="absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-nope-green"></div>
      <div class="absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-nope-green"></div>
    </div>

    <!-- Post-upload panel: Hidden by default, slides in -->
    <div id="post-upload-panel" class="hidden bg-nope-surface border-2 border-nope-green rounded-xl p-4 brutal-shadow-sm">
      <div class="flex items-center gap-2 mb-3">
        <div class="w-2 h-2 bg-nope-green rounded-full animate-pulse"></div>
        <span class="text-xs font-mono text-nope-green">TAMBAHKAN NOTASI (MAKS 4 KATA)</span>
      </div>
      <div class="flex gap-2">
        <input id="hero-notation" type="text" 
               class="flex-1 bg-black/50 border border-nope-dark-gray rounded-lg px-4 py-3 text-white placeholder-nope-gray focus:outline-none focus:border-nope-green font-space text-lg"
               placeholder="contoh: 'capek banget hari ini'"
               maxlength="50">
        <button id="save-notation-btn" 
                class="juicy-btn bg-nope-green text-black font-bold px-6 py-3 rounded-lg whitespace-nowrap">
          Simpan
        </button>
      </div>
      <div class="mt-2 flex gap-2 text-xs">
        <span class="text-nope-gray">Saran:</span>
        <button class="text-nope-green hover:underline" onclick="setNotation('gak tau lagi')">gak tau lagi</button>
        <button class="text-nope-green hover:underline" onclick="setNotation('biasa aja')">biasa aja</button>
        <button class="text-nope-green hover:underline" onclick="setNotation('pengen sendiri')">pengen sendiri</button>
      </div>
    </div>

    <!-- Rant Box: Emotional dumping ground -->
    <div class="bg-nope-surface border border-nope-dark-gray rounded-2xl p-5 relative overflow-hidden glow-hover">
      <!-- Header with user info -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-gradient-to-br from-nope-green to-nope-electric rounded-full flex items-center justify-center text-lg brutal-shadow-sm">
            üë§
          </div>
          <div>
            <div class="font-bold text-white text-sm">@<span id="username-display">newglitch</span></div>
            <div class="text-[10px] text-nope-green font-mono">‚óè ONLINE NOW</div>
          </div>
        </div>
        <div class="text-[10px] text-nope-gray font-mono bg-black/30 px-2 py-1 rounded">
          <span id="char-count">0</span>/300
        </div>
      </div>
      
      <!-- Textarea: Dark, immersive -->
      <textarea id="rant" 
                class="w-full bg-transparent border-none text-white placeholder-nope-gray resize-none min-h-[120px] focus:outline-none text-base leading-relaxed"
                placeholder="marah? sedih? cape? tulis aja. gak usah bener. gak usah rapi. ini tempat sampah emosimu."
                maxlength="300"></textarea>
      
      <!-- Emotional intensity bar (visual feedback) -->
      <div class="mt-4 mb-3">
        <div class="flex justify-between text-[10px] text-nope-gray mb-1 font-mono">
          <span>INTENSITAS EMOSI</span>
          <span id="intensity-label">NETRAL</span>
        </div>
        <div class="h-1 bg-nope-dark-gray rounded-full overflow-hidden">
          <div id="intensity-bar" class="h-full w-0 bg-nope-green transition-all duration-300"></div>
        </div>
      </div>
      
      <!-- Action bar -->
      <div class="flex justify-between items-center pt-3 border-t border-nope-dark-gray">
        <div class="flex gap-2">
          <button class="text-xl hover:scale-110 transition-transform" title="Tambah emoji">üò§</button>
          <button class="text-xl hover:scale-110 transition-transform" title="Tambah emoji">üò¢</button>
          <button class="text-xl hover:scale-110 transition-transform" title="Tambah emoji">üò¥</button>
        </div>
        <button id="jejakkan-btn" 
                class="juicy-btn bg-nope-green text-black font-bold px-6 py-2 rounded-lg text-sm brutal-shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">
          Unggah ‚Üí
        </button>
      </div>
      
      <!-- Confirmation toast -->
      <div id="confirmation" class="absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-nope-green text-black px-4 py-2 rounded-lg font-bold text-sm opacity-0 transition-opacity pointer-events-none">
        Tersimpan!
      </div>
    </div>

    <!-- Diary Entries: Timeline style -->
    <div class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="brutal-heading text-lg text-white flex items-center gap-2">
          <span class="text-nope-green">üìì</span> JEJAK
        </h2>
        <button class="text-xs text-nope-gray hover:text-nope-green transition-colors font-mono">
          [LIHAT SEMUA]
        </button>
      </div>
      
      <div id="diary" class="space-y-3">
        <!-- Entries will be injected here -->
      </div>
    </div>

    <!-- Artefak Tray: Grid of memories -->
    <div class="space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="brutal-heading text-lg text-white flex items-center gap-2">
          <span class="text-nope-electric">üéûÔ∏è</span> ARTEFAK
        </h2>
        <div class="flex gap-1">
          <button class="w-6 h-6 rounded bg-nope-green text-black text-xs flex items-center justify-center font-bold">6</button>
          <span class="text-xs text-nope-gray self-center">total</span>
        </div>
      </div>
      
      <div id="tray" class="grid grid-cols-3 gap-3">
        <!-- Grid items injected here -->
      </div>
    </div>

    <!-- Footer mantra -->
    <div class="text-center pt-8 pb-4">
      <div class="inline-block border border-nope-dark-gray rounded-full px-6 py-2">
        <span class="text-xs text-nope-gray font-mono tracking-widest">NYAMBAT ‚Ä¢ AKSI ‚Ä¢ SOLUSI</span>
      </div>
    </div>
  </main>

  <!-- Floating Action Button (mobile optimized) -->
  <button class="fixed bottom-6 right-6 w-14 h-14 bg-nope-green text-black rounded-full brutal-shadow flex items-center justify-center text-2xl juicy-btn z-40 md:hidden">
    +
  </button>

  <!-- Hidden file input -->
  <input type="file" id="file-input" accept="image/*" style="display:none;">

  <script>
    // Configuration
    const SUPABASE_URL = 'https://fuovfrdicdhnlymnacpz.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1b3ZmcmRpY2Robmx5bW5hY3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMjYxMzEsImV4cCI6MjA4MjYwMjEzMX0.oX4fVTEIWiRG2NaNJJKOV8dTnSHWhicLVMIFzZUl1o0';
    
    let currentUser = localStorage.getItem('nope_username') || '@newglitch';
    let artefacts = [];
    let rants = [];
    
    // Dummy data dengan vibe yang lebih Gen Z
    const DUMMY_RANTS = [
      {
        id: 'dummy-0', 
        username: 'homie1',
        content: "gue udah bantuin dia tiap malem pas dia galau sampe gue lupa ngerjain tugas sendiri. pas gue butuh temen buat ngobrol, dia malah offline terus. gak minta balasan sih, tapi rasanya kayak jadi tempat sampah emosi doang. capek jadi 'temen baik' yang cuma dipake pas dia perlu aja.",
        created_at: new Date(Date.now() - 86400000 * 2).toISOString(),
        reactions: { 'ü§†': 3, 'üò¢': 12, 'ü§ó': 2, 'üî•': 5 }
      },
      {
        id: 'dummy-1', 
        username: 'homie2',
        content: "deadline mepet, dosen gak jelas, dompet kering. rasanya pengen ijin cuti sehari buat jadi batu aja. gak perlu mikir, gak perlu ngomong, gak perlu diharapkan apa-apa.",
        created_at: new Date(Date.now() - 86400000).toISOString(),
        reactions: { 'ü§†': 1, 'üò¢': 8, 'ü§ó': 5, 'üî•': 2 }
      },
      {
        id: 'dummy-2', 
        username: 'homie3',
        content: "capek.",
        created_at: new Date(Date.now() - 43200000).toISOString(),
        reactions: { 'ü§†': 0, 'üò¢': 15, 'ü§ó': 3, 'üî•': 1 }
      }
    ];
    
    const DUMMY_ARTEFACTS = [
      { id:'dummy-0', image_url:'https://picsum.photos/seed/nope1/400/500', notation: 'kadang hidup abu abu' },
      { id:'dummy-1', image_url:'https://picsum.photos/seed/nope2/400/500', notation:'gebetan temen lebih hijau' },
      { id:'dummy-2', image_url:'https://picsum.photos/seed/nope3/400/500', notation:'gabut NO FACE' },
      { id:'dummy-3', image_url:'https://picsum.photos/seed/nope4/400/500', notation:'lonelyness my hiding place' },
      { id:'dummy-4', image_url:'https://picsum.photos/seed/nope5/400/500', notation:'capek' },
      { id:'dummy-5', image_url:'https://picsum.photos/seed/nope6/400/500', notation:'love it' }
    ];
    
    // Helper functions
    function $(id) { return document.getElementById(id); }
    
    function showConfirmation(msg) {
      const el = $('confirmation');
      el.textContent = msg;
      el.style.opacity = '1';
      setTimeout(() => el.style.opacity = '0', 2000);
    }
    
    function setNotation(text) {
      $('hero-notation').value = text;
      $('hero-notation').focus();
    }
    
    // Emotional intensity calculator
    function updateIntensity(text) {
      const intensity = Math.min(text.length / 300 * 100, 100);
      $('intensity-bar').style.width = intensity + '%';
      $('char-count').textContent = text.length;
      
      const label = $('intensity-label');
      if (intensity < 20) {
        label.textContent = 'NETRAL';
        label.style.color = '#8A8A8A';
        $('intensity-bar').className = 'h-full transition-all duration-300 bg-nope-gray';
      } else if (intensity < 50) {
        label.textContent = 'GANGGUAN';
        label.style.color = '#40E0FF';
        $('intensity-bar').className = 'h-full transition-all duration-300 bg-nope-electric';
      } else if (intensity < 80) {
        label.textContent = 'CHAOS';
        label.style.color = '#00FF88';
        $('intensity-bar').className = 'h-full transition-all duration-300 bg-nope-green';
      } else {
        label.textContent = 'BURNING';
        label.style.color = '#FF6A3D';
        $('intensity-bar').className = 'h-full transition-all duration-300 bg-nope-fire';
      }
    }
    
    // Render functions
    function renderHero() {
      const current = artefacts.length > 0 ? artefacts[0] : DUMMY_ARTEFACTS[0];
      if (current) {
        $('hero-img').src = current.image_url;
        $('hero-notation-display').textContent = current.notation || '';
        
        if (artefacts.length > 0 && !current.notation) {
          $('post-upload-panel').classList.remove('hidden');
        } else {
          $('post-upload-panel').classList.add('hidden');
        }
      }
    }
    
    function renderDiary() {
      const container = $('diary');
      container.innerHTML = '';
      const list = rants.length > 0 ? rants : DUMMY_RANTS;
      
      list.forEach((r, index) => {
        const entry = document.createElement('div');
        entry.className = 'bg-nope-surface border border-nope-dark-gray rounded-xl p-4 skew-card glow-hover transition-all duration-300';
        entry.style.animationDelay = (index * 0.1) + 's';
        
        const date = new Date(r.created_at).toLocaleDateString('id-ID', { day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' });
        const isDummy = String(r.id).indexOf('dummy-') === 0;
        
        entry.innerHTML = `
          <div class="skew-content">
            <div class="flex justify-between items-start mb-2">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-nope-green to-nope-electric flex items-center justify-center text-[10px]">
                  ${r.username.charAt(0).toUpperCase()}
                </div>
                <span class="font-bold text-sm text-white">@${r.username}</span>
                ${!isDummy ? '<span class="text-[10px] bg-nope-green/20 text-nope-green px-1.5 py-0.5 rounded">KAMU</span>' : ''}
              </div>
              <time class="text-[10px] text-nope-gray font-mono">${date}</time>
            </div>
            <p class="text-sm text-gray-200 leading-relaxed mb-3">${r.content}</p>
            ${!isDummy ? `
              <div class="flex gap-3 pt-2 border-t border-nope-dark-gray">
                ${Object.entries(r.reactions || {'ü§†':0,'üò¢':0,'ü§ó':0,'üî•':0}).map(([emoji, count]) => `
                  <button class="flex items-center gap-1 text-xs text-nope-gray hover:text-nope-green transition-colors group">
                    <span class="text-lg group-hover:scale-125 transition-transform">${emoji}</span>
                    <span class="font-mono">${count}</span>
                  </button>
                `).join('')}
              </div>
            ` : `
              <div class="flex gap-3 pt-2 border-t border-nope-dark-gray opacity-50">
                <span class="text-xs text-nope-gray">üëÅÔ∏è ${Math.floor(Math.random() * 50) + 10} views</span>
              </div>
            `}
          </div>
        `;
        container.appendChild(entry);
      });
    }
    
    function renderTray() {
      const tray = $('tray');
      tray.innerHTML = '';
      
      let displayList = [];
      if (artefacts.length > 0) {
        displayList = artefacts.slice(0, 6);
        const remaining = 6 - displayList.length;
        for (let i = artefacts.length; i < 6 && displayList.length < 6; i++) {
          if (DUMMY_ARTEFACTS[i]) displayList.push(DUMMY_ARTEFACTS[i]);
        }
      } else {
        displayList = DUMMY_ARTEFACTS.slice(0, 6);
      }
      
      displayList.forEach((a, index) => {
        const div = document.createElement('div');
        div.className = 'aspect-square bg-nope-surface border border-nope-dark-gray rounded-lg overflow-hidden cursor-pointer relative group glow-hover transition-all duration-300';
        div.style.animation = `fadeIn 0.5s ease-out ${index * 0.1}s both`;
        
        const isDummy = String(a.id).indexOf('dummy-') === 0;
        if (isDummy) div.style.opacity = '0.8';
        
        if (a.image_url) {
          div.style.backgroundImage = `url(${a.image_url})`;
          div.style.backgroundSize = 'cover';
          div.style.backgroundPosition = 'center';
        }
        
        if (a.notation) {
          div.innerHTML = `
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-2">
              <span class="text-[10px] text-white font-bold leading-tight">${a.notation}</span>
            </div>
          `;
        }
        
        div.onclick = () => {
          $('hero-img').src = a.image_url;
          $('hero-notation-display').textContent = a.notation || '';
          $('post-upload-panel').classList.add('hidden');
        };
        
        tray.appendChild(div);
      });
    }
    
    // Event listeners
    $('rant').addEventListener('input', (e) => updateIntensity(e.target.value));
    
    $('upload-artefak-btn').addEventListener('click', () => $('file-input').click());
    
    $('file-input').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showConfirmation('Hanya gambar!');
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        showConfirmation('Maks 5MB!');
        return;
      }
      
      // Simulate upload with visual feedback
      showConfirmation('Mengunggah...');
      setTimeout(() => {
        // Add to local array for demo
        const newArtefact = {
          id: 'new-' + Date.now(),
          image_url: URL.createObjectURL(file),
          notation: ''
        };
        artefacts.unshift(newArtefact);
        renderHero();
        renderTray();
        showConfirmation('Artefak ditambahkan!');
        $('post-upload-panel').classList.remove('hidden');
      }, 1000);
    });
    
    $('save-notation-btn').addEventListener('click', () => {
      const notation = $('hero-notation').value.trim();
      if (!notation) {
        showConfirmation('Tulis dulu!');
        return;
      }
      
      const words = notation.split(/\s+/).filter(w => w.length > 0);
      if (words.length > 4) {
        showConfirmation('Maks 4 kata!');
        return;
      }
      
      if (artefacts.length > 0) {
        artefacts[0].notation = notation;
        renderHero();
        showConfirmation('Notasi tersimpan!');
      }
    });
    
    $('jejakkan-btn').addEventListener('click', () => {
      const content = $('rant').value.trim();
      if (!content) {
        showConfirmation('Tulis dulu!');
        return;
      }
      
      const newRant = {
        id: 'new-' + Date.now(),
        username: currentUser.replace('@', ''),
        content: content,
        created_at: new Date().toISOString(),
        reactions: {'ü§†':0,'üò¢':0,'ü§ó':0,'üî•':0}
      };
      
      rants.unshift(newRant);
      $('rant').value = '';
      updateIntensity('');
      renderDiary();
      showConfirmation('Terkirim!');
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      $('username-display').textContent = currentUser.replace('@', '');
      renderHero();
      renderDiary();
      renderTray();
    });
  </script>
</body>
</html>
