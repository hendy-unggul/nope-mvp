<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>JEJAK ‚Äî Spill Your Truth</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0A0A0A;
  --sf:#141414;
  --sfe:#1E1E1E;
  --bd:#2A2A2A;
  --tx:#FFF;
  --txs:#888;
  --txm:#555;
  --ap:#FF4D00;
  --as:#00F0FF;
  --at:#FF006E;
  --aq:#39FF14;
  --ms:#FF9500;
  --mt:#39FF14;
  --mc:#00F0FF;
  --md:#8B5CF6;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg);
  color:var(--tx);
  font-family:'Plus Jakarta Sans',sans-serif;
  font-weight:500;
  font-size:15px;
  min-height:100vh;
  padding-bottom:100px
}
.w{
  max-width:480px;
  margin:0 auto;
  padding:0 16px
}
header{
  padding:24px 0 16px;
  display:flex;
  justify-content:space-between;
  align-items:flex-start
}
.logo{
  font-size:42px;
  font-weight:800;
  letter-spacing:-.04em;
  cursor:pointer;
  line-height:.9;
  color:var(--ap)
}
.tagline{
  font-family:'Instrument Serif',serif;
  font-size:13px;
  color:var(--txs);
  font-style:italic;
  margin-top:4px
}
.huser{
  font-size:11px;
  font-weight:700;
  color:var(--tx);
  background:var(--sf);
  border:1px solid var(--bd);
  padding:4px 8px;
  border-radius:4px;
}
.dot{
  width:8px;
  height:8px;
  background:var(--aq);
  border-radius:50%;
  animation:blink 2s infinite;
}
.dot.off{
  background:var(--at);
  animation:none;
}
@keyframes blink{
  0%,100%{opacity:1}
  50%{opacity:.3}
}
.top-right{
  display:flex;
  align-items:center;
  gap:8px;
}
.hero-s{
  margin:0 -16px 24px
}
.hero{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  overflow:hidden;
  border-top:2px solid var(--bd);
  border-bottom:2px solid var(--bd);
  background:var(--sf)
}
.hero img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.hnote{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  padding:16px;
  background:linear-gradient(to top,rgba(0,0,0,.9),transparent);
  font-family:'Instrument Serif',serif;
  font-size:24px;
  font-style:italic;
  color:var(--tx);
}
.upctrls{
  position:absolute;
  top:16px;
  right:16px;
  z-index:20
}
.upbtn{
  width:48px;
  height:48px;
  background:var(--ap);
  border:none;
  color:var(--bg);
  font-size:24px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:4px 4px 0 var(--bg);
  border-radius:8px;
}
.upbtn:disabled{
  background:var(--txm);
  cursor:not-allowed;
}
.upcnt{
  position:absolute;
  top:-8px;
  right:-8px;
  background:var(--at);
  color:var(--tx);
  font-size:10px;
  font-weight:700;
  padding:2px 6px;
  min-width:20px;
  text-align:center;
  border-radius:10px;
}
.qtimer{
  position:absolute;
  top:calc(100% + 8px);
  right:0;
  background:var(--sf);
  border:2px solid var(--bd);
  padding:8px 16px;
  font-size:11px;
  color:var(--txs);
  white-space:nowrap;
  border-radius:4px;
}
.ri{
  width:100%;
  background:var(--sf);
  border:2px solid var(--bd);
  padding:16px;
  color:var(--tx);
  font-family:'Plus Jakarta Sans',sans-serif;
  font-size:16px;
  resize:none;
  min-height:120px;
  border-radius:8px;
}
.ri:focus{
  outline:none;
  border-color:var(--ap);
}
.ri::placeholder{
  color:var(--txm);
}
.mgrid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  margin:16px 0
}
.mc{
  padding:16px;
  background:var(--sf);
  border:2px solid var(--bd);
  cursor:pointer;
  text-align:center;
  border-radius:8px;
  transition:all .2s;
}
.mc:hover{
  border-color:var(--txs);
  transform:translateY(-2px);
}
.mc.act{
  border-color:var(--ap);
  background:var(--sfe);
}
.mc[data-mood="surviving"]{color:var(--ms)}
.mc[data-mood="thriving"]{color:var(--mt)}
.mc[data-mood="chaotic"]{color:var(--mc)}
.mc[data-mood="doom"]{color:var(--md)}
.sbtn{
  padding:14px 32px;
  font-size:14px;
  font-weight:700;
  text-transform:uppercase;
  background:var(--ap);
  border:none;
  color:var(--bg);
  cursor:pointer;
  box-shadow:4px 4px 0 var(--sfe);
  width:100%;
  border-radius:8px;
  transition:all .2s;
}
.sbtn:hover:not(:disabled){
  transform:translate(2px,2px);
  box-shadow:2px 2px 0 var(--sfe);
}
.sbtn:disabled{
  opacity:.5;
  cursor:not-allowed;
}
.tgrid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:2px;
  background:var(--bd);
  border:2px solid var(--bd);
  margin:16px 0;
  border-radius:8px;
  overflow:hidden;
}
.ti{
  aspect-ratio:1;
  background:var(--sf);
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition:all .3s;
}
.ti:hover img{
  transform:scale(1.1);
}
.ti.empty{
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--txm);
  font-size:20px;
  border:2px dashed var(--bd);
  background:var(--sfe);
}
.ti img{
  width:100%;
  height:100%;
  object-fit:cover;
  transition:transform .3s;
}
.entry{
  background:var(--sf);
  border:2px solid var(--bd);
  margin-bottom:16px;
  border-radius:8px;
  overflow:hidden;
  transition:all .2s;
}
.entry:hover{
  border-color:var(--ap);
}
.ehdr{
  display:flex;
  justify-content:space-between;
  padding:8px 16px;
  border-bottom:1px solid var(--bd);
  background:var(--sfe);
  font-size:12px;
}
.econt{
  padding:16px;
  line-height:1.6;
}
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:10001;
  padding:16px;
  overflow-y:auto
}
.modal.on{
  display:block
}
.mc2{
  max-width:480px;
  margin:0 auto;
  background:var(--sf);
  border:2px solid var(--bd);
  padding:24px;
  border-radius:12px;
}
.ggrid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-bottom:16px
}
.gi{
  aspect-ratio:1;
  background:var(--sfe);
  border:2px solid var(--bd);
  cursor:pointer;
  overflow:hidden;
  border-radius:4px;
}
.gi img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.gi.sel{
  border-color:var(--ap);
  box-shadow:0 0 0 2px var(--ap)
}
.gi.sel::after{
  content:'‚úì';
  position:absolute;
  top:4px;
  right:4px;
  background:var(--ap);
  color:var(--bg);
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  font-weight:bold;
}
.noti{
  width:100%;
  background:var(--sf);
  border:2px solid var(--bd);
  padding:12px;
  color:var(--tx);
  font-size:14px;
  margin:16px 0;
  border-radius:8px;
}
.noti:focus{
  outline:none;
  border-color:var(--ap);
}
.toast{
  position:fixed;
  bottom:80px;
  left:50%;
  transform:translateX(-50%) translateY(100px);
  background:var(--tx);
  color:var(--bg);
  padding:12px 24px;
  font-size:14px;
  font-weight:600;
  z-index:10000;
  border-radius:30px;
  transition:all .3s;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0)
}
.proc{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:10002;
  display:none;
  place-items:center;
}
.proc.on{
  display:grid
}
.pspin{
  width:48px;
  height:48px;
  border:3px solid var(--bd);
  border-top-color:var(--ap);
  border-radius:50%;
  animation:sp 1s linear infinite
}
@keyframes sp{
  to{transform:rotate(360deg)}
}
.ptxt{
  margin-top:16px;
  color:var(--txs);
}
.bnav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:var(--sf);
  border-top:2px solid var(--bd);
  z-index:1000;
}
.bnav-c{
  max-width:480px;
  margin:0 auto;
  display:flex;
  justify-content:space-around;
  padding:12px 0;
}
.ni{
  color:var(--txm);
  text-decoration:none;
  font-size:12px;
  font-weight:700;
  text-transform:uppercase;
  transition:color .2s;
}
.ni:hover{
  color:var(--txs);
}
.ni.act{
  color:var(--ap)
}
.es{
  padding:32px 16px;
  text-align:center;
  border:2px dashed var(--bd);
  border-radius:8px;
  color:var(--txm);
}
.ee{
  font-size:48px;
  margin-bottom:16px;
  display:block;
}
.footer{
  padding:32px 0;
  text-align:center;
  color:var(--txm);
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.2em;
}
</style>
</head>
<body>
<div class="w">
<header>
  <div>
    <div class="logo">JEJAK</div>
    <div class="tagline">no filter, just truth</div>
  </div>
  <div class="top-right">
    <div class="huser" id="huser">@anon</div>
    <div class="dot" id="dot"></div>
  </div>
</header>

<!-- HERO SECTION -->
<section class="hero-s">
  <div class="hero" id="hero">
    <img id="himg" src="https://images.unsplash.com/photo-1517842645767-c639042777db?w=400&q=80" alt="hero">
    <div class="hnote" id="hnote">"jeda"</div>
    <div class="upctrls">
      <div class="qtimer" id="qtimer">Window aktif</div>
      <button class="upbtn" id="upbtn">+<span class="upcnt" id="ucnt">0</span></button>
    </div>
  </div>
</section>

<!-- INPUT SECTION -->
<section>
  <textarea class="ri" id="ri" placeholder="What's eating you alive right now? No cap, no filter..." maxlength="500"></textarea>
  
  <div class="mgrid">
    <div class="mc act" data-mood="surviving" onclick="window.selMood('surviving')">üòÆ‚Äçüí® Surviving</div>
    <div class="mc" data-mood="thriving" onclick="window.selMood('thriving')">‚ú® Thriving</div>
    <div class="mc" data-mood="chaotic" onclick="window.selMood('chaotic')">üåÄ Chaotic</div>
    <div class="mc" data-mood="doom" onclick="window.selMood('doom')">üõå Doom</div>
  </div>
  
  <button class="sbtn" id="sbtn">JEJAKKAN & SPILL</button>
</section>

<!-- MEMORI SECTION -->
<section style="margin-top:32px">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
    <h3 style="color:var(--txs);">MEMORI</h3>
    <span style="font-size:10px; color:var(--txm);">FIFO ‚Ä¢ MAX 6</span>
  </div>
  <div class="tgrid" id="tgrid"></div>
</section>

<!-- RIWAYAT SECTION -->
<section style="margin-top:32px">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
    <h3 style="color:var(--txs);">RIWAYAT</h3>
    <span style="font-size:10px; color:var(--txm);">FIFO ‚Ä¢ MAX 10</span>
  </div>
  <div id="econ"></div>
</section>

<footer class="footer">
  <p>Nyambat ‚Ä¢ Aksi ‚Ä¢ Solusi</p>
</footer>
</div>

<!-- BOTTOM NAVIGATION -->
<nav class="bnav">
  <div class="bnav-c">
    <a href="#" class="ni act">Jejak</a>
    <a href="#" class="ni">Spill</a>
    <a href="#" class="ni">Cocomeo</a>
  </div>
</nav>

<!-- MODAL UPLOAD -->
<div class="modal" id="gmodal">
  <div class="mc2">
    <h3 style="margin-bottom:16px; color:var(--ap);">Upload Artefak</h3>
    <div class="gwarn" style="background:var(--at); color:var(--tx); padding:12px; margin-bottom:16px; border-radius:8px; text-align:center; font-weight:bold;">
      DILARANG UPLOAD FOTO WAJAH!
    </div>
    <div class="ggrid" id="ggrid"></div>
    <input type="text" class="noti" id="noti" placeholder="Notasi (opsional, max 4 kata)" maxlength="30">
    <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:16px;">
      <button class="sbtn" onclick="window.closeGallery()" style="background:var(--sf); color:var(--tx);">Batal</button>
      <button class="sbtn" onclick="window.confirmUpload()">Konfirmasi</button>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div class="proc" id="proc">
  <div class="pspin"></div>
  <div class="ptxt" id="proctxt">Processing...</div>
</div>

<!-- TOAST NOTIFICATION -->
<div class="toast" id="toast"></div>

<!-- HIDDEN FILE INPUT -->
<input type="file" id="finput" accept="image/*" multiple style="display:none">

<script>
// ============================================
// SUPABASE CONFIG
// ============================================
const SB_URL = 'https://fuovfrdicdhnlymnacpz.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1b3ZmcmRpY2Robmx5bW5hY3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMjYxMzEsImV4cCI6MjA4MjYwMjEzMX0.oX4fVTEIWiRG2NaNJJKOV8dTnSHWhicLVMIFzZUl1o0';

// PAKAI NAMA UNIK
const sb = supabase.createClient(SB_URL, SB_KEY);
const BUCKET = 'artefacts';

// ============================================
// STATE
// ============================================
const USER_ID = 'user-' + Date.now();
const USERNAME = '@anon';

// Simpan ke localStorage
if (!localStorage.getItem('jejak_username')) {
    localStorage.setItem('jejak_username', USERNAME);
}

// Upload quota
let uploads = parseInt(localStorage.getItem('jejak_uploads') || '0');
let quotaStart = localStorage.getItem('jejak_quota_start') || Date.now();

// Data arrays
let myEntries = [];
let myArtefacts = [];

// Upload temp
let pendingFiles = [];
let selectedIndexes = new Set();

// ============================================
// HELPER FUNCTIONS
// ============================================
function $(id) {
    return document.getElementById(id);
}

function showToast(msg, isError = false) {
    const t = $('toast');
    t.textContent = msg;
    t.style.background = isError ? '#FF006E' : '#FFF';
    t.style.color = isError ? '#FFF' : '#000';
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

function showLoading(text = 'Processing...') {
    $('proctxt').textContent = text;
    $('proc').classList.add('on');
}

function hideLoading() {
    $('proc').classList.remove('on');
}

function updateConnectionStatus(status) {
    const dot = $('dot');
    if (status === 'online') {
        dot.className = 'dot';
    } else {
        dot.className = 'dot off';
    }
}

// ============================================
// QUOTA MANAGEMENT
// ============================================
function updateQuota() {
    const now = Date.now();
    const windowDays = 3 * 86400000; // 3 hari
    
    // Reset quota jika sudah lewat 3 hari
    if (now - parseInt(quotaStart) > windowDays) {
        uploads = 0;
        quotaStart = now;
        localStorage.setItem('jejak_uploads', '0');
        localStorage.setItem('jejak_quota_start', now.toString());
    }
    
    const rem = Math.max(0, windowDays - (now - parseInt(quotaStart)));
    const days = Math.ceil(rem / 86400000);
    const slots = 6 - uploads;
    
    $('qtimer').innerHTML = `${slots} slot ‚Ä¢ ${days} hari`;
    $('ucnt').textContent = uploads;
}

// ============================================
// MOOD SELECTOR
// ============================================
window.selMood = function(mood) {
    document.querySelectorAll('.mc').forEach(c => 
        c.classList.toggle('act', c.dataset.mood === mood)
    );
};

// ============================================
// LOAD DATA FROM SUPABASE
// ============================================
async function loadRants() {
    try {
        const { data, error } = await sb
            .from('rants')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(10);
        
        if (error) {
            console.error('Load rants error:', error);
            return;
        }
        
        myEntries = data || [];
        renderEntries();
    } catch (e) {
        console.error('Load rants exception:', e);
    }
}

async function loadArtefacts() {
    try {
        // Ambil SEMUA artefak, tanpa filter user_id
        const { data, error } = await sb
            .from('artefacts')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(6);
        
        if (error) {
            console.error('Load artefacts error:', error);
            return;
        }
        
        myArtefacts = data || [];
        console.log('Artefacts loaded:', myArtefacts.length);
        renderTray();
    } catch (e) {
        console.error('Load artefacts exception:', e);
    }
}

// ============================================
// RENDER FUNCTIONS
// ============================================
function renderEntries() {
    const container = $('econ');
    if (!myEntries.length) {
        container.innerHTML = '<div class="es"><span class="ee">üçÉ</span><div>Belum ada jejak</div><div style="margin-top:8px; font-size:12px;">Jadilah yang pertama spill your truth</div></div>';
        return;
    }
    
    container.innerHTML = myEntries.map(e => `
        <div class="entry">
            <div class="ehdr">
                <span>@${e.username || 'anon'}</span>
                <span style="color:var(--txs);">${new Date(e.created_at).toLocaleDateString('id-ID', {day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'})}</span>
            </div>
            <div class="econt">${escapeHtml(e.content)}</div>
        </div>
    `).join('');
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function renderTray() {
    const container = $('tgrid');
    
    if (!myArtefacts.length) {
        // Tampilkan 6 placeholder
        let html = '';
        for (let i = 0; i < 6; i++) {
            html += '<div class="ti empty" onclick="document.getElementById(\'upbtn\').click()">+</div>';
        }
        container.innerHTML = html;
        return;
    }
    
    // Tampilkan artefak yang ada
    let html = myArtefacts.map(a => `
        <div class="ti" onclick="window.setHero('${a.id}')">
            <img src="${a.url}" alt="${a.note || 'memory'}">
        </div>
    `).join('');
    
    // Tambah placeholder jika kurang dari 6
    for (let i = myArtefacts.length; i < 6; i++) {
        html += '<div class="ti empty" onclick="document.getElementById(\'upbtn\').click()">+</div>';
    }
    
    container.innerHTML = html;
}

window.setHero = function(id) {
    const artefact = myArtefacts.find(a => a.id === id);
    if (artefact) {
        $('himg').src = artefact.url;
        $('hnote').innerHTML = `"${artefact.note || 'memory'}"`;
    }
};

// ============================================
// UPLOAD FUNCTIONS
// ============================================
$('upbtn').onclick = () => {
    if (uploads >= 6) {
        showToast('Quota habis (max 6 foto per 3 hari)');
        return;
    }
    $('finput').click();
};

$('finput').onchange = (e) => {
    const files = Array.from(e.target.files).slice(0, 6);
    if (!files.length) return;
    
    pendingFiles = files.map(f => ({
        file: f,
        preview: URL.createObjectURL(f)
    }));
    
    selectedIndexes = new Set(pendingFiles.map((_, i) => i));
    openGallery();
};

function openGallery() {
    const grid = $('ggrid');
    grid.innerHTML = '';
    
    pendingFiles.forEach((f, i) => {
        const div = document.createElement('div');
        div.className = 'gi sel';
        div.innerHTML = `<img src="${f.preview}">`;
        div.onclick = () => {
            if (selectedIndexes.has(i)) {
                selectedIndexes.delete(i);
                div.classList.remove('sel');
            } else {
                selectedIndexes.add(i);
                div.classList.add('sel');
            }
        };
        grid.appendChild(div);
    });
    
    $('gmodal').classList.add('on');
}

window.closeGallery = function() {
    $('gmodal').classList.remove('on');
    pendingFiles = [];
    selectedIndexes.clear();
    $('noti').value = '';
};

window.confirmUpload = async function() {
    if (!selectedIndexes.size) {
        showToast('Pilih minimal 1 foto');
        return;
    }
    
    closeGallery();
    showLoading('Uploading...');
    
    const note = $('noti').value.trim() || 'memory';
    const username = 'anon';
    let success = 0;
    
    for (const i of selectedIndexes) {
        const file = pendingFiles[i].file;
        const ext = file.name.split('.').pop() || 'jpg';
        const fileName = `${username}/${Date.now()}_${i}.${ext}`;
        
        try {
            // Upload ke storage
            const { error: uploadError } = await sb.storage
                .from(BUCKET)
                .upload(fileName, file);
            
            if (uploadError) throw uploadError;
            
            // Get public URL
            const { data: { publicUrl } } = sb.storage
                .from(BUCKET)
                .getPublicUrl(fileName);
            
            // Insert ke database
            const { error: insertError } = await sb
                .from('artefacts')
                .insert({
                    user_id: USER_ID,
                    username: username,
                    url: publicUrl,
                    note: note,
                    has_face: false,
                    faces: []
                });
            
            if (insertError) throw insertError;
            success++;
            
        } catch (err) {
            console.error('Upload error:', err);
            showToast(err.message, true);
        }
    }
    
    hideLoading();
    
    if (success > 0) {
        uploads += success;
        localStorage.setItem('jejak_uploads', uploads.toString());
        await loadArtefacts();
        if (myArtefacts.length) {
            window.setHero(myArtefacts[0].id);
        }
        showToast(`‚úì ${success} foto berhasil diupload!`);
    }
    
    updateQuota();
};

// ============================================
// SUBMIT RANTS
// ============================================
$('sbtn').onclick = async () => {
    const content = $('ri').value.trim();
    if (!content) {
        showToast('Tulis sesuatu...');
        return;
    }
    
    const mood = document.querySelector('.mc.act')?.dataset.mood || 'surviving';
    const btn = $('sbtn');
    
    btn.disabled = true;
    btn.textContent = 'Menyimpan...';
    
    try {
        const { error } = await sb
            .from('rants')
            .insert({
                user_id: USER_ID,
                username: 'anon',
                content: content,
                mood: mood,
                reaction_count: { skull: 0, cry: 0, fire: 0, upside: 0 }
            });
        
        if (error) throw error;
        
        $('ri').value = '';
        await loadRants();
        showToast('‚úì Tersimpan!');
        
    } catch (err) {
        console.error('Rant error:', err);
        showToast('‚úó Gagal: ' + err.message, true);
    } finally {
        btn.disabled = false;
        btn.textContent = 'JEJAKKAN & SPILL';
    }
};

// ============================================
// TEST CONNECTION
// ============================================
async function testConnection() {
    try {
        const { error } = await sb.from('rants').select('count').limit(1);
        if (error) {
            updateConnectionStatus('offline');
            console.log('Offline mode');
        } else {
            updateConnectionStatus('online');
            console.log('Online mode');
        }
    } catch {
        updateConnectionStatus('offline');
    }
}

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener('DOMContentLoaded', async () => {
    // Set username
    $('huser').textContent = USERNAME;
    
    // Test koneksi
    await testConnection();
    
    // Load data
    await loadRants();
    await loadArtefacts();
    
    // Set hero pertama jika ada
    if (myArtefacts.length) {
        window.setHero(myArtefacts[0].id);
    }
    
    // Update quota
    updateQuota();
    setInterval(updateQuota, 60000);
    
    // Character counter
    const ri = $('ri');
    ri.addEventListener('input', () => {
        // Bisa ditambah counter jika mau
    });
    
    console.log('JEJAK READY!');
});
</script>
</body>
</html>
