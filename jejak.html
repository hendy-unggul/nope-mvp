// === EMOJI COUNTER UNTUK JEJAK & ARTEFAK ===
    const EMOJI_LABELS = {
      'ðŸ¤ ': 'Aku ngerti banget',
      'ðŸ˜¢': 'Nangis bareng',
      'ðŸ¤—': 'Peluk virtual',
      'ðŸ”¥': 'Ini bikin kaget'
    };

    async function fetchReactionStats(rantId) {
      try {
        const data = await supabaseFetch('reactions', 'GET', null);
        const filtered = data.filter(r => r.rant_id === rantId);
        const stats = { 'ðŸ¤ ': { count: 0, users: [] }, 'ðŸ˜¢': { count: 0, users: [] }, 'ðŸ¤—': { count: 0, users: [] }, 'ðŸ”¥': { count: 0, users: [] } };
        filtered.forEach(row => {
          if (stats[row.emoji]) {
            stats[row.emoji].count++;
            if (stats[row.emoji].users.length < 3) {
              stats[row.emoji].users.push(row.user_id);
            }
          }
        });
        return stats;
      } catch (e) {
        console.error('Gagal ambil reaksi:', e);
        return { 'ðŸ¤ ': { count: 0, users: [] }, 'ðŸ˜¢': { count: 0, users: [] }, 'ðŸ¤—': { count: 0, users: [] }, 'ðŸ”¥': { count: 0, users: [] } };
      }
    }

    async function fetchArtefactReactionStats(artefactId) {
      try {
        const data = await supabaseFetch('reactions', 'GET', null);
        const filtered = data.filter(r => r.artefact_id === artefactId);
        const stats = { 'ðŸ¤ ': { count: 0, users: [] }, 'ðŸ˜¢': { count: 0, users: [] }, 'ðŸ¤—': { count: 0, users: [] }, 'ðŸ”¥': { count: 0, users: [] } };
        filtered.forEach(row => {
          if (stats[row.emoji]) {
            stats[row.emoji].count++;
            if (stats[row.emoji].users.length < 3) {
              stats[row.emoji].users.push(row.user_id);
            }
          }
        });
        return stats;
      } catch (e) {
        console.error('Gagal ambil reaksi artefak:', e);
        return { 'ðŸ¤ ': { count: 0, users: [] }, 'ðŸ˜¢': { count: 0, users: [] }, 'ðŸ¤—': { count: 0, users: [] }, 'ðŸ”¥': { count: 0, users: [] } };
      }
    }

    async function saveReaction(rantId, emoji) {
      try {
        await supabaseFetch('reactions', 'POST', {
          rant_id: rantId,
          user_id: cleanUsername,
          emoji: emoji
        });
        showConfirmation(`${emoji} tersimpan!`);
        await loadData();
      } catch (e) {
        console.error('Gagal simpan reaksi:', e);
        showConfirmation('Gagal menyimpan reaksi');
      }
    }

    async function saveArtefactReaction(artefactId, emoji) {
      try {
        await supabaseFetch('reactions', 'POST', {
          artefact_id: artefactId,
          user_id: cleanUsername,
          emoji: emoji
        });
        showConfirmation(`${emoji} tersimpan!`);
      } catch (e) {
        console.error('Gagal simpan reaksi artefak:', e);
        showConfirmation('Gagal menyimpan reaksi');
      }
    }

    function showReactionModal(artefactId, stats) {
      const old = document.getElementById('artefact-reaction-modal');
      if (old) old.remove();

      const modal = document.createElement('div');
      modal.id = 'artefact-reaction-modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(8px);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      `;

      const content = document.createElement('div');
      content.style.cssText = `
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px;
        max-width: 400px;
        width: 100%;
      `;

      const title = document.createElement('h3');
      title.textContent = 'Reaksi Artefak';
      title.style.cssText = `
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        color: var(--text);
      `;

      const emojiGrid = document.createElement('div');
      emojiGrid.style.cssText = `
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 16px;
      `;

      ['ðŸ¤ ', 'ðŸ˜¢', 'ðŸ¤—', 'ðŸ”¥'].forEach(emoji => {
        const item = document.createElement('div');
        item.style.cssText = `
          background: rgba(73, 3, 252, 0.1);
          border: 1px solid var(--border);
          border-radius: 12px;
          padding: 16px;
          cursor: pointer;
          transition: all 0.2s;
          text-align: center;
        `;

        const emojiSpan = document.createElement('div');
        emojiSpan.textContent = emoji;
        emojiSpan.style.fontSize = '32px';
        emojiSpan.style.marginBottom = '8px';

        const label = document.createElement('div');
        label.textContent = EMOJI_LABELS[emoji];
        label.style.fontSize = '11px';
        label.style.color = 'var(--muted)';
        label.style.marginBottom = '4px';

        const count = document.createElement('div');
        count.textContent = `${stats[emoji].count} reaksi`;
        count.style.fontSize = '12px';
        count.style.color = 'var(--text)';
        count.style.fontWeight = '600';

        item.onmouseenter = () => {
          item.style.background = 'rgba(73, 3, 252, 0.2)';
          item.style.borderColor = 'var(--accent)';
          item.style.transform = 'scale(1.05)';
        };
        item.onmouseleave = () => {
          item.style.background = 'rgba(73, 3, 252, 0.1)';
          item.style.borderColor = 'var(--border)';
          item.style.transform = 'scale(1)';
        };

        item.onclick = async () => {
          await saveArtefactReaction(artefactId, emoji);
          modal.remove();
        };

        item.appendChild(emojiSpan);
        item.appendChild(label);
        item.appendChild(count);
        emojiGrid.appendChild(item);
      });

      const closeBtn = document.createElement('button');
      closeBtn.textContent = 'Tutup';
      closeBtn.style.cssText = `
        width: 100%;
        background: var(--border);
        border: none;
        border-radius: 8px;
        padding: 12px;
        color: var(--text);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      `;
      closeBtn.onmouseenter = () => closeBtn.style.background = '#2a2a2a';
      closeBtn.onmouseleave = () => closeBtn.style.background = 'var(--border)';
      closeBtn.onclick = () => modal.remove();

      content.appendChild(title);
      content.appendChild(emojiGrid);
      content.appendChild(closeBtn);
      modal.appendChild(content);
      document.body.appendChild(modal);

      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };
    }

    function showUserList(emoji, users) {
      const old = document.getElementById('reaction-modal');
      if (old) old.remove();
      if (users.length === 0) return;

      const modal = document.createElement('div');
      modal.id = 'reaction-modal';
      modal.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(10, 10, 10, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 12px 16px;
        z-index: 1000;
        font-size: 13px;
        color: #f5f5f5;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        max-width: 90%;
      `;
      const title = document.createElement('div');
      title.textContent = `${emoji} ${EMOJI_LABELS[emoji]}`;
      title.style.fontSize = '14px';
      title.style.fontWeight = '600';
      title.style.marginBottom = '6px';
      const userList = document.createElement('div');
      userList.textContent = users.map(u => `@${u}`).join(', ');
      userList.style.fontSize = '12px';
      userList.style.color = '#a0a0a0';
      modal.appendChild(title);
      modal.appendChild(userList);
      document.body.appendChild(modal);
      setTimeout(() => { if (modal.parentNode) modal.parentNode.removeChild(modal); }, 3000);
      modal.onclick = () => modal.remove();
    }
