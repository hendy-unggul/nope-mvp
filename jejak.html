<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>JEJAK ‚Äî Spill Your Truth</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0A0A0A;--sf:#141414;--sfe:#1E1E1E;--bd:#2A2A2A;--tx:#FFF;--txs:#888;--txm:#555;--ap:#FF4D00;--as:#00F0FF;--at:#FF006E;--aq:#39FF14;--aw:#FFD700;--ms:#FF9500;--mt:#39FF14;--mc:#00F0FF;--md:#8B5CF6;--rd:#FF3333;--rd-dark:#990000}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:'Plus Jakarta Sans',system-ui,sans-serif;font-weight:500;font-size:15px;line-height:1.4;min-height:100vh;overflow-x:hidden;padding-bottom:100px}
.w{max-width:480px;margin:0 auto;padding:0 16px}
header{padding:24px 0 16px;display:flex;justify-content:space-between;align-items:flex-start}
.logo{font-size:42px;font-weight:800;letter-spacing:-.04em;cursor:pointer;line-height:.9}
.tagline{font-family:'Instrument Serif',serif;font-size:13px;color:var(--txs);font-style:italic}
.top-right{display:flex;align-items:center;gap:8px}
.huser{font-size:11px;font-weight:700;color:var(--tx);text-transform:lowercase;padding:4px 8px;background:var(--sf);border:1px solid var(--bd);max-width:100px;overflow:hidden;text-overflow:ellipsis}
.dot{width:8px;height:8px;background:var(--aq);border-radius:50%}
.smenu{position:relative}
.mtrig{width:32px;height:32px;display:flex;align-items:center;justify-content:center;gap:3px;background:transparent;border:none;cursor:pointer}
.mtrig span{width:4px;height:4px;background:var(--tx);border-radius:50%}
.mdd{position:absolute;top:100%;right:0;margin-top:8px;background:var(--sf);border:2px solid var(--bd);min-width:120px;display:none;z-index:100}
.mdd.on{display:block}
.mi{width:100%;padding:8px 16px;background:transparent;border:none;color:var(--tx);text-align:left;cursor:pointer}
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--sf);border-top:2px solid var(--bd);z-index:1000}
.bnav-c{max-width:480px;margin:0 auto;display:flex;justify-content:space-around;align-items:center;height:64px}
.ni{flex:1;display:flex;flex-direction:column;align-items:center;color:var(--txm);text-decoration:none;font-size:10px;font-weight:700;text-transform:uppercase}
.ni.act{color:var(--ap)}
.nico{font-size:20px}
.hero-s{margin:0 -16px 24px}
.hero{position:relative;width:100%;aspect-ratio:1/1;overflow:hidden;border-top:2px solid var(--bd);border-bottom:2px solid var(--bd)}
.hero img{width:100%;height:100%;object-fit:cover}
.hnote{position:absolute;bottom:0;left:0;right:0;padding:16px;background:linear-gradient(to top,rgba(0,0,0,.9),transparent);font-family:'Instrument Serif',serif;font-size:24px;font-style:italic}
.upctrls{position:absolute;top:16px;right:16px;z-index:20}
.upbtn{width:48px;height:48px;background:var(--ap);border:none;color:var(--bg);font-size:24px;cursor:pointer}
.qtimer{position:absolute;top:calc(100% + 8px);right:0;background:var(--sf);border:2px solid var(--bd);padding:8px;font-size:11px;white-space:nowrap;display:none}
.upctrls:hover .qtimer{display:block}
.isec{margin-bottom:32px}
.ihdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.ilbl{font-size:12px;font-weight:700;text-transform:uppercase;color:var(--txs)}
.ccount{font-size:12px;color:var(--txm)}
.ri{width:100%;background:var(--sf);border:2px solid var(--bd);padding:16px;color:var(--tx);font-size:16px;resize:none;min-height:120px}
.ri:focus{outline:none;border-color:var(--ap)}
.msec{margin:16px 0}
.mlbl{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--txs);margin-bottom:8px}
.mgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.mc{padding:16px;background:var(--sf);border:2px solid var(--bd);cursor:pointer}
.mc.act{border-color:currentColor;background:var(--sfe)}
.me{font-size:28px}
.mn{font-size:13px;font-weight:700;text-transform:uppercase}
.mc[data-mood="surviving"]{color:var(--ms)}
.mc[data-mood="thriving"]{color:var(--mt)}
.mc[data-mood="chaotic"]{color:var(--mc)}
.mc[data-mood="doom"]{color:var(--md)}
.iact{display:flex;justify-content:flex-end;margin-top:16px}
.sbtn{padding:14px 32px;background:var(--ap);border:none;color:var(--bg);font-weight:700;text-transform:uppercase;cursor:pointer}
.shdr{display:flex;align-items:center;gap:8px;margin-bottom:16px;border-bottom:2px solid var(--bd);padding-bottom:8px}
.stit{font-size:12px;font-weight:800;text-transform:uppercase}
.entry{background:var(--sf);border:2px solid var(--bd);margin-bottom:16px}
.ehdr{display:flex;justify-content:space-between;padding:8px 16px;border-bottom:1px solid var(--bd);background:var(--sfe)}
.etime{font-size:11px;color:var(--txm)}
.emood{font-size:10px;font-weight:700;text-transform:uppercase;padding:4px 8px;border:1px solid currentColor}
.econt{padding:16px}
.tgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;background:var(--bd);border:2px solid var(--bd);margin-bottom:16px}
.ti{aspect-ratio:1;background:var(--sf);position:relative;overflow:hidden;cursor:pointer}
.ti img{width:100%;height:100%;object-fit:cover}
.ti.empty{display:flex;align-items:center;justify-content:center;color:var(--txm);font-size:20px;border:2px dashed var(--bd)}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--tx);color:var(--bg);padding:8px 16px;z-index:10000;display:none}
.toast.show{display:block}
.proc{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:10002;display:none;flex-direction:column;align-items:center;justify-content:center}
.proc.on{display:flex}
.pspin{width:48px;height:48px;border:3px solid var(--bd);border-top-color:var(--ap);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:10001;padding:16px;overflow-y:auto}
.modal.on{display:block}
.mc2{max-width:480px;margin:0 auto;background:var(--sf);border:2px solid var(--bd);padding:24px}
.ggrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px}
.gi{aspect-ratio:1;background:var(--sfe);border:2px solid var(--bd);cursor:pointer;overflow:hidden}
.gi img{width:100%;height:100%;object-fit:cover}
.gi.sel{border-color:var(--ap)}
.mbtn{padding:12px 24px;background:var(--sf);border:2px solid var(--bd);color:var(--tx);cursor:pointer}
.mbtn.pri{background:var(--ap);border-color:var(--ap);color:var(--bg)}
</style>
</head>
<body>
<div class="w">
<header>
  <div>
    <div class="logo">JEJAK</div>
    <div class="tagline">no filter, just truth</div>
  </div>
  <div class="top-right">
    <div class="huser" id="huser">@anon</div>
    <div class="dot" id="odot"></div>
    <div class="smenu">
      <button class="mtrig" onclick="toggleMenu()"><span></span><span></span><span></span></button>
      <div class="mdd" id="mdd"><button class="mi" onclick="logout()">Logout</button></div>
    </div>
  </div>
</header>

<!-- TEST CARD SEMENTARA -->
<div style="background:#1a1a1a; border:2px solid #00ff88; padding:20px; margin:20px 0; border-radius:8px; text-align:center">
  <h3 style="color:#00ff88">‚úÖ SESSION AKTIF</h3>
  <p id="testUsername" style="margin:10px 0"></p>
  <p id="testUserId" style="margin:10px 0"></p>
  <p id="testStatus" style="color:#888"></p>
</div>

<section class="isec">
  <div class="ihdr"><span class="ilbl">Spill your truth</span><span class="ccount" id="ccount">0/500</span></div>
  <textarea class="ri" id="ri" placeholder="What's eating you alive right now?" maxlength="500"></textarea>
  <div class="msec">
    <div class="mlbl">Pilih mood-mu sekarang</div>
    <div class="mgrid">
      <div class="mc act" data-mood="surviving" onclick="selMood('surviving')"><span class="me">üòÆ‚Äçüí®</span><span class="mn">Surviving</span></div>
      <div class="mc" data-mood="thriving" onclick="selMood('thriving')"><span class="me">‚ú®</span><span class="mn">Thriving</span></div>
      <div class="mc" data-mood="chaotic" onclick="selMood('chaotic')"><span class="me">üåÄ</span><span class="mn">Chaotic</span></div>
      <div class="mc" data-mood="doom" onclick="selMood('doom')"><span class="me">üõå</span><span class="mn">Doom</span></div>
    </div>
  </div>
  <div class="iact"><button class="sbtn" id="sbtn">Jejakkan & Spill</button></div>
</section>

<section>
  <div class="shdr"><span class="stit">Riwayat</span></div>
  <div id="econ"></div>
</section>

<section>
  <div class="shdr"><span class="stit">Memori</span></div>
  <div class="tgrid" id="tgrid"></div>
</section>
</div>

<nav class="bnav">
  <div class="bnav-c">
    <a href="jejak.html" class="ni act"><span class="nico">‚ú¶</span><span>Jejak</span></a>
    <a href="#" class="ni"><span class="nico">‚úï</span><span>Spill</span></a>
  </div>
</nav>

<div class="toast" id="toast"></div>
<div class="proc" id="proc"><div class="pspin"></div></div>
<input type="file" id="finput" accept="image/*" multiple style="display:none">

<script>
// ============================================
// CEK SESSION DULU - PALING PENTING
// ============================================
(function() {
  const username = localStorage.getItem('jejak_username');
  const userId = localStorage.getItem('jejak_user_id');
  const loggedIn = localStorage.getItem('jejak_logged_in');
  
  console.log('Session check:', { username, userId, loggedIn });
  
  // Tampilkan di test card
  document.getElementById('testUsername').innerHTML = `Username: <strong>${username || 'tidak ada'}</strong>`;
  document.getElementById('testUserId').innerHTML = `User ID: <strong>${userId || 'tidak ada'}</strong>`;
  
  if (!loggedIn || !username || !userId) {
    document.getElementById('testStatus').innerHTML = '‚ùå SESSION TIDAK VALID - Redirect ke index...';
    setTimeout(() => { window.location.href = 'index.html'; }, 2000);
    return;
  }
  
  document.getElementById('testStatus').innerHTML = '‚úÖ SESSION VALID - Siap digunakan';
  document.getElementById('huser').textContent = '@' + username;
  
  // Lanjut inisialisasi
  initApp();
})();

// ============================================
// APP STATE
// ============================================
const S = {
  user: localStorage.getItem('jejak_username'),
  userId: localStorage.getItem('jejak_user_id'),
  entries: [],
  artefacts: []
};

// DUMMY DATA
const DUMMY_ENTRIES = [
  {id:'d1',content:'Hari ini gue nangis di angkot gegara liat kucing dipukul orang.',mood:'surviving',reactions:{skull:42,cry:89,fire:12,upside:7},isDummy:true},
  {id:'d2',content:'akhirnya bisa tidur nyenyak semalaman setelah 3 minggu insomnia.',mood:'thriving',reactions:{skull:23,cry:15,fire:67,upside:31},isDummy:true},
  {id:'d3',content:'hari ini chaos abis! dari bangun tidur udah salah ambil kaki.',mood:'chaotic',reactions:{skull:89,cry:23,fire:45,upside:78},isDummy:true}
];

const DUMMY_ARTEFACTS = [
  {id:'a1',url:'https://images.unsplash.com/photo-1517842645767-c639042777db?w=400&q=80',note:'jeda',hasFace:false,theme:'fm'},
  {id:'a2',url:'https://images.unsplash.com/photo-1499209974431-9dddcece7f88?w=400&q=80',note:'hijau',hasFace:false,theme:'fg'},
  {id:'a3',url:'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400&q=80',note:'gabut',hasFace:false,theme:'fl'}
];

// ============================================
// HELPERS
// ============================================
const $ = id => document.getElementById(id);

function toast(msg) {
  const t = $('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

function toggleMenu() {
  $('mdd').classList.toggle('on');
}

function logout() {
  if(confirm('Yakin logout?')) {
    localStorage.clear();
    window.location.href = 'index.html';
  }
}

function selMood(mood) {
  document.querySelectorAll('.mc').forEach(c => 
    c.classList.toggle('act', c.dataset.mood === mood)
  );
}

function renderEntries() {
  const con = $('econ');
  if(!con) return;
  
  const entries = S.entries.length ? S.entries : DUMMY_ENTRIES;
  
  con.innerHTML = entries.map(e => `
    <div class="entry">
      <div class="ehdr">
        <span class="etime">contoh</span>
        <span class="emood ${e.mood}">${e.mood}</span>
      </div>
      <div class="econt">${e.content}</div>
    </div>
  `).join('');
}

function renderTray() {
  const con = $('tgrid');
  if(!con) return;
  
  const arts = S.artefacts.length ? S.artefacts : DUMMY_ARTEFACTS;
  
  let html = '';
  arts.slice(0,6).forEach(a => {
    html += `<div class="ti"><img src="${a.url}" class="${a.theme}"></div>`;
  });
  
  for(let i = arts.length; i < 6; i++) {
    html += '<div class="ti empty" onclick="$(\'finput\').click()">+</div>';
  }
  
  con.innerHTML = html;
}

// ============================================
// INIT APP (dijalankan setelah session valid)
// ============================================
function initApp() {
  console.log('App initialized for user:', S.user);
  
  renderEntries();
  renderTray();
  
  const ri = $('ri');
  const cc = $('ccount');
  
  if(ri && cc) {
    ri.oninput = () => {
      cc.textContent = `${ri.value.length}/500`;
    };
  }
  
  $('sbtn').onclick = () => {
    const content = ri.value.trim();
    if(!content) {
      toast('Tulis sesuatu...');
      return;
    }
    toast('Fitur posting menyusul!');
    ri.value = '';
    cc.textContent = '0/500';
  };
  
  $('finput').onchange = (e) => {
    toast('Fitur upload menyusul!');
  };
}
</script>
</body>
</html>
