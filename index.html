<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>jejak ‚Äî vibe check ‚ú®</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;900&family=Bebas+Neue&family=Courier+Prime:wght@400;700&family=Rubik:wght@400;600;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0a0a;--sf:#121212;--tx:#fff;--mu:#999;--ac:#00ff88;--a2:#ff3366;--a3:#ffff00;--a4:#00d4ff;--bd:#333;--fm:'DM Sans',sans-serif;--fd:'Bebas Neue',sans-serif;--fmo:'Courier Prime',monospace;--fa:'Rubik',sans-serif}
body{background:var(--bg);color:var(--tx);font-family:var(--fm);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;overflow-x:hidden;position:relative}
body::before{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 20% 80%,rgba(0,255,136,.03),transparent 50%),radial-gradient(circle at 80% 20%,rgba(255,51,102,.03),transparent 50%),radial-gradient(circle at 40% 40%,rgba(0,212,255,.02),transparent 50%);animation:slowRot 60s linear infinite;pointer-events:none;z-index:0}
@keyframes slowRot{to{transform:rotate(360deg)}}
.sticker{position:fixed;font-size:48px;opacity:.15;pointer-events:none;animation:float 8s ease-in-out infinite;z-index:0;filter:blur(.5px)}
.sticker:nth-child(1){top:10%;left:5%}
.sticker:nth-child(2){top:20%;right:10%;animation-delay:2s;font-size:64px}
.sticker:nth-child(3){bottom:15%;left:15%;animation-delay:4s}
.sticker:nth-child(4){bottom:25%;right:5%;animation-delay:6s;font-size:56px}
.sticker:nth-child(5){top:60%;left:8%;animation-delay:1s}
.sticker:nth-child(6){top:40%;right:12%;animation-delay:3s;font-size:40px}
@keyframes float{0%,100%{transform:translate(0,0) rotate(0deg)}25%{transform:translate(10px,-15px) rotate(5deg)}50%{transform:translate(-10px,-25px) rotate(-5deg)}75%{transform:translate(15px,-10px) rotate(3deg)}}
.container{max-width:480px;width:100%;position:relative;z-index:1}
.logo-zone{text-align:center;margin-bottom:16px;position:relative}
.logo-big{font-family:var(--fd);font-size:88px;font-weight:400;line-height:.9;letter-spacing:-.02em;color:var(--ac);text-transform:lowercase;display:inline-block;filter:drop-shadow(3px 3px 0 var(--a2)) drop-shadow(-2px -2px 0 var(--a4));transform:rotate(-2deg);animation:glitch 5s ease-in-out infinite}
@keyframes glitch{0%,100%{transform:rotate(-2deg)}20%{transform:rotate(-2deg) translate(1px,0)}40%{transform:rotate(-2deg) translate(0,1px)}60%{transform:rotate(-2deg) translate(-1px,0)}80%{transform:rotate(-2deg) translate(0,-1px)}}
.doodle{position:absolute;top:-10px;right:-15px;width:120px;height:120px;border:3px solid var(--a3);border-radius:50%;transform:rotate(15deg);opacity:.3;animation:wobble 3s ease-in-out infinite}
@keyframes wobble{0%,100%{transform:rotate(15deg) scale(1)}50%{transform:rotate(12deg) scale(1.05)}}
.tagline{text-align:center;font-family:var(--fmo);font-size:13px;color:var(--mu);margin-bottom:24px;padding:8px 16px;background:rgba(255,255,255,.03);border:1px dashed var(--bd);border-radius:20px;display:inline-block;width:100%;transform:rotate(-1deg)}
.vibe-picker{display:flex;gap:10px;justify-content:center;margin-bottom:24px;flex-wrap:wrap}
.vibe-btn{padding:10px 20px;background:transparent;border:2px solid var(--bd);color:var(--tx);border-radius:30px;font-family:var(--fa);font-size:13px;font-weight:700;text-transform:lowercase;cursor:pointer;transition:all .3s cubic-bezier(.68,-.55,.27,1.55)}
.vibe-btn:hover{transform:translateY(-3px) rotate(-2deg);border-color:var(--ac);color:var(--ac)}
.vibe-btn.active{background:var(--ac);color:#000;border-color:var(--ac);transform:scale(1.05) rotate(-2deg)}
.auth-box{background:var(--sf);border:4px solid var(--ac);border-radius:24px;padding:40px 32px;position:relative;box-shadow:8px 8px 0 rgba(0,255,136,.2),12px 12px 0 rgba(255,51,102,.1);transform:rotate(-1deg);transition:all .3s ease}
.auth-box:hover{transform:rotate(0deg)}
.corner{position:absolute;font-size:32px;z-index:10;animation:spin 8s linear infinite}
.corner.tl{top:-15px;left:-15px}
.corner.tr{top:-15px;right:-15px;animation-direction:reverse}
.corner.bl{bottom:-15px;left:-15px;animation-delay:2s}
.corner.br{bottom:-15px;right:-15px;animation-direction:reverse;animation-delay:2s}
@keyframes spin{to{transform:rotate(360deg)}}
.input-label{text-align:center;font-family:var(--fd);font-size:24px;color:var(--tx);margin-bottom:4px;text-transform:lowercase;letter-spacing:1px}
.input-label::after{content:'‚≠ê';margin-left:8px;font-size:16px;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.2)}}
.fmt-hint{text-align:center;font-family:var(--fmo);font-size:11px;color:var(--mu);margin-bottom:16px;letter-spacing:.05em}
.fmt-hint b{color:var(--ac)}
.form-group{margin-bottom:20px;position:relative}
.form-group input{width:100%;background:rgba(255,255,255,.05);border:3px solid var(--bd);border-radius:16px;padding:20px;color:var(--tx);font-family:var(--fmo);font-size:18px;font-weight:500;text-align:center;text-transform:lowercase;transition:all .3s cubic-bezier(.68,-.55,.27,1.55);letter-spacing:.08em}
.form-group input:focus{outline:none;border-color:var(--ac);background:rgba(0,255,136,.1);transform:translateY(-4px) rotate(1deg);box-shadow:0 0 0 4px rgba(0,255,136,.2),6px 6px 0 rgba(0,255,136,.3)}
.form-group input::placeholder{color:var(--mu);font-weight:400;letter-spacing:.05em}
.form-group input.is-valid{border-color:var(--ac)}
.form-group input.is-invalid{border-color:var(--a2)}
.form-group input.is-checking{border-color:var(--a3)}
.feedback{margin-top:10px;padding:10px 16px;border-radius:12px;font-size:12px;font-family:var(--fmo);text-align:center;border:2px solid;display:none;line-height:1.5;animation:slideIn .4s cubic-bezier(.68,-.55,.27,1.55)}
.feedback.show{display:block}
.feedback.error{background:rgba(255,51,102,.1);border-color:var(--a2);color:var(--a2)}
.feedback.success{background:rgba(0,255,136,.1);border-color:var(--ac);color:var(--ac)}
.feedback.checking{background:rgba(255,255,0,.08);border-color:var(--a3);color:var(--a3)}
@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.suggest{display:none;margin-top:8px;padding:6px 16px;background:rgba(0,212,255,.1);border:1px solid var(--a4);border-radius:20px;font-family:var(--fmo);font-size:12px;color:var(--a4);cursor:pointer;transition:all .2s;text-align:center}
.suggest.show{display:block}
.suggest:hover{background:rgba(0,212,255,.2)}
.btn{width:100%;background:var(--ac);color:#000;border:none;border-radius:16px;padding:20px;font-family:var(--fd);font-size:28px;text-transform:lowercase;cursor:pointer;margin-top:16px;position:relative;overflow:hidden;transform:rotate(-1deg);transition:all .3s cubic-bezier(.68,-.55,.27,1.55);box-shadow:4px 4px 0 rgba(0,0,0,.3),6px 6px 0 var(--a2);letter-spacing:2px}
.btn::before{content:'üöÄ';position:absolute;left:20px;font-size:24px;animation:rocket 2s ease-in-out infinite}
@keyframes rocket{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-5px) rotate(15deg)}}
.btn:hover{transform:translateY(-6px) rotate(1deg) scale(1.02)}
.btn:active{transform:translateY(-2px) rotate(0deg)}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}
.notif{margin-top:24px;padding:20px;background:linear-gradient(135deg,rgba(255,255,0,.05),rgba(0,212,255,.05));border:2px dashed var(--bd);border-radius:16px;font-size:13px;line-height:1.6;position:relative;opacity:0;transform:translateY(20px) rotate(-2deg);transition:all .6s cubic-bezier(.68,-.55,.27,1.55)}
.notif.show{opacity:1;transform:translateY(0) rotate(0deg)}
.notif::before{content:'üìå';position:absolute;top:-12px;left:20px;font-size:24px;background:var(--sf);padding:0 8px}
.notif h4{color:var(--a3);font-family:var(--fa);font-weight:800;margin-bottom:12px;font-size:15px;text-transform:lowercase}
.notif p{margin-bottom:8px;font-family:var(--fmo);color:var(--mu)}
.notif .hl{color:var(--ac);font-weight:700;text-decoration:underline;text-decoration-style:wavy;text-decoration-color:var(--a2)}
.soul{margin-top:28px;padding-top:24px;border-top:1px solid var(--bd);text-align:center;font-family:var(--fmo);font-size:11px;color:var(--mu);opacity:.6}
.loading{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px}
.loading.hidden{display:none}
.l-spin{width:32px;height:32px;border:3px solid var(--bd);border-top-color:var(--ac);border-radius:50%;animation:spin 1s linear infinite}
.l-txt{font-family:var(--fmo);font-size:14px;color:var(--mu)}
@media(max-width:480px){.logo-big{font-size:64px}.btn{font-size:24px;padding:18px}.auth-box{padding:32px 24px}}
</style>
</head>
<body>
<div class="loading" id="loading"><div class="l-spin"></div><div class="l-txt">checking session...</div></div>

<div class="sticker">‚ú®</div><div class="sticker">üåà</div><div class="sticker">‚ö°</div>
<div class="sticker">üí´</div><div class="sticker">üî•</div><div class="sticker">üíú</div>

<div class="container">
  <div class="logo-zone">
    <div class="doodle"></div>
    <div class="logo-big">jejak</div>
  </div>
  <div class="tagline">nyambat ¬∑ aksi ¬∑ solusi</div>
  <div class="vibe-picker">
    <button class="vibe-btn active" onclick="setVibe('cyber')">cyber üíª</button>
    <button class="vibe-btn" onclick="setVibe('neon')">neon ‚ú®</button>
    <button class="vibe-btn" onclick="setVibe('retro')">retro üéÆ</button>
    <button class="vibe-btn" onclick="setVibe('pastel')">soft üå∏</button>
  </div>
  <div class="auth-box">
    <span class="corner tl">üåü</span><span class="corner tr">üí•</span>
    <span class="corner bl">‚ú®</span><span class="corner br">üéØ</span>
    <form id="frm">
      <div class="input-label">ur username vibes</div>
      <div class="fmt-hint">format: <b>kata.kata</b> &nbsp;¬∑&nbsp; contoh: <b>over.thinker</b></div>
      <div class="form-group">
        <input type="text" id="uname" placeholder="over.thinker" autocomplete="off" autofocus maxlength="30" spellcheck="false">
        <div class="feedback" id="fb"></div>
        <div class="suggest" id="sg"></div>
      </div>
      <button type="submit" class="btn" id="btn" disabled>let's goooo</button>
      <div class="notif" id="notif">
        <h4>real talk: stay safe bestie üîí</h4>
        <p>no <span class="hl">real names</span> fr fr</p>
        <p>no face pics, keep it <span class="hl">mysterious</span> ‚ú®</p>
        <p>obey the law, <span class="hl">zero hoax</span> energy üö´</p>
        <p>have fun but stay <span class="hl">accountable</span> üíØ</p>
      </div>
      <div class="soul">soul by itsALrUdio ‚Ä¢ v2.0</div>
    </form>
  </div>
</div>

<script>
// ============================================
// CONFIG SUPABASE
// ============================================
const SB_URL = 'https://fuovfrdicdhnlymnacpz.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1b3ZmcmRpY2Robmx5bW5hY3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwMjYxMzEsImV4cCI6MjA4MjYwMjEzMX0.oX4fVTEIWiRG2NaNJJKOV8dTnSHWhicLVMIFzZUl1o0';
const TABLE = 'users';

// ============================================
// LOCALSTORAGE KEYS
// ============================================
const SK = {
  u: 'jejak_username',        // username
  s: 'jejak_session_id',       // session id
  l: 'jejak_logged_in',        // login status
  v: 'jejak_vibe',             // vibe preference
  uid: 'user_id',              // user uuid
  isAi: 'is_ai',               // is AI flag
  aiToken: 'ai_token'          // AI 30-char token
};

// ============================================
// VALIDATION PATTERNS
// ============================================
const UN_PAT = /^[a-z][a-z0-9]*\.[a-z][a-z0-9]*$/;

// ============================================
// VIBE THEMES
// ============================================
const VIBES = {
  cyber: { ac: '#00ff88', a2: '#ff3366', a3: '#ffff00', a4: '#00d4ff' },
  neon:  { ac: '#ff10f0', a2: '#00ff88', a3: '#ffff00', a4: '#00d4ff' },
  retro: { ac: '#ff6b35', a2: '#f7b801', a3: '#6a994e', a4: '#bc4749' },
  pastel:{ ac: '#ffc8dd', a2: '#bde0fe', a3: '#a2d2ff', a4: '#ffafcc' }
};

// ============================================
// DOM HELPERS
// ============================================
const $u = () => document.getElementById('uname');
const $fb = () => document.getElementById('fb');
const $sg = () => document.getElementById('sg');
const $btn = () => document.getElementById('btn');

// ============================================
// UI FUNCTIONS
// ============================================
function setFb(type, msg) {
  const el = $fb(), inp = $u();
  if (!type || !msg) {
    el.className = 'feedback';
    el.textContent = '';
    inp.className = '';
    return;
  }
  el.className = 'feedback show ' + type;
  el.textContent = msg;
  inp.className = type === 'success' ? 'is-valid' : type === 'checking' ? 'is-checking' : 'is-invalid';
}

function setSg(text) {
  const el = $sg();
  if (!text) {
    el.className = 'suggest';
    return;
  }
  el.className = 'suggest show';
  el.textContent = 'üëâ maksud kamu: ' + text + '? (klik untuk apply)';
  el.onclick = () => {
    $u().value = text;
    el.className = 'suggest';
    $u().dispatchEvent(new Event('input'));
  };
}

function validate(raw) {
  if (!raw?.trim()) return { ok: false, msg: 'username tidak boleh kosong' };
  const v = raw.trim().toLowerCase();
  if (v.length > 30) return { ok: false, msg: 'maksimal 30 karakter' };
  if (v.includes(' ')) {
    const s = v.trim().replace(/\s+/g, '.').replace(/[^a-z0-9.]/g, '');
    return { ok: false, msg: 'gunakan titik bukan spasi ‚Äî format: kata.kata', suggest: s };
  }
  if (!v.includes('.')) return { ok: false, msg: 'harus dua kata dipisah titik ¬∑ contoh: over.thinker' };
  if ((v.match(/\./g) || []).length > 1) return { ok: false, msg: 'hanya boleh satu titik pemisah' };
  if (!UN_PAT.test(v)) return { ok: false, msg: /^\d|^\.\d/.test(v) ? 'tidak boleh diawali angka' : 'hanya huruf kecil a-z, angka, dan satu titik' };
  const [p1, p2] = v.split('.');
  if (p1.length < 2 || p2.length < 2) return { ok: false, msg: 'masing-masing kata minimal 2 huruf' };
  return { ok: true, value: v };
}

// ============================================
// SUPABASE FETCH WRAPPER
// ============================================
async function sbFetch(path, method = 'GET', body = null) {
  const r = await fetch(SB_URL + '/rest/v1/' + path, {
    method,
    headers: {
      'apikey': SB_KEY,
      'Authorization': 'Bearer ' + SB_KEY,
      'Content-Type': 'application/json',
      'Prefer': method === 'POST' ? 'return=representation' : ''
    },
    body: body ? JSON.stringify(body) : undefined
  });
  const t = await r.text();
  if (!r.ok) throw new Error(t || 'HTTP ' + r.status);
  return t ? JSON.parse(t) : [];
}

// ============================================
// SESSION MANAGEMENT
// ============================================
function getSessionId() {
  let id = localStorage.getItem(SK.s);
  if (!id) {
    id = 'sess_' + Date.now() + '_' + Math.random().toString(36).slice(2, 15);
    localStorage.setItem(SK.s, id);
  }
  return id;
}

function setSession(username, userId, isAi = false, aiToken = null) {
  localStorage.setItem(SK.u, username);
  localStorage.setItem(SK.uid, userId);
  localStorage.setItem(SK.isAi, isAi ? 'true' : 'false');
  localStorage.setItem(SK.l, 'true');
  
  if (aiToken) {
    localStorage.setItem(SK.aiToken, aiToken);
  }
}

function clearSession() {
  localStorage.removeItem(SK.u);
  localStorage.removeItem(SK.uid);
  localStorage.removeItem(SK.isAi);
  localStorage.removeItem(SK.aiToken);
  localStorage.removeItem(SK.l);
}

function getSession() {
  return {
    username: localStorage.getItem(SK.u),
    userId: localStorage.getItem(SK.uid),
    loggedIn: localStorage.getItem(SK.l) === 'true',
    isAi: localStorage.getItem(SK.isAi) === 'true'
  };
}

// ============================================
// VIBE MANAGEMENT
// ============================================
window.setVibe = function(v) {
  const c = VIBES[v];
  if (!c) return;
  const r = document.documentElement.style;
  r.setProperty('--ac', c.ac);
  r.setProperty('--a2', c.a2);
  r.setProperty('--a3', c.a3);
  r.setProperty('--a4', c.a4);
  document.querySelectorAll('.vibe-btn').forEach(b => 
    b.classList.toggle('active', b.textContent.includes(v))
  );
  localStorage.setItem(SK.v, v);
};

// ============================================
// USERNAME AVAILABILITY CHECK
// ============================================
let _deb = null, _last = null;

async function checkAvail(username) {
  if (username === _last) return;
  _last = username;
  $btn().disabled = true;
  setFb('checking', '‚è≥ mengecek ketersediaan...');
  
  try {
    const d = await sbFetch(
      `${TABLE}?username=eq.${encodeURIComponent(username)}&select=username&limit=1`
    );
    
    setFb('success', d.length === 0 
      ? '‚úì ' + username + ' tersedia ‚Äî siap daftar!' 
      : '‚úì ' + username + ' ditemukan ‚Äî welcome back!'
    );
    $btn().disabled = false;
  } catch (e) {
    console.error('Check:', e.message);
    setFb('checking', '‚ö†Ô∏è koneksi lambat, coba submit langsung');
    $btn().disabled = false;
  }
}

// ============================================
// INPUT HANDLER
// ============================================
$u().addEventListener('input', e => {
  let v = e.target.value;
  const fmt = v.toLowerCase()
    .replace(/\s+/g, '.')
    .replace(/[^a-z0-9.]/g, '')
    .replace(/\.{2,}/g, '.');
  
  if (fmt !== v) {
    const p = e.target.selectionStart;
    e.target.value = fmt;
    try { e.target.setSelectionRange(p, p); } catch (_) { }
    v = fmt;
  }
  
  if (!v) {
    setFb('', '');
    setSg(null);
    $btn().disabled = true;
    $u().className = '';
    _last = null;
    return;
  }
  
  document.getElementById('notif').classList.add('show');
  const r = validate(v);
  
  if (!r.ok) {
    setFb('error', r.msg);
    setSg(r.suggest || null);
    $btn().disabled = true;
    clearTimeout(_deb);
    _last = null;
    return;
  }
  
  setSg(null);
  clearTimeout(_deb);
  _deb = setTimeout(() => checkAvail(r.value), 600);
});

$u().addEventListener('paste', e => {
  e.preventDefault();
  const p = (e.clipboardData || window.clipboardData).getData('text');
  e.target.value = p.trim()
    .toLowerCase()
    .replace(/[\s_\-]+/g, '.')
    .replace(/[^a-z0-9.]/g, '')
    .replace(/\.{2,}/g, '.')
    .slice(0, 30);
  e.target.dispatchEvent(new Event('input'));
});

// ============================================
// FORM SUBMIT
// ============================================
document.getElementById('frm').addEventListener('submit', async e => {
  e.preventDefault();
  
  const r = validate($u().value);
  if (!r.ok) {
    setFb('error', r.msg);
    return;
  }
  
  const username = r.value;
  const btn = $btn();
  btn.disabled = true;
  btn.textContent = 'checking vibes...';
  
  try {
    const sid = getSessionId();
    
    // Cek user existing
    const existing = await sbFetch(
      `${TABLE}?username=eq.${encodeURIComponent(username)}&select=id,username,session_id,is_ai,ai_token&limit=1`
    );
    
    if (existing.length === 0) {
      // INSERT user baru
      const newUsers = await sbFetch(TABLE, 'POST', {
        username: username,
        session_id: sid,
        created_at: new Date().toISOString(),
        last_seen: new Date().toISOString(),
        vibe_preference: 50,
        total_rants: 0,
        is_ai: false,
        ai_token: null,
        parent_user_id: null,
        metadata: {
          vibe: localStorage.getItem(SK.v) || 'cyber',
          login_method: 'web',
          created_from: 'index.html'
        }
      });
      
      if (newUsers && newUsers.length > 0) {
        setSession(username, newUsers[0].id, false, null);
        setFb('success', 'üéâ account created! welcome bestie');
      }
      
    } else {
      // UPDATE user existing
      const user = existing[0];
      
      // Cek session conflict
      if (user.session_id && user.session_id !== sid) {
        setFb('error', '‚ö†Ô∏è username ini terdaftar di device lain');
        btn.disabled = false;
        btn.textContent = "let's goooo";
        return;
      }
      
      await sbFetch(
        `${TABLE}?username=eq.${encodeURIComponent(username)}`,
        'PATCH',
        {
          session_id: sid,
          last_seen: new Date().toISOString(),
          metadata: {
            ...user.metadata,
            last_vibe: localStorage.getItem(SK.v) || 'cyber',
            last_login: new Date().toISOString()
          }
        }
      );
      
      setSession(username, user.id, user.is_ai || false, user.ai_token || null);
      setFb('success', '‚úÖ welcome back, @' + username + '!');
    }
    
    // Redirect ke jejak.html
    setTimeout(() => window.location.href = 'jejak.html', 700);
    
  } catch (err) {
    console.error('Submit:', err);
    setFb('error', err.message.includes('duplicate key') 
      ? 'username sudah dipakai di device lain' 
      : 'error: ' + err.message
    );
    btn.disabled = false;
    btn.textContent = "let's goooo";
  }
});

// ============================================
// AUTO LOGIN CHECK
// ============================================
async function checkAutoLogin() {
  const { username, userId, loggedIn, isAi } = getSession();
  
  if (!loggedIn || !username || !userId) {
    done();
    return;
  }
  
  try {
    const sid = getSessionId();
    
    const users = await sbFetch(
      `${TABLE}?id=eq.${userId}&select=id,username,session_id,is_ai,ai_token&limit=1`
    );
    
    if (users.length > 0 && users[0].session_id === sid) {
      // Session valid, langsung redirect
      window.location.href = 'jejak.html';
      return;
    }
    
    // Session invalid, clear
    clearSession();
    
  } catch (e) {
    console.error('AutoLogin:', e.message);
  }
  
  done();
}

function done() {
  document.getElementById('loading').classList.add('hidden');
  const savedUsername = localStorage.getItem(SK.u);
  if (savedUsername) {
    $u().value = savedUsername;
    $u().dispatchEvent(new Event('input'));
  }
}

// ============================================
// INIT
// ============================================
window.addEventListener('DOMContentLoaded', () => {
  setVibe(localStorage.getItem(SK.v) || 'cyber');
  checkAutoLogin();
});
</script>
</body>
</html>
