<!DOCTYPE html>
<html lang="id" data-theme="glitch">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NOPE ‚Äî Database Klub & Atlet</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ff9999'/%3E%3Ctext x='50' y='70' font-size='60' font-weight='bold' font-family='system-ui' text-anchor='middle' fill='%23000'%3ENO%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="frekuensi-shared.css">
  <style>
    .database-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* ACCESS CONTROL BAR */
    .access-bar { background: var(--surface-elevated); border: 1px solid var(--border); border-radius: 12px; padding: 12px 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
    .access-info { display: flex; align-items: center; gap: 12px; }
    .access-badge { padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
    .access-badge.coach { background: rgba(0, 200, 83, 0.15); color: #00c853; }
    .access-badge.athlete { background: rgba(33, 150, 243, 0.15); color: #2196f3; }
    .access-badge.viewer { background: rgba(158, 158, 158, 0.15); color: #9e9e9e; }
    .switch-role { font-size: 12px; color: var(--muted); cursor: pointer; text-decoration: underline; }
    .switch-role:hover { color: var(--accent); }
    
    /* SELECTOR VIEW */
    .selector-view { max-width: 600px; margin: 40px auto; }
    .selector-card { background: var(--surface-elevated); border: 1px solid var(--border); border-radius: 20px; padding: 40px; }
    .selector-title { font-size: 20px; font-weight: 700; margin-bottom: 24px; text-align: center; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--muted); text-transform: uppercase; }
    .form-select { width: 100%; padding: 16px; background: var(--surface); border: 2px solid var(--border); border-radius: 12px; font-size: 16px; color: var(--text); cursor: pointer; transition: all 0.3s; }
    .form-select:focus { outline: none; border-color: var(--accent); }
    .form-select:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn-full { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-top: 10px; }
    .btn-full:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(178, 102, 255, 0.3); }
    .btn-full:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* KLUB VIEW */
    .klub-view { display: none; }
    .klub-view.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    .klub-header { background: var(--surface-elevated); border: 1px solid var(--border); border-radius: 20px; padding: 30px; margin-bottom: 30px; }
    .klub-top { display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px; flex-wrap: wrap; gap: 20px; }
    .klub-name { font-size: 32px; font-weight: 800; margin-bottom: 8px; }
    .klub-liga { display: inline-block; background: var(--accent); color: white; padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .klub-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .detail-label { font-size: 12px; color: var(--muted); text-transform: uppercase; margin-bottom: 6px; }
    .detail-value { font-size: 16px; font-weight: 600; }
    
    .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; color: var(--muted); text-decoration: none; font-size: 14px; cursor: pointer; }
    .back-btn:hover { color: var(--accent); }
    
    /* TABLE */
    .athletes-section { background: var(--surface-elevated); border: 1px solid var(--border); border-radius: 20px; padding: 24px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
    .athletes-table { width: 100%; border-collapse: collapse; }
    .athletes-table th { text-align: left; padding: 14px; font-size: 12px; color: var(--muted); text-transform: uppercase; border-bottom: 2px solid var(--border); }
    .athletes-table td { padding: 16px 14px; border-bottom: 1px solid var(--border); }
    .athletes-table tr:hover { background: rgba(178, 102, 255, 0.05); cursor: pointer; }
    .athlete-info { display: flex; align-items: center; gap: 12px; }
    .athlete-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
    .position-badge { padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; background: rgba(178, 102, 255, 0.15); color: var(--accent); }
    .position-badge.GK { background: rgba(255, 193, 7, 0.15); color: #ffc107; }
    .position-badge.DF { background: rgba(33, 150, 243, 0.15); color: #2196f3; }
    .position-badge.MF { background: rgba(76, 175, 80, 0.15); color: #4caf50; }
    .position-badge.FW { background: rgba(244, 67, 54, 0.15); color: #f44336; }
    .psiko-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .psiko-badge.done { background: rgba(0, 200, 83, 0.15); color: #00c853; }
    .psiko-badge.pending { background: rgba(158, 158, 158, 0.15); color: #9e9e9e; }
    .coachmetric-indicator { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; margin-left: 8px; }
    .coachmetric-indicator.has-data { color: #00c853; }
    .coachmetric-indicator.no-data { color: var(--muted); }
    
    /* MODAL */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; padding: 20px; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: var(--surface); border: 1px solid var(--border); border-radius: 24px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
    .modal-close { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; background: var(--surface-elevated); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; color: var(--muted); z-index: 10; }
    .modal-close:hover { background: var(--accent); color: white; }
    
    .modal-header { padding: 30px; border-bottom: 1px solid var(--border); }
    .modal-athlete { display: flex; align-items: center; gap: 20px; }
    .modal-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 700; }
    .modal-name { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
    .modal-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 14px; color: var(--muted); }
    
    .modal-body { padding: 30px; }
    .big-five-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 24px; }
    @media (max-width: 768px) { .big-five-grid { grid-template-columns: repeat(2, 1fr); } }
    .dimension-mini { text-align: center; padding: 16px; background: var(--surface-elevated); border-radius: 12px; border: 2px solid var(--border); }
    .dimension-mini.high { border-color: var(--accent); }
    .dim-icon { font-size: 24px; margin-bottom: 4px; }
    .dim-name { font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .dim-score { font-size: 20px; font-weight: 800; color: var(--accent); }
    
    .strengths-box { background: var(--surface-elevated); border-radius: 16px; padding: 20px; margin-bottom: 24px; }
    .strengths-title { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
    .strength-chips { display: flex; flex-wrap: wrap; gap: 8px; }
    .strength-chip { background: var(--accent); color: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    
    .heatmap-title { font-size: 16px; font-weight: 700; margin-bottom: 16px; }
    .heatmap-container { display: grid; grid-template-columns: 100px 1fr; gap: 16px; }
    .heatmap-label { height: 32px; display: flex; align-items: center; font-size: 12px; color: var(--muted); }
    .heatmap-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 3px; }
    .heatmap-cell { aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; }
    .heatmap-cell.low { background: #37474f; }
    .heatmap-cell.med { background: #546e7a; }
    .heatmap-cell.high { background: var(--accent); }
    
    /* COACHMETRIC SECTION */
    .coachmetric-section { margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--border); }
    .coachmetric-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
    .coachmetric-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .coachmetric-badge.editable { background: rgba(0, 200, 83, 0.15); color: #00c853; }
    .coachmetric-badge.readonly { background: rgba(158, 158, 158, 0.15); color: #9e9e9e; }
    
    .coachmetric-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 20px; }
    @media (max-width: 768px) { .coachmetric-grid { grid-template-columns: 1fr; } }
    
    .metric-card { background: var(--surface-elevated); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
    .metric-card.readonly { opacity: 0.7; }
    .metric-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .metric-name { font-weight: 600; }
    .metric-score { font-size: 28px; font-weight: 800; color: var(--accent); }
    .metric-score.empty { color: var(--muted); }
    
    .metric-slider { width: 100%; height: 8px; border-radius: 4px; background: var(--surface); outline: none; -webkit-appearance: none; cursor: pointer; }
    .metric-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; border-radius: 50%; background: var(--accent); cursor: pointer; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); transition: transform 0.2s; }
    .metric-slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
    .metric-slider:disabled { cursor: not-allowed; opacity: 0.5; }
    .metric-slider:disabled::-webkit-slider-thumb { background: var(--muted); }
    
    .metric-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: var(--muted); }
    .metric-desc { margin-top: 12px; padding: 12px; background: var(--surface); border-radius: 8px; font-size: 13px; color: var(--muted); min-height: 50px; }
    
    .integrated-score { background: linear-gradient(135deg, var(--accent), #7c4dff); border-radius: 16px; padding: 24px; text-align: center; color: white; margin-bottom: 20px; }
    .integrated-label { font-size: 14px; opacity: 0.9; margin-bottom: 8px; }
    .integrated-value { font-size: 48px; font-weight: 800; }
    .integrated-status { font-size: 14px; opacity: 0.9; margin-top: 8px; }
    
    .save-btn { width: 100%; padding: 16px; background: #00c853; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .save-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 200, 83, 0.3); }
    .save-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    /* TOAST */
    .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); padding: 16px 32px; border-radius: 30px; font-weight: 600; opacity: 0; transition: all 0.3s; z-index: 3000; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .toast.success { background: #00c853; color: white; }
    .toast.error { background: #f44336; color: white; }
    
    .login-prompt { background: var(--surface-elevated); border: 2px dashed var(--border); border-radius: 16px; padding: 30px; text-align: center; margin-top: 20px; }
    .login-prompt-icon { font-size: 48px; margin-bottom: 16px; }
    .login-prompt-text { font-size: 16px; color: var(--muted); margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="wrapper">
    <header>
      <div class="logo" onclick="window.location.href='index.html'">NOPE</div>
      <div class="top-right">
        <div class="nav-mini">
          <span onclick="window.location.href='jejak.html'">Jurnal</span>
          <span class="active">Frekuensi</span>
          <span onclick="window.location.href='saynope.html'">SayNOPE</span>
          <span onclick="window.location.href='glitch.html'">GLITCH</span>
        </div>
        <button class="settings-btn" id="settings-btn">‚ãØ</button>
      </div>
    </header>

    <div class="database-container">
      
      <!-- ACCESS CONTROL BAR -->
      <div class="access-bar">
        <div class="access-info">
          <span>Mode Akses:</span>
          <span class="access-badge coach" id="access-badge">Coach</span>
          <span id="access-name">Coach Ahmad Yani</span>
        </div>
        <span class="switch-role" onclick="toggleRole()">‚Üê Ganti Role (Demo)</span>
      </div>

      <!-- VIEW 1: SELECTOR -->
      <div class="selector-view" id="selector-view">
        <a href="frekuensi-bola-komunitas.html" style="color: var(--muted); text-decoration: none; font-size: 14px; margin-bottom: 20px; display: inline-block;">‚Üê Kembali ke Komunitas</a>
        
        <div class="selector-card">
          <div class="selector-title">üìä Pilih Klub</div>
          
          <div class="form-group">
            <label class="form-label">Liga</label>
            <select class="form-select" id="liga-select" onchange="updateKlub()">
              <option value="">Pilih Liga...</option>
              <option value="U15">Liga U15 (13-15 tahun)</option>
              <option value="U17">Liga U17 (16-17 tahun)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Nama Klub</label>
            <select class="form-select" id="klub-select" disabled onchange="enableButton()">
              <option value="">Pilih Klub...</option>
            </select>
          </div>
          
          <button class="btn-full" id="btn-lihat" disabled onclick="showKlub()">
            Lihat Detail Klub ‚Üí
          </button>
        </div>
      </div>

      <!-- VIEW 2: KLUB DETAIL -->
      <div class="klub-view" id="klub-view">
        <div class="back-btn" onclick="backToSelector()">‚Üê Kembali ke Pencarian</div>
        
        <div class="klub-header">
          <div class="klub-top">
            <div>
              <h1 class="klub-name" id="klub-nama">Persija Jakarta U15</h1>
              <span class="klub-liga" id="klub-liga">LIGA U15</span>
            </div>
          </div>
          
          <div class="klub-details">
            <div>
              <div class="detail-label">Pelatih Kepala</div>
              <div class="detail-value" id="klub-pelatih">-</div>
            </div>
            <div>
              <div class="detail-label">Alamat</div>
              <div class="detail-value" id="klub-alamat">-</div>
            </div>
            <div>
              <div class="detail-label">Telepon</div>
              <div class="detail-value" id="klub-telepon">-</div>
            </div>
            <div>
              <div class="detail-label">Jumlah Atlet</div>
              <div class="detail-value">20 Pemain</div>
            </div>
          </div>
        </div>

        <div class="athletes-section">
          <div class="section-header">
            <h2 style="font-size: 20px; font-weight: 700;">Daftar Atlet</h2>
            <span style="font-size: 13px; color: var(--muted);">Klik nama untuk detail lengkap</span>
          </div>
          
          <table class="athletes-table">
            <thead>
              <tr>
                <th>Nama Atlet</th>
                <th>Posisi</th>
                <th>Umur</th>
                <th>Tinggi</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="athletes-tbody">
              <!-- Generated by JS -->
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- MODAL PSIKOMETRIK + COACHMETRIC -->
  <div class="modal-overlay" id="modal-psikometrik" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      
      <div class="modal-header">
        <div class="modal-athlete">
          <div class="modal-avatar" id="modal-avatar">F</div>
          <div>
            <div class="modal-name" id="modal-nama">-</div>
            <div class="modal-meta">
              <span>üìç <strong id="modal-posisi">-</strong></span>
              <span>üéÇ <strong id="modal-umur">-</strong></span>
              <span>üìè <strong id="modal-tinggi">-</strong></span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-body">
        <!-- Big Five -->
        <div class="big-five-grid" id="modal-bigfive"></div>
        
        <!-- Strengths -->
        <div class="strengths-box">
          <div class="strengths-title">üèÜ Profil Keistimewaan (Psikometrik)</div>
          <div class="strength-chips" id="modal-strengths"></div>
        </div>
        
        <!-- Heatmap -->
        <div class="heatmap-title">üî• Heatmap Karakter Permainan</div>
        <div class="heatmap-container">
          <div>
            <div class="heatmap-label">Kreativitas (O)</div>
            <div class="heatmap-label">Disiplin (C)</div>
            <div class="heatmap-label">Leadership (E)</div>
            <div class="heatmap-label">Kerja Sama (A)</div>
            <div class="heatmap-label">Ketenangan (N)</div>
          </div>
          <div class="heatmap-grid" id="heatmap-grid"></div>
        </div>
        
        <!-- COACHMETRIC SECTION -->
        <div class="coachmetric-section" id="coachmetric-section">
          <div class="coachmetric-header">
            <div class="heatmap-title" style="margin: 0;">üéØ Coachmetric</div>
            <span class="coachmetric-badge editable" id="coachmetric-badge">‚úì Edit Mode (Coach)</span>
          </div>
          
          <div class="coachmetric-grid" id="coachmetric-grid">
            <!-- Technical Rating -->
            <div class="metric-card" id="tech-card">
              <div class="metric-header">
                <span class="metric-name">Technical Rating</span>
                <span class="metric-score empty" id="tech-score">-</span>
              </div>
              <input type="range" min="1" max="10" step="0.5" value="5" class="metric-slider" 
                     id="tech-slider" oninput="updateMetric('tech', this.value)">
              <div class="metric-labels">
                <span>Perlu latihan</span>
                <span>Elite</span>
              </div>
              <div class="metric-desc" id="tech-desc">
                Belum dinilai
              </div>
            </div>
            
            <!-- Tactical Rating -->
            <div class="metric-card" id="tact-card">
              <div class="metric-header">
                <span class="metric-name">Tactical Rating</span>
                <span class="metric-score empty" id="tact-score">-</span>
              </div>
              <input type="range" min="1" max="10" step="0.5" value="5" class="metric-slider" 
                     id="tact-slider" oninput="updateMetric('tact', this.value)">
              <div class="metric-labels">
                <span>Perlu latihan</span>
                <span>Elite</span>
              </div>
              <div class="metric-desc" id="tact-desc">
                Belum dinilai
              </div>
            </div>
          </div>
          
          <!-- Integrated Score -->
          <div class="integrated-score" id="integrated-score-box" style="display: none;">
            <div class="integrated-label">Integrated Performance Score</div>
            <div class="integrated-value" id="integrated-value">-</div>
            <div class="integrated-status" id="integrated-status">-</div>
          </div>
          
          <!-- Save Button (Coach Only) -->
          <button class="save-btn" id="save-btn" onclick="saveCoachmetric()">
            üíæ Simpan Penilaian Coach
          </button>
          
          <!-- Login Prompt (Non-Coach) -->
          <div class="login-prompt" id="login-prompt" style="display: none;">
            <div class="login-prompt-icon">üîí</div>
            <div class="login-prompt-text">Hanya pelatih yang dapat memberikan penilaian Coachmetric</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script src="frekuensi-shared.js"></script>
  <script>
    // ==================== ACCESS CONTROL ====================
    let currentRole = 'coach'; // 'coach', 'athlete', 'viewer'
    let currentCoachName = 'Coach Ahmad Yani';
    
    function toggleRole() {
      const roles = ['coach', 'athlete', 'viewer'];
      const names = ['Coach Ahmad Yani', '@fajar_atlet_7a3f', 'Suporter'];
      const currentIdx = roles.indexOf(currentRole);
      const nextIdx = (currentIdx + 1) % roles.length;
      
      currentRole = roles[nextIdx];
      currentCoachName = names[nextIdx];
      updateAccessUI();
    }
    
    function updateAccessUI() {
      const badge = document.getElementById('access-badge');
      const name = document.getElementById('access-name');
      
      badge.className = 'access-badge ' + currentRole;
      badge.textContent = currentRole === 'coach' ? 'Coach' : currentRole === 'athlete' ? 'Atlet' : 'Viewer';
      name.textContent = currentCoachName;
    }
    
    function isCoach() {
      return currentRole === 'coach';
    }
    
    // ==================== DATA ====================
    const klubDatabase = {
      'U15': [
        { id: 'persija-u15', name: 'Persija Jakarta U15', pelatih: 'Coach Ahmad Yani', alamat: 'Stadion Patriot, Bekasi', telepon: '0812-3456-7890' },
        { id: 'villa-u15', name: 'Villa U15', pelatih: 'Coach Budi Santoso', alamat: 'Lapangan Villa, Depok', telepon: '0813-4567-8901' },
        { id: 'bintang-timur-u15', name: 'Bintang Timur U15', pelatih: 'Coach Candra Wijaya', alamat: 'SSB Bintang Timur, Jakarta Timur', telepon: '0814-5678-9012' }
      ],
      'U17': [
        { id: 'persija-u17', name: 'Persija Jakarta U17', pelatih: 'Coach Eko Purwanto', alamat: 'Stadion Patriot, Bekasi', telepon: '0812-3456-7891' },
        { id: 'villa-u17', name: 'Villa U17', pelatih: 'Coach Fajar Hidayat', alamat: 'Lapangan Villa, Depok', telepon: '0813-4567-8902' }
      ]
    };
    
    let currentKlub = null;
    let currentAthletes = [];
    let currentModalAthleteId = null;
    let currentCoachmetric = { technical: null, tactical: null };
    
    // ==================== SELECTOR FUNCTIONS ====================
    function updateKlub() {
      const liga = document.getElementById('liga-select').value;
      const klubSelect = document.getElementById('klub-select');
      
      klubSelect.innerHTML = '<option value="">Pilih Klub...</option>';
      document.getElementById('btn-lihat').disabled = true;
      
      if (liga && klubDatabase[liga]) {
        klubDatabase[liga].forEach(k => {
          const opt = document.createElement('option');
          opt.value = k.id;
          opt.textContent = k.name;
          klubSelect.appendChild(opt);
        });
        klubSelect.disabled = false;
      } else {
        klubSelect.disabled = true;
      }
    }
    
    function enableButton() {
      document.getElementById('btn-lihat').disabled = !document.getElementById('klub-select').value;
    }
    
    function showKlub() {
      const klubId = document.getElementById('klub-select').value;
      const liga = document.getElementById('liga-select').value;
      
      const klub = klubDatabase[liga].find(k => k.id === klubId);
      currentKlub = klub;
      
      document.getElementById('klub-nama').textContent = klub.name;
      document.getElementById('klub-liga').textContent = 'LIGA ' + liga;
      document.getElementById('klub-pelatih').textContent = klub.pelatih;
      document.getElementById('klub-alamat').textContent = klub.alamat;
      document.getElementById('klub-telepon').textContent = klub.telepon;
      
      currentAthletes = generateAthletes(klubId, liga);
      renderAthletes();
      
      document.getElementById('selector-view').style.display = 'none';
      document.getElementById('klub-view').classList.add('active');
    }
    
    function backToSelector() {
      document.getElementById('klub-view').classList.remove('active');
      document.getElementById('selector-view').style.display = 'block';
    }
    
    // ==================== ATHLETES ====================
    function generateAthletes(klubId, liga) {
      const positions = ['GK', 'DF', 'MF', 'FW'];
      const posCount = [2, 6, 7, 5];
      const athletes = [];
      let id = 1;
      
      positions.forEach((pos, idx) => {
        for (let i = 0; i < posCount[idx]; i++) {
          const hasPsiko = Math.random() > 0.3;
          const hasCoachmetric = Math.random() > 0.5; // 50% sudah dinilai coach
          
          athletes.push({
            id: id,
            nama: `Atlet ${klubId.split('-')[0].charAt(0).toUpperCase() + klubId.split('-')[0].slice(1)} ${String.fromCharCode(65 + id - 1)}`,
            username: `@${klubId.replace('-', '_')}_${id.toString().padStart(3, '0')}`,
            posisi: pos,
            umur: liga === 'U15' ? 13 + Math.floor(Math.random() * 3) : 16 + Math.floor(Math.random() * 2),
            tinggi: 155 + Math.floor(Math.random() * 25),
            psikometrik: hasPsiko,
            scores: hasPsiko ? {
              O: 40 + Math.floor(Math.random() * 50),
              C: 40 + Math.floor(Math.random() * 50),
              E: 40 + Math.floor(Math.random() * 50),
              A: 40 + Math.floor(Math.random() * 50),
              N: 40 + Math.floor(Math.random() * 50)
            } : null,
            coachmetric: hasCoachmetric ? {
              technical: 4 + Math.random() * 5,
              tactical: 4 + Math.random() * 5,
              coach: 'Coach Ahmad Yani',
              date: '2026-02-10'
            } : null
          });
          id++;
        }
      });
      
      return athletes.sort((a, b) => positions.indexOf(a.posisi) - positions.indexOf(b.posisi));
    }
    
    function renderAthletes() {
      const tbody = document.getElementById('athletes-tbody');
      tbody.innerHTML = currentAthletes.map(a => {
        const coachIndicator = a.coachmetric 
          ? '<span class="coachmetric-indicator has-data" title="Sudah dinilai coach">‚óè</span>' 
          : '<span class="coachmetric-indicator no-data" title="Belum dinilai">‚óã</span>';
        
        return `
          <tr onclick="openModal(${a.id})">
            <td>
              <div class="athlete-info">
                <div class="athlete-avatar">${a.nama.charAt(0)}</div>
                <div>
                  <div style="font-weight: 600;">${a.nama} ${coachIndicator}</div>
                  <div style="font-size: 12px; color: var(--muted);">${a.username}</div>
                </div>
              </div>
            </td>
            <td><span class="position-badge ${a.posisi}">${a.posisi}</span></td>
            <td>${a.umur} th</td>
            <td>${a.tinggi} cm</td>
            <td>
              ${a.psikometrik 
                ? '<span class="psiko-badge done">‚úì Psikometrik</span>' 
                : '<span class="psiko-badge pending">‚óã Belum</span>'}
            </td>
          </tr>
        `;
      }).join('');
    }
    
    // ==================== MODAL & COACHMETRIC ====================
    function openModal(athleteId) {
      currentModalAthleteId = athleteId;
      const a = currentAthletes.find(x => x.id === athleteId);
      if (!a) return;
      
      // Basic Info
      document.getElementById('modal-avatar').textContent = a.nama.charAt(0);
      document.getElementById('modal-nama').textContent = a.nama;
      document.getElementById('modal-posisi').textContent = 
        a.posisi === 'GK' ? 'Kiper' : a.posisi === 'DF' ? 'Bek' : a.posisi === 'MF' ? 'Gelandang' : 'Penyerang';
      document.getElementById('modal-umur').textContent = a.umur + ' tahun';
      document.getElementById('modal-tinggi').textContent = a.tinggi + ' cm';
      
      // Psikometrik (if available)
      if (a.psikometrik) {
        const dims = [
          { key: 'O', name: 'Openness', icon: 'üé®' },
          { key: 'C', name: 'Conscientiousness', icon: 'üìã' },
          { key: 'E', name: 'Extraversion', icon: '‚ö°' },
          { key: 'A', name: 'Agreeableness', icon: 'ü§ù' },
          { key: 'N', name: 'Stability', icon: 'üßò' }
        ];
        
        document.getElementById('modal-bigfive').innerHTML = dims.map(d => `
          <div class="dimension-mini ${a.scores[d.key] >= 60 ? 'high' : ''}">
            <div class="dim-icon">${d.icon}</div>
            <div class="dim-name">${d.name}</div>
            <div class="dim-score">${a.scores[d.key]}%</div>
          </div>
        `).join('');
        
        // Strengths
        const strengths = calculateStrengths(a.scores);
        document.getElementById('modal-strengths').innerHTML = strengths.map(s => 
          `<span class="strength-chip">${s}</span>`
        ).join('');
        
        // Heatmap
        renderHeatmap(a.scores);
      } else {
        document.getElementById('modal-bigfive').innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: var(--muted);">Belum ada data psikometrik</div>';
        document.getElementById('modal-strengths').innerHTML = '<span style="color: var(--muted);">Belum tersedia</span>';
        document.getElementById('heatmap-grid').innerHTML = '';
      }
      
      // Setup Coachmetric based on role
      setupCoachmetric(a);
      
      document.getElementById('modal-psikometrik').classList.add('active');
    }
    
    function calculateStrengths(scores) {
      const s = [];
      if (scores.O >= 65) s.push('üé® Kreatif');
      if (scores.C >= 65) s.push('üí™ Disiplin');
      if (scores.E >= 65) s.push('‚ö° Energik');
      if (scores.A >= 65) s.push('ü§ù Team Player');
      if (scores.N >= 65) s.push('üßò Tenang');
      if (scores.C >= 60 && scores.N >= 60) s.push('üéØ Clutch');
      if (scores.O >= 60 && scores.E >= 60) s.push('üî• Playmaker');
      if (scores.E >= 60 && scores.A >= 60) s.push('üëë Leader');
      return s.slice(0, 3);
    }
    
    function renderHeatmap(scores) {
      const grid = document.getElementById('heatmap-grid');
      let html = '';
      ['O', 'C', 'E', 'A', 'N'].forEach(dim => {
        const score = scores[dim];
        for (let i = 0; i < 10; i++) {
          const active = score >= (i + 1) * 10;
          const intensity = active ? (score >= 70 ? 'high' : score >= 40 ? 'med' : 'low') : 'low';
          html += `<div class="heatmap-cell ${intensity}">${active ? '‚óè' : ''}</div>`;
        }
      });
      grid.innerHTML = html;
    }
    
    // ==================== COACHMETRIC LOGIC ====================
    function setupCoachmetric(athlete) {
      const badge = document.getElementById('coachmetric-badge');
      const saveBtn = document.getElementById('save-btn');
      const loginPrompt = document.getElementById('login-prompt');
      const techSlider = document.getElementById('tech-slider');
      const tactSlider = document.getElementById('tact-slider');
      const techCard = document.getElementById('tech-card');
      const tactCard = document.getElementById('tact-card');
      
      // Reset
      currentCoachmetric = { technical: null, tactical: null };
      
      if (isCoach()) {
        // COACH MODE: Can edit
        badge.className = 'coachmetric-badge editable';
        badge.textContent = '‚úì Edit Mode (Coach)';
        saveBtn.style.display = 'flex';
        loginPrompt.style.display = 'none';
        techCard.classList.remove('readonly');
        tactCard.classList.remove('readonly');
        
        techSlider.disabled = false;
        tactSlider.disabled = false;
        
        // Load existing data if any
        if (athlete.coachmetric) {
          techSlider.value = athlete.coachmetric.technical;
          tactSlider.value = athlete.coachmetric.tactical;
          updateMetric('tech', athlete.coachmetric.technical);
          updateMetric('tact', athlete.coachmetric.tactical);
        } else {
          techSlider.value = 5;
          tactSlider.value = 5;
          updateMetric('tech', 5);
          updateMetric('tact', 5);
        }
      } else {
        // ATHLETE/VIEWER MODE: Read only
        badge.className = 'coachmetric-badge readonly';
        badge.textContent = 'üëÅ View Only';
        saveBtn.style.display = 'none';
        loginPrompt.style.display = 'block';
        techCard.classList.add('readonly');
        tactCard.classList.add('readonly');
        
        techSlider.disabled = true;
        tactSlider.disabled = true;
        
        // Show existing data or empty
        if (athlete.coachmetric) {
          techSlider.value = athlete.coachmetric.technical;
          tactSlider.value = athlete.coachmetric.tactical;
          updateMetric('tech', athlete.coachmetric.technical, true);
          updateMetric('tact', athlete.coachmetric.tactical, true);
        } else {
          document.getElementById('tech-score').textContent = '-';
          document.getElementById('tact-score').textContent = '-';
          document.getElementById('tech-score').classList.add('empty');
          document.getElementById('tact-score').classList.add('empty');
          document.getElementById('tech-desc').textContent = 'Belum dinilai oleh pelatih';
          document.getElementById('tact-desc').textContent = 'Belum dinilai oleh pelatih';
          document.getElementById('integrated-score-box').style.display = 'none';
        }
      }
    }
    
    function updateMetric(type, value, readonly = false) {
      const numVal = parseFloat(value);
      currentCoachmetric[type === 'tech' ? 'technical' : 'tactical'] = numVal;
      
      const scoreEl = document.getElementById(`${type}-score`);
      const descEl = document.getElementById(`${type}-desc`);
      
      scoreEl.textContent = numVal.toFixed(1);
      scoreEl.classList.remove('empty');
      
      // Description
      if (!readonly) {
        if (numVal <= 3) {
          descEl.textContent = type === 'tech' 
            ? '‚ö†Ô∏è Perlu pengembangan fundamental: kontrol bola, passing dasar'
            : '‚ö†Ô∏è Perlu pemahaman: positioning dasar, awareness';
        } else if (numVal <= 6) {
          descEl.textContent = type === 'tech'
            ? '‚≠ê Berkembang: teknik stabil, perlu konsistensi'
            : '‚≠ê Berkembang: mengerti sistem, perlu kecepatan decision';
        } else if (numVal <= 8) {
          descEl.textContent = type === 'tech'
            ? 'üí™ Kuat: teknik matang, siap kompetisi'
            : 'üí™ Kuat: reading game bagus, adaptif';
        } else {
          descEl.textContent = type === 'tech'
            ? 'üî• Elite: teknik superior, role model tim'
            : 'üî• Elite: vision superior, leader taktikal';
        }
      } else {
        descEl.textContent = type === 'tech'
          ? `‚úì Dinilai oleh ${currentAthletes.find(a => a.id === currentModalAthleteId)?.coachmetric?.coach || 'Coach'}`
          : `‚úì Dinilai oleh ${currentAthletes.find(a => a.id === currentModalAthleteId)?.coachmetric?.coach || 'Coach'}`;
      }
      
      if (!readonly) {
        calculateIntegratedScore();
      }
    }
    
    function calculateIntegratedScore() {
      const athlete = currentAthletes.find(a => a.id === currentModalAthleteId);
      if (!athlete || !athlete.psikometrik) {
        document.getElementById('integrated-score-box').style.display = 'none';
        return;
      }
      
      const psikoAvg = (athlete.scores.O + athlete.scores.C + athlete.scores.E + athlete.scores.A + athlete.scores.N) / 5;
      const tech = currentCoachmetric.technical || 5;
      const tact = currentCoachmetric.tactical || 5;
      const coachAvg = ((tech + tact) / 2) * 10; // Scale to 0-100
      
      // Weighted: 60% Psikometrik + 40% Coachmetric
      const integrated = Math.round((psikoAvg * 0.6) + (coachAvg * 0.4));
      
      document.getElementById('integrated-score-box').style.display = 'block';
      document.getElementById('integrated-value').textContent = integrated + '%';
      
      const statusEl = document.getElementById('integrated-status');
      if (integrated >= 80) {
        statusEl.textContent = 'üåü Elite Prospect';
        statusEl.style.color = '#ffd700';
      } else if (integrated >= 65) {
        statusEl.textContent = 'üí™ Core Player';
        statusEl.style.color = '#00c853';
      } else if (integrated >= 50) {
        statusEl.textContent = '‚≠ê Development';
        statusEl.style.color = '#ff9800';
      } else {
        statusEl.textContent = 'üìö Fundamental';
        statusEl.style.color = '#f44336';
      }
    }
    
    function saveCoachmetric() {
      if (!isCoach()) {
        showToast('Hanya pelatih yang dapat menyimpan penilaian', 'error');
        return;
      }
      
      const athlete = currentAthletes.find(a => a.id === currentModalAthleteId);
      if (!athlete) return;
      
      // Save to athlete data
      athlete.coachmetric = {
        technical: currentCoachmetric.technical,
        tactical: currentCoachmetric.tactical,
        coach: currentCoachName,
        date: new Date().toISOString().split('T')[0]
      };
      
      showToast('‚úì Penilaian berhasil disimpan!', 'success');
      
      // Refresh table to show indicator
      renderAthletes();
    }
    
    // ==================== UTILS ====================
    function closeModal(e) {
      if (!e || e.target.id === 'modal-psikometrik') {
        document.getElementById('modal-psikometrik').classList.remove('active');
        currentModalAthleteId = null;
      }
    }
    
    function showToast(message, type) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type;
      
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    // Init
    updateAccessUI();
  </script>
</body>
</html>
